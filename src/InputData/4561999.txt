How To Improve Medical Image Diagnosis through Association Rules: The IDEA Method

Abstract In this paper we present a new method, called IDEA,  which employs association rules to assist in medical im- age diagnosis. IDEA mines association rules, relating vi- sual features with the knowledge gotten from specialists, and employs the associations to suggest possible diagnoses for a given medical image. IDEA incorporates two new al- gorithms called Omega and ACE. Omega performs simul- taneously feature selection and data discretization very ef- ficiently with linear cost on the number of feature values.

ACE is a new associative classifier, which has the particular ability of suggesting multiple keywords to compose the diag- nosis for a given medical image. The IDEA method has an important characteristic that makes it different from other CAD methods: it suggests multiple diagnosis hypotheses for an image and ranks them based on a measure of qual- ity. The IDEA method was implemented in a prototype (IDEA system) for radiologists evaluate it. The radiologists showed enormous interest in employing the system to aid them in their daily work. The IDEA system was applied to real datasets and the results presented high accuracy (up to 96.7%). The results testify that association rules are well- suited to support the diagnosing task.

1. Introduction  A vast amount of medical images is daily generated in hospitals and medical centers. Consequently, the radiolo- gists have an increasing number of images to analyze manu- ally. After analyzing a small number of images, the process of diagnosing them becomes tiresome, and consequently more susceptible to errors. Computational techniques can be provided to assist the physician?s work. The comput- erized analysis of medical images have evolved from au- tomated computer diagnosis to computer-aided diagnosis (CAD), where the radiologists use the computer output as a ?second opinion? to assist them, speeding up the diagnosing  task and bringing more confidence to it [6]. CAD systems support radiologists in analyzing digital images and to find out possible diseases. CAD is an interdisciplinary research field that combines techniques of data mining, digital image processing, radiology and usability, among others.

In this work, we propose a new approach to employ asso- ciation rules to support CAD systems. The process of min- ing association rules corresponds to searching a database for patterns relating items that often occur together. Asso- ciation rules reflect how human beings learn and memorize new knowledge. We will show in this paper that association rules can be successfully applied to support medical image diagnosis.

In this paper, we present the IDEA (Image Diagnosis Enhancement through Association rules) method to support medical image diagnosis through association rules. The IDEA method has an important characteristic that makes it different from other CAD methods: it allows multiple diagnosis hypotheses to be suggested for the same image and employs a measure of quality to rank them. Although we present in this paper the results achieved in mammo- gram analysis, the IDEA method can be employed to ana- lyze other types of medical images, if an adequate feature extractor is employed. The IDEA system was applied to real datasets and the results show high accuracy (up to 96.7%).

The remainder of this paper is structured as follows. Sec- tion 2 presents the related work and the background. Sec- tion 3 details the IDEA method, and Section 4 discusses the experiments. Finally, Section 5 summarizes the conclusions of this work.

2. Related Work and Background  Recently, CAD systems have been developed to support diagnosis of diseases in the breast, lung, colon and brain.

It has been shown that radiologists fail to manually detect  21st IEEE International Symposium on Computer-Based Medical Systems  DOI 10.1109/CBMS.2008.55   21st IEEE International Symposium on Computer-Based Medical Systems  DOI 10.1109/CBMS.2008.55   21st IEEE International Symposium on Computer-Based Medical Systems  DOI 10.1109/CBMS.2008.55   21st IEEE International Symposium on Computer-Based Medical Systems  DOI 10.1109/CBMS.2008.55     lung nodules in up to 30% of the positive cases. To re- duce the number of missed lung nodules, in [12] a method is presented to detect regions of lung images with abnor- malities. Studies presented in [11] show an improvement in the performance of radiologists supported by a CAD system in detecting abnormalities in mammograms. Also, the diag- nosis of colon cancer, which is the second leading cause of cancer-related death in the world, beneffits with the devel- opment of CAD tecniques. In [14], a method is presented that employs topographical height maps to analyze colon images and to reduce the false-positive colon cancer detec- tion rate. In [3], a fuzzy c-means clustering technique is employed to classify the colon data. Other very promis- ing works in CAD field have been developed to work with brain [15] and liver [5]. In [10], a framework, which uses a decision-tree inductor, is employed to discover relevant knowledge for medical image analysis and diagnosis.

Relevant works also applied association rules for image analysis [9, 4, 13]. Association rule mining is one of the most important tasks in the data mining field and it has been extensively studied and applied to market basket analysis.

The problem of mining association rules was firstly stated in [1], as follows. Let I = {i1, . . . , in} be a set of literals called items. A set X ? I is called an itemset. Let R be a table with transactions t involving elements that are sub- sets of I . An association rule is an expression of the form X ? Y , where X and Y are itemsets. X is called body or antecedent of the rule. Y is called head or consequent of the rule. The support is the ratio between the number of transactions of R containing the itemset X ? Y and the total number of transactions of R. Confidence is the frac- tion of the number of transactions containing X that also contain Y . The problem of mining association rules, as it was firstly stated, consists of finding association rules that satisfy the restrictions of minimum support minsup and con- fidence minconf specified by the user.

CAD systems employ image mining, a more complex process than the traditional data mining. Image mining em- ploys image processing algorithms to extract relevant fea- tures from the images, organizing them in feature vectors.

The feature vectors are employed in place of the images to model them as transactions, which are used in the mining process. Features quantify intrinsic visual characteristics of the images, such as color, shape and texture, leading to vec- tors with hundreds or even thousands of elements. However, a large number of features to represent the image can lead to the ?curse of dimensionality? problem, where the signif- icance of each feature decreases. To avoid this problem the IDEA method incorporates the Omega algorithm that also performs feature selection, eliminating redundant and noisy features of the feature vector.

In this paper we present IDEA, a method based on as-  sociation rules to support the diagnosis of medical images, which is detailed in the next section.

3. The IDEA Method  IDEA is a supervised method that mines association rules relating visual features automatically extracted from images with the reports given by radiologists about the training images. The reports are composed of a set of key- words. Figure 1 shows the pipeline and the Algorithm 1 summarizes the steps of the IDEA method.

Algorithm 1 The steps the IDEA Method.

Input: Training images, a test image Output: Report (set of keywords).

1: Extract features of the training images 2: Execute Omega algorithm 3: Mine association rules 4: Extract features of the test image 5: Execute ACE 6: Return the suggested report (set of keywords)  Feature Extraction  Omega  Training images  feature vector  Association rule mining  ACE  Suggested Report  im7 0.28 0.76 1.13  Mass, Circum, Benign  4[0.5-0.9] Mass  Benign 2[1.4-1.5] 3[0.6-0.8]  Birads=3  Report  test image  Mass bening Birads=3  Step 1  Step 2  Step 3  class  im7 1[0.12-0.29] 3[1.12-1.15] Mass Circum Benign  Image Transaction  Feature Extraction  Figure 1. Pipeline of the IDEA method.

In the training phase (see Algorithm 1), features are ex- tracted from the images, and feature vectors are used to rep- resent the images (line 1). The feature vectors and the class of the training images are submitted to Omega, which re- moves irrelevant features from the feature vector and gives a discretization of the remaining features (line 2). The class of an image is the most important keyword chosen by the specialist to describe the image. In the training phase, a processed feature vector is merged with the diagnosis key- words about the training images, producing the transaction representation of the images. The transaction representa- tions of all training images are submitted to the Apriori al- gorithm [2] for association rule mining (line 3), limiting the minimum confidence to high values. In the test phase (lines     4-6), the feature vector of the test image is extracted (line 4) and submitted to the ACE algorithm (line 5), which uses the association rules to suggest possible keywords to compose the diagnosis of the test image. We discuss each step of the IDEA method as follows.

3.1. Feature Extraction  When dealing with medical images, the earliest stage of a CAD system demands to extract the main image features regarding a specific criterion. One question that should be answered when working with image mining is ?which fea- tures best represent the semantical meaning of a given im- age??. Essentially, the most representative features vary ac- cording to the image type (e.g. mammogram, brain and lung) and according to the focus of the analysis (e.g. to distinguish nodules and to identify brain white matter). For instance, when working with mammograms, histogram fea- tures give a very poor identification of breast lesions. How- ever, features of shape can work well to distinguish malig- nant and benign breast lesions. Nevertheless, most shape features demand a previous step of lesion segmentation, and this step increases the computational effort to a great extent.

The IDEA method can work with various types of med- ical images, with different focus of analysis. However, for each type of image and goal, an appropriate feature extrac- tor should be employed. In our experiments, we used two datasets of mammograms. The images of the first dataset are regions of interest and the focus of analysis is to identify characteristics of morphology, histology and the severity of the lesions. To represent this dataset, we used a compact feature vector that combines texture, shape and color char- acteristics. The images of the second dataset are full mam- mograms, and the focus of analysis is to identify the breast side, the mammogram view and the breast density. For this dataset, a more robust feature vector is employed (detailed in Section 4).

3.2. The Omega Algorithm  Omega is a new supervised algorithm that smartly pre- pares the feature vectors for the mining of association rules.

The Omega algorithm performs simultaneously data dis- cretization and feature selection. A measure of inconsis- tence is employed to determine the final number of inter- vals and to select features. As the number of intervals gets smaller, the number of inconsistence increases. Omega aims at keeping the minimal number of intervals with min- imal inconsistency, establishing a tradeoff between these measures.

A cut point is a limit of an interval of real values. An interval is also called bin and the most frequent class in a bin is called majority class of the bin. An inconsistence is an occurrence of a class different from the majority class in an interval.

Omega first sorts the continuous values and defines the initial cut points. Every time that a change in the class la- bel of the instances occurs, a cut point is created. In this step, Omega produces pure bins, wherein the entropy is the lowest possible (zero).

In a second step, Omega restricts the minimum fre- quency that a bin must present, avoiding a huge number of cut points. Omega removes the right cut points of the inter- vals that do not satisfy the minimum frequency restriction given by an input parameter Hmin. The higher the value of Hmin, the fewer the bins obtained in this step. However, some caution should be taken before adjusting the Hmin value, the higher the Hmin, the higher the inconsistencies generated by the discretization process.

In a third step, Omega fuses consecutive intervals, using the inconsistence rate to determine which intervals should be merged. Let MTi be the majority class of an interval Ti.

Equation 1 gives the inconsistence rate ?Ti of an interval Ti.

?Ti = |Ti| ? |MTi |  |Ti| (1)  In Equation 1, |Ti| is the number of instances in the in- terval Ti and |MTi | is the number of instances of the ma- jority class in Ti. The Omega algorithm fuses consecutive intervals that have the same majority class and also have inconsistence rates below or equal an input threshold ?max (0 ? ?max ? 1).

The last step of Omega algorithm is to perform feature selection. Let T be the set of intervals in which a feature is discretized. For each feature, Omega computes the global inconsistence ?G value, according to Equation 2.

?G =  ? Ti?T (|Ti| ? |MTi |)?  Ti?T |Ti| (2)  The feature selection criterion employed by Omega re- moves from the set of attributes every attribute whose global inconsistence value is greater than an input threshold ?Gmax . Since the number of inconsistencies of the features is the factor that most contribute to disturb the learning algo- rithm, discarding the most inconsistent attributes can con- tribute to improve the accuracy and to speed up the learning algorithm.

3.3. Association Rule Mining  The IDEA method employs the Apriori algorithm [2] to mine association rules. The output of the Omega algorithm and the keywords of the report of the training images are submitted to the Apriori algorithm. A constraint, which re- stricts the diagnosis keywords to the head of the rules, is added to the mining process. The body of the rules is com- posed of indexes of the features and their intervals. The     values of minimum confidence are set to be high (greater than 97%). An example of rule mined in this step is:  4[0.1-0.3] ? malignant mass (0.05,1.0) This rule indicates that the images having the 4st feature value in the closed interval [0.1 ? 0.3] tend to be images of malignant masses. The values 0.05 and 1.0 indicate, re- spectively, the support and the confidence values of the rule.

The support of 0.05 indicates that 5% of the training images has the 4st feature value in [0.1 ? 0.3] and also are malig- nant mass. The confidence of 1.0 indicates that 100% of the training images which has the 4th feature value in interval [0.1? 0.3] are malignant masses. The mined rules are used as input of the ACE algorithm.

3.4. The ACE algorithm  Before discussing the ACE (Associative Classifier Engine) algorithm, it is necessary to clarify some terms. We say that an image matches a rule, if the image features sat- isfy the whole body of the rule. An image partially matches a rule, if the image features only satisfy part of the rule?s body. An image does not match a rule, if the image fea- tures do not satisfy any part of the rule?s body.

ACE is a new special classifier able to return multiple classes (keywords) when processing a test image. The ACE algorithm stores all itemsets (set of keywords) belonging to the head of the rules in a data structure. An itemset h is returned by ACE in the suggested diagnosis if the following condition is satisfied:  M(h) ? 1 and w = 3M(h)+P (h)3M(h)+P (h)+N(h) ? wmin where M(h) is the number of matches of the itemset h, P (h) is the partial number of matches, and N(h) is the number of no matches. w is the weight of the itemset. It in- dicates the strength that an itemset belongs to the diagnosis.

The higher the value of weight, the higher the confidence that h belongs to the diagnosis of the image. A threshold of minimum weight wmin(0 ? wmin ? 1) is employed to limit the weight of an itemset in the suggested diagnosis.

If wmin = 0, all itemsets that have at least one match is returned. Figure 2 shows an example of ACE working. In this example, M(h) = 1 , P (h) = 1 and N(h) = 1 for the itemset h = {benign}. Therefore, if 45 ? wmin, the item- set h = {benign} is returned by the algorithm, otherwise it is discarded.

Features 0.6 0.2 0.4  Feature vector   Image 1  Association RulesPartial Match  No match  match  benign1[0.5-0.7]  benign2[0.8-0.9]  benign3[0.3-0.7]  2[0.8-0.9]  3[0.1-02]  Figure 2. Example of ACE working.

This section presented our proposed method. As we will  show in the section of experiments, our proposed method is well-suited to suggest diagnoses for medical images, en- hancing and bringing more confidence to the diagnosing process.

4. Experiments  The experiments were performed employing 10% of the images from the datasets for testing and the remaining im- ages for training. The parameters of the Omega algorithm were set to Hmin = 2, ?max = 0.2 and ?Gmax = 0.3, which are tunning parameters of the algorithm. The parameters of the algorithms remained the same for both experiments.

The values of minimum support minsup=0.005 and confi- dence minconf=1.0 were used as Apriori input parameters.

The value wmin = 0, which maximizes the ACE accuracy, was employed as ACE input parameter.

4.1. Experiment 1 - the ROI Dataset  The ROI dataset consists of 446 images of ROIs (Re- gions of Interest) comprising tumoral tissues, taken from mammograms collected from the Breast Imaging Reporting and Data System of the Department of Radiology of Uni- versity of Vienna (www.birads.at). These ROIs were used to train new students of radiology. Each image has a di- agnosis composed of three main parts: morphology (mass or calcification), BI-RADS (Breast Imaging Reporting and Data System), and histology.

In the feature extraction step, the images were segmented and features of texture, shape and color were extracted from the segmented regions. The segmentation process were per- formed eliminating from the image the regions with gray- level smaller than 0.14 (in a gray-scale ranging [0-1]) and applying the well-known Otsu?s technique [8] to the resul- tant image. The features shown in Table 1 were extracted from the segmented regions and used to compose the fea- ture vector representation of the images.

Table 1. Features extracted from the ROI dataset and their positions  feature position average intensity, contrast 1-2 smoothness, skewness 3-4 uniformity, entropy 5-6 invariant moments 7 to 13 histogram mean, standard deviation 14-15  The Omega algorithm was applied to the image features, removing the 13th feature. It means that the 13th feature is the least differentiating feature for the ROI dataset. The out- put from Omega was submitted to Apriori algorithm where     662 rules were mined. The association rules generated and the test images were submitted to the ACE algorithm, which produced suggestions of diagnosis for each test image.

In a batch execution, the test images were submitted to the IDEA system and the accuracy obtained considering the main parts of the diagnosis (morphology and Bi-RADS) were: Morphology: 91.3%; BI-RADS value: 96.7%. Since BI-RADS categorization has a fuzzy separation among con- secutive levels, even for a human being, we considered cor- rect if the BI-RADS level suggested was the same or ad- jacent of the level annotated by the radiologist in the im- age report. This result indicates that the employed features represent more the BI-RADS level of the lesion, than the morphological properties of the images. Table 2 shows the values of accuracy, sensitivity and specificity achieved by IDEA in detecting the BI-RADS levels.

Table 2. Results achieved by IDEA in detect- ing the BI-RADS levels over the ROI dataset  Accuracy 96.7% Sensitivity 91.3% Specificity 71.4%  The system was also evaluated by two radiologists, who demonstrated a high degree of acceptance for it. They re- ported that the system had indicated lesions that they did not see in a first analysis. Figure 3 shows a screenshot of the system when analyzing the image on left of the screenshot.

The system shows the weight of each diagnosis keyword be- tween parentheses. The weight indicates the strength of the respective diagnosis part. The higher the weight, the higher the confidence that the keyword reflects the true diagnosis of the image.

Diagnosis suggested by the system  diagnosis given by the specialists, loaded from a report file  Figure 3. Screenshot of the IDEA system.

4.2. Experiment 2 - the Mammogram Dataset  The Mammogram dataset is composed of 1,080 mam- mograms collected in the Clinical Hospital of University of Sao Paulo at Ribeira?o Preto. The Mammogram dataset contains images classified in 4 levels of breast tissue den- sity: (1) mostly fatty (362 images); (2) partly fatty (446 im- ages); (3) partly dense (200 images); and (4) mostly dense (72 images). Figure 4 illustrates examples of the images of this dataset. Breast density is an important risk factor in the development of breast cancer. In this experiment, the images are represented by the feature set proposed in [7], compounding a vector of 85 features, including shape and size of the breast, the conditions of the breast contour; nip- ple position, and the distribution of fibroglandular tissue.

level 1 level 2 level 3 level 4  Figure 4. Examples of images from the Mam- mogram dataset. Images from left to right cor- respond, respectively, to mammograms of density levels 1, 2, 3 and 4.

The visual analysis of mammograms by radiologists is a subjective task and suffers from a high degree of variability.

Thus, it is a fair criterion to set as relevant not only the im- ages of the same density class of the query image, but also the images in the adjoining classes. This is the approach used in this paper. The same steps of the first experiment were performed in this experiment. In the training phase, Omega algorithm reduced 34% of the feature vector size, keeping only 56 of the original 85 features. Apriori mined 30,996 association rules. In the test phase, the association rules and the features of test images were submitted to the ACE algorithm. We measured the ability of IDEA in dis- tinguishing: (a) breast side ( right breast or left breast ); (b) type of the view (medio-lateral oblique or cranio-caudal); and, (c) density level. The values of accuracy obtained con- sidering these parts of the diagnosis were:  Side: 73.5%; View: 85.1%; Density: 94.8%.

Figure 5 shows a screenshot of the system when analyz-  ing the image on the left of the screenshot. Observe that the system suggests density 1 and 2 for the analyzed image.

However, density=2 gets a higher value of weight than den- sity=1, thus indicating that, most likely, the image is from     density=2 (which is the density of the image that is in the specialist?s report). The system can suggest more than one diagnosis hypotheses to the radiologists work on. How- ever, the hypotheses with a higher value of weight should be firstly considered by them.

Diagnosis suggested by the system  diagnosis given by the specialists, loaded from a report file  Figure 5. Screenshot of the IDEA system.

The results of the Experiments 1 and 2 are very promis- ing, because they show a very small error rate regarding the main part of the diagnosis (BI-RADS and density level for Experiments 1 and 2 respectively), making the system more reliable.

5. Conclusions In this paper we presented the IDEA approach based on  association rules to assist the specialists in the task of im- age diagnosing. IDEA encompasses four main steps: fea- ture extraction; feature selection and discretization; asso- ciation rule mining; and generation of diagnosis sugges- tions. Two new algorithms were developed to support the method: Omega and ACE. Omega executes two tasks in a single step: feature selection and supervised discretiza- tion. The ACE algorithm generates diagnosis suggestions by assigning multiple keywords to a test image. The re- sults of using real datasets show that the proposed method achieves high accuracy (up to 96.7%), being more sensitive than specific, what is desirable in medical domain. The ra- diologists demonstrated acceptance for the IDEA system, showing enormous interest in employing the system to aid them in their daily work. The IDEA method has an impor- tant characteristic that makes it different from other CAD methods: it can suggest multiple diagnosis hypotheses for the same image and employs a measure of quality to rank them. The results indicate the proposed method is very suit- able for the task of suggesting diagnosis of medical images, enhancing and bringing more confidence to the diagnosing process.

