A Sequential Approach to Market State Modeling and Analysis in Online P2P Lending

Abstract?Online peer-to-peer (P2P) lending is an emerging wealth-management service for individuals, which allows lenders to directly bid and invest on the listings created by borrowers without going through any traditional financial intermediaries.

As a nonbank financial platform, online P2P lending tends to have both high volatility and liquidity. Therefore, it is of sig- nificant importance to discern the hidden market states of the listings (e.g., hot and cold), which open venues for enhancing business analytics and investment decision making. However, the problem of market state modeling remains pretty open due to many technical and domain challenges, such as the dynamic and sequential characteristics of listings. To that end, in this paper, we present a focused study on market state modeling and analysis for online P2P lending. Specifically, we first propose two enhanced sequential models by extending the Bayesian hid- den Markov model (BHMM), namely listing-BHMM (L-BHMM) and listing and marketing-BHMM (LM-BHMM), for learning the latent semantics between listings? market states and lenders? bidding behaviors. Particularly, L-BHMM is a straightforward model that only considers the local observations of a listing itself, while LM-BHMM considers not only the listing information but also the global information of current market (e.g., the competi- tive and complementary relations among listings). Furthermore, we demonstrate several motivating applications enabled by our models, such as bidding prediction and herding detection. Finally, we construct extensive experiments on two real-world data sets and make some deep analysis on bidding behaviors, which clearly validate the effectiveness of our models in terms of dif- ferent applications and also reveal some interesting business findings.

Manuscript received October 21, 2015; revised September 3, 2016; accepted January 21, 2017. This work was supported in part by the National Key Research and Development Program of China under Grant 2016YFB1000904, in part by the National Science Foundation for Distinguished Young Scholars of China under Grant 61325010, and in part by the National Natural Science Foundation of China under Grant U1605251, Grant 61672483, and Grant 61532006. The work of Q. Liu was support by the Youth Innovation Promotion Association of CAS under Grant 2014299. This paper was recommended by Associate Editor F. Wang. (Corresponding author: Qi Liu.)  H. Zhao, Q. Liu, E. Chen, and Y. Zhu are with the School of Computer Science and Technology, University of Science and Technology of China, Hefei 230026, China (e-mail: zhhk@mail.ustc.edu.cn; qiliuql@ustc.edu.cn; cheneh@ustc.edu.cn; zhuyan90@mail.ustc.edu.cn).

H. Zhu is with Big Data Laboratory, Baidu Research, Beijing 100085, China (e-mail: zhuhengshu@baidu.com).

Y. Ge is with the Eller College of Management, University of Arizona, Tucson, AZ 85721 USA (e-mail: yongge@email.arizona.edu).

J. Du is with the School of Computer Science, Beijing University of Posts and Telecommunications, Beijing 100876, China (e-mail: junpingd@bupt.edu.cn).

Color versions of one or more of the figures in this paper are available online at http://ieeexplore.ieee.org.

Index Terms?Bayesian hidden Markov model (BHMM), bidding behaviors, market state, peer-to-peer lending.



I. INTRODUCTION  RECENT years have witnessed the rapid developmentand prevalence of online peer-to-peer (P2P) lending platforms, such as Prosper1 and LendingClub.2 As an emerg- ing wealth-management service for individuals, P2P lending allows individuals to directly borrow and lend money from one to another without going through traditional financial intermediaries. Indeed, P2P lending has become a fast grow- ing investment market with more than 100% year over year growth.3 For instance, LendingClub announced its total loan issuance amount had reached more than US $13.4 billion at the end of 2015.

In P2P lending market, there are two main kinds of roles: 1) the borrowers who want to borrow money from others and 2) the lenders who lend money to borrowers. Trading in this market follows the Dutch Auction Rule [1], [2]. Specifically, for borrowing money, the borrower will first create a listing to solicit bids from lenders by describing herself and the reason of borrowing money (e.g., for wedding). Then, if a lender wishes to invest on this listing within its soliciting duration (e.g., one week), a bid is created by her describing how much money she wants to invest (e.g., $50) and the minimum rate.

Finally, the listings which can receive enough money in time will turn to loans and begin the repayment periods. Otherwise, all the previous investments on these listings will be canceled.

In the literature, the rapid prevalence of P2P lending has triggered many important research problems, such as listing quality or borrower credit evaluation [3]?[5], bidding behav- iors analyzing [6]?[8], and loan funding prediction [9], [10].

Unfortunately, the problem of modeling market states of listings (e.g., hot and cold) is still under-explored. Indeed, discerning market state is critically important due to the high volatility and liquidity of online P2P lending. At the micro level, market state modeling can help borrowers monitor the listing popularity and present better listings. Meanwhile, it also can help lenders understand the listings more clearly and make better investment decision, e.g., quick investment, avoiding  1https://www.prosper.com/ 2https://www.lendingclub.com/ 3http://techcrunch.com/2012/05/29/peer-to-peer-lending-crosses-1-billion-  in-loans-issued/  See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

mailto:zhhk@mail.ustc.edu.cn mailto:qiliuql@ustc.edu.cn mailto:cheneh@ustc.edu.cn mailto:zhuyan90@mail.ustc.edu.cn mailto:zhuhengshu@baidu.com mailto:yongge@email.arizona.edu mailto:junpingd@bupt.edu.cn http://ieeexplore.ieee.org https://www.prosper.com/ https://www.lendingclub.com/ http://techcrunch.com/2012/05/29/peer-to-peer-lending-crosses-1-billion-in-loans-issued/ http://techcrunch.com/2012/05/29/peer-to-peer-lending-crosses-1-billion-in-loans-issued/ http://www.ieee.org/publications_standards/publications/rights/index.html   This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

bidding failure, herding [7], [11], [12], or serious competi- tion [7]. Moreover, at the macro level, market state modeling can be used for enhancing market management, such as listing recommendation and listing shelves guidance. However, there are many technical and domain challenges on market state modeling. First, how to capture the dynamic and sequential characteristics of market state is not trivial. Second, how to construct and mine the relevance between the lenders? bidding behaviors and the hidden market states is another open ques- tion. At last, how to capture the market information/situation for a listing is also worth exploring, e.g., although a listing was hot in the previous periods, it may suffer from the emerg- ing competition when the market changes and then turn to a cold state.

To address the above challenges, in this paper, we present a focused study on market state modeling in P2P lending by extending Bayesian hidden Markov model (BHMM) with dif- ferent domain assumptions. Specifically, we first model the dynamic and sequential characteristic of market state using the Markov chain structure. Here, we assume that the market state of a listing is influenced by its own properties, and its cur- rent state is only determined by its previous one state. Based on this assumption, we propose a listing-BHMM (L-BHMM) model for modeling market state. Also, real-world findings reveal that market state may be influenced by the market sit- uation. Therefore, we further design a more comprehensive model named listing and marketing-BHMM (LM-BHMM) for the holistic consideration. In this way, both L-BHMM and LM-BHMM could model the listings by connecting the hid- den market states of listings and the bidding behaviors of lenders. Furthermore, we demonstrate two motivating finan- cial applications enabled by market state modeling, namely bidding prediction and herding detection. Finally, extensive experiments based on two real-world data sets clearly validate the effectiveness of our models in terms of different applica- tions, and reveal some interesting business findings on bidding behaviors. To the best of our knowledge, this is the first comprehensive study on market state modeling in online P2P lending. This paper, we hope, will be helpful for enhancing P2P lending services, such as bidding prediction, investment decision making, and market management.

Overview: The remainder of this paper is organized as fol- lows. In Section II, we formulate the research problem and introduce the construction of observations from bidding behav- iors and market information. In Section III, we show the details of our proposed models (L-BHMM and LM-BHMM) and the applications of market state modeling. Section IV presents the experimental results and some findings from deep analysis.

Finally, we briefly introduce the related works and conclude our work in Sections V and VI.



II. PRELIMINARIES  In this section, we first introduce the research problem of market state modeling and then present the details of con- structing observations from lenders? bidding behaviors and market information. For facilitate illustration, Table I lists the mathematical notations used in this paper.

TABLE I MATHEMATICAL NOTATION  Fig. 1. (a) Listings in P2P lending. (b) Market states (manually labeled) of corresponding listings.

A. Problem Statement  In P2P lending, a listing is the predecessor of a loan, only if this listing could receive enough money within the solicit- ing duration (e.g., one week). Fig. 1(a) shows an illustration of several real listings from Prosper, one of the largest P2P lending platforms in America. From this figure, we can obtain some basic properties and descriptions of a listing that are given by the borrower, e.g., the loan category/purpose (e.g., Business), the required amount (e.g., $15 000.00), and the rate (e.g., 16.98%). Meanwhile, we can observe some dynamic information of a listing from the incremental lenders? bid- ding behaviors, such as the current funded amount (e.g., 92% funded) and the remaining time (e.g., 12 day 21 h 46 min).

One step further, the local dynamic information of each indi- vidual listing will make up the global information of the entire market. From these observations in Fig. 1, we could learn that the first two listings are much more popular (hotter) than the last one. As the first two listings have received most of the required bids with a long remaining time while the last one has only received small amount of bids with a short remaining time. That is, if properly modeled, this observed information could reflect the hidden market state of a listing. For example, the current probable hidden market states (manually labeled) of the listings are shown in Fig. 1(b). In summary, in this paper, we aim to automatically detect and model such hidden market states for listings through the observations of lenders? bidding behaviors and the market situation. Meanwhile, we will further apply the learned market states for developing some important financial applications. Here, we formally define the problem of market state modeling as follows.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

ZHAO et al.: SEQUENTIAL APPROACH TO MARKET STATE MODELING AND ANALYSIS IN ONLINE P2P LENDING 3  Definition 1 (Market State Modeling): Given a set of list- ings L, in which each listing l ? L has a sequence of historical observations, e.g., bid observations and market observations (defined in Section II-B). The problem of market state mod- eling is to learn a model from all the observation sequences, which can be used for predicting or detecting the listings? market states or observations in the future.

B. Observation Construction  As the above description, the market state is dynamic and sequential, i.e., the market state of a listing may change every day in its soliciting duration and correspondingly we may observe different observations in different timestamp.

Thus, in this section, we introduce how to construct granu- lometric observations for modeling the hidden market states of listings, i.e., construct bid observation by leveraging the bidding behaviors, and construct the market observation using the holistic market information.

1) Bid Observation: In this paper, the lenders? bidding behaviors on listings are one of the most important dynamic information, which reflect the lenders? current acceptance degree to these listings. During the auctions, listings with hot- ter states will receive more bids while colder listings receive fewer bids. Thus, we can adopt the average bidding amount of each period (e.g., one day) as the main observation. However, for different listings, the length of the entire duration for solic- iting bids and the totally required amount are also different.

Thus, it is appealing to define and construct the comparable bid observations for all the listings. In this paper we define the bid observation as follows.

Definition 2 (Bid Observation): A bid observation Ot in period t of a listing with totally required amount A and entire soliciting duration P, is equal to Ot = ?? (P/A), where ? is the average bidding amount during period t.

In the above definition, we use P/A for eliminating the effects of required amounts and soliciting durations of differ- ent listings. In this way, the bid observations are comparable for different listings, and they could be applied to model the market state of listings.

2) Market Observation: Besides the lenders? bidding infor- mation, the holistic market information is also very helpful for market state modeling. For instance, a high-risk listing which suffers from a cold state may transfer to a hot state when the market situation is beneficial for it, e.g., many comple- mentary (low-risk) listings appear in the market. In contrast, it may stay cold if there are too many similar/competitive (high-risk) listings at that time [7]. This kind of influence from market information to the listing states does exist because of the investment composition effect in economic field or P2P lending. Specifically, the rational lenders have the portfolio perspective [13] in their minds, and they would like to opti- mize their portfolio by investing several listings with different risk values. As a result, the complementary listings of a listing can promote the acceptance degree of lenders to this listing, and vice versa. According to existing studies in the fields of economics and biology, the relations of goods (i.e., list- ings in this paper) in a market are mainly determined by their similarities [14], [15]. Thus, we construct the market observation as follows.

Definition 3 (Market Observation): A market observation Mt in period t of a listing l is defined as the average simi- larity between l and other listings in the market in period t.

Specifically, Mt = Sim(l,?l) = (1/|?l|)?l???l Cos(l, l?), where ?l are the listings in their soliciting bid durations at time t except listing l.

In mature P2P lending platforms, e.g., Prosper, hundreds of listings are soliciting bids at the same time every day, so that it is pointless to consider all the other listings when calcu- lating the market observations for a specific listing. In fact, for a given listing l, the most influential listings to l are those with nearest auction durations. Thus, in practice, we use the nearest neighbor (e.g., 20) listings with similar start time to construct set ?l for l. In the following, we show how to com- pute the cosine similarity between two listings, i.e., Cos(l, l?).

In P2P lending market, return and risk are two most impor- tant aspects for assessing a listing [16], [17]. Thus, motivated by the method in [17], the listing profile can be represented as a two-element vector  ?? Pl = [Pl, Rl], where the first term  is the expected return which is a given value and the sec- ond term is the estimated risk. Here, we use the lend rate declared by borrower in the soliciting duration of a listing as the expected return term, and meanwhile, adopt a logistic regression model to estimate the risk value for each listing.

The logistic regression model is widely used in risk assessment due to its simplicity and relatively high performance [3], [17].

More detailed information about the computation of Pl and Rl, which are the same with those in [16] and [17], are omitted due to the limited space. Finally, the cosine similarity of two listings in the market observation can be calculated by  Cos ( l, l?  ) = PlPl? + RlRl?? P2l + P2l?  ? R2l + R2l?  . (1)  Based on Definitions 2 and 3, the variables of bid observa- tions and market observations for each listing in any periods could be computed, and then, they will be used for modeling the listings? market states.

3) Observation Segmentation: According to the definitions of bid observation (Ot) and market observation (Mt), these observations are continuous numerical variables. If we directly take the original observations into model training, the conver- gence may be very difficult to guarantee since the granularity of observations is too fine and chaotic. Thus, we propose an information gain based method [18], [19] to preprocess the original continuous numerical variables into discrete inter- val variables/segments. Here, we take the segmentation of bid observations as an example, and the market observations could be processed in the same way. Specifically, the information entropy of the observation interval/segment OS is given by  Ent (  OS )  = ? ? ?OS  ? ?  ?  i=1 pilog(pi) (2)  where |OS| is the number of observation subsegments in seg- ment OS, and pi is the proportion of subsegment OPi , i.e., number of observations in this subsegment divided by the total number of observations in OS. The segment process is con- ducted as follows. First, we rank the observations of all the    This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

listings in each period (e.g., in every day) based on their orig- inal values. Second, all the sorted observations are viewed as a big initial segment and we partition it into several subseg- ments in a recursive binary way. In each iteration, we use the weighted average entropy (denoted as WAE) to find the best split position  WAE (  i; OS )  = ? ?OS1(i)  ? ?  ? ?OS  ? ?  Ent (  OS1(i) )  + ? ?OS2(i)  ? ?  ? ?OS  ? ?  Ent (  OS2(i) )  (3)  where OS1(i) and O S 2(i) are two subsegments of segment O  S  when being split at the ith observation. The best split position indicates a maximum information gain given by ?E(i) which is equal to Ent(OS) ? WAE(i; OS).

After the segment process, original bid observations and market observations of all the listings in each period are processed into discrete intervals according to the observation values. Now, we can take these segment intervals as our new observable variables. Without loss of generality, the observa- tions mentioned in the rest of this paper are all the discrete intervals after segment.



III. MARKET STATE MODELING  In this section, we present the details of our approach to market state modeling. Specifically, we first propose two spe- cific models to connect the hidden states of listings and the bidding behaviors of lenders. Then, we introduce two appli- cations enabled by market state modeling, namely, bidding prediction and herding detection.

A. L-BHMM Model  Here, we propose the first model named L-BHMM to model the market state in P2P lending. The basic assumption about the state dependency in L-BHMM is as follows.

Assumption 1: The current market state of a listing is only determined by the previous one state of this listing.

The above assumption indeed follows the first-order Markov property, which indicates that the market state of a list- ing only depends on its previous lenders? acceptance degree.

This assumption is straightforward and easy to think of.

Indeed, the first-order Markov property has been referred and demonstrated in previous relevant works, e.g., stock market state [20], [21], recruitment market [22], and even collective evolution inference in P2P lending network [23]. Following this assumption, we apply the first-order Markov chain struc- ture to listing state modeling. Further, as a variation of the classical Hidden Markov Model, the robustness and scalability of BHMM in modeling sequential data with external knowl- edge have been well proved in previous studies [24], [25]. To that end, we also propose to leverage BHMM for modeling market state by considering the sequential and dependency characteristics of bidding behavior information. Specifically, L-BHMM has the same structure of a standard bi-gram Hidden Markov Model which contains Dirichlet priors over transition and emission distributions for modeling the sequential list- ing records (i.e., bid observation). Fig. 2 shows the graphical representation of L-BHMM model, where St is the market  Fig. 2. Graphical representation of L-BHMM.

state in period t, and Ot is the bid observation in period t.

Please note that, we assume that state transition and observa- tion emission of all listings share the same distributions ? and ?, respectively.

The parameterizations of L-BHMM are as follows:  St|St?1,? ? Mult ( ?St?1  )  Ot|St,? ? Mult ( ?St  )  ?St?1 |? ? Dirichlet(?) ?St |? ? Dirichlet(?)  where St|St?1,? ? Mult(?St?1) means the current state St follows multinomial distribution Mult(?St?1) given the previ- ous state St?1 and ?; and Ot|St,? ? Mult(?St) means the current bid observation Ot follows multinomial distribution Mult(?St) given the current state St and ?. ? is the state tran- sition distribution and ? is the output emission distribution of the bid observations on the market state. Particularly, both ? and ? follow the Dirichlet distributions with parameter ? and parameter ?.

The generative process of L-BHMM is as follows. First, a prior transition distribution of listing?s market state (i.e., ? ) is generated from a prior Dirichlet distribution ?. Similarly, a prior output distribution of bid observations (?) is gener- ated from a prior Dirichlet distribution ?. Second, a listing state St is generated from distribution ?t?1 with respect to the previous listing state St?1. Finally, a bid observation Ot is gen- erated from distribution ?St with respect to the listing?s current market state St.

Given the hyperparameters ? and ? in this generative model, we can calculate the joint distribution of L-BHMM by the following:  P(Ot, St,?,?|St?1, ?, ?) = P(?|?)P(?|?)P(St|St?1,?)P(Ot|St,?) = P(?|?)P(?|?)P(St|St?1, ?St?1  ) P ( Ot|St, ?St  ) . (4)  Therefore, the likelihood of a set of records R can be calculated as follows4:  L(R) = ? K?  k=1 P(?k|?)  |R|?  t=1 P ( St|St?1, ?St?1  ) d?  ? ? K?  k=1 P(?k|?)  |R|?  t=1 P ( Ot|St, ?St  ) d?. (5)  4R represents all the listings. For convenient writing, we use a same notation t to represent the sequences of all listings.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

ZHAO et al.: SEQUENTIAL APPROACH TO MARKET STATE MODELING AND ANALYSIS IN ONLINE P2P LENDING 5  The objective of training L-BMMM is to learn the proper hidden variables ? and ? to maximize the likelihood function in (5). However, the likelihood function is complicated which is not easy to calculate directly. In this paper, we adopt the Gibbs sampling method [26], [27], a form of Markov chain Monte Carlo, to estimate the parameters. Given parameters ? and ?, the training process begins with a random assignment of market states to all bid observations for initializing the state of Markov chain. In each iteration, the method will re-estimate the conditional probability by assigning a market state to each bid observation, which is conditioned by the assignment of all other observations except the current one. Then, according to the conditional probabilities, a new assignment of observation to listing state will be updated as a new market state of the Markov chain. Finally, after enough iterations, the assignment will converge and every bid observation is assigned to a stable market state.

According to the Gibbs sampling rule, we need to calculate the conditional distribution P(St = k|S?t, R), where S?t means the market states for all bid observations except Ot. It should be noted that, in L-BHMM, records R only contain the bid observation sequence O = (O1, O2, . . .). The parameter of state transition distribution ? is K ? K dimension and output emission distribution ? is K ?J dimension. We can derive the conditional distribution as follows:  P(St|S?t, R) ? P(St, S?t, R) = P(R|St, S?t)P(St|S?t)P(S?t) = P(R|St, S?t)P(St|S?t)P  ( St+1, S?(t,t+1)  )  = P(R|St, S?t)P(St|S?t)P ( St+1|S?(t,t+1)  ) P ( S?(t,t+1)  )  ? P(R|St, S?t)P(St|S?t)P ( St+1|S?(t,t+1)  )  = P(Ot|St, S?t,??t)P(??t|St, S?t)P(St|S?t) ? P(St+1|S?(t,t+1)  )  = P(Ot|St, S?t,??t)P ( ??t |S?t  ) P(St|S?t)  ? P(St+1|S?(t,t+1) )  ? P(Ot|St, S?t,??t)P(St|S?t)P ( St+1|S?(t,t+1)  )  where ? is the set of all the bid observations in R, and ??t means removing bid observation Ot from R. We calculate the three multipliers in (6), respectively, and the final result are as follows5:  P(St = k|S?t, R) ? n?t,St,Ot + ?Ot?J  j=1 n?t,St,j + ?j ? n?t,(St?1,St) + ?St?K  k?=1 n?t,(St?1,k?) + ?k?  ? n?(t,t+1),(k,St+1) + I(St?1 = k = St+1) + ?St n?(t,t+1),k + I(St?1 = k) + ?Kk?=1 ?k?  (6)  where n?t,St,j is the number of the jth bid observation in bid records except the tth record with assignment market state k, n?t,(St?1,k?) is the number of the previous states are St?1 and current states are assigned to k? in all records except the tth record, n?(t,t+1),(k,St+1) is the number of current states are assigned to k and the next states are St+1 in all records except  5We omit the detailed derivation due to the limited space.

in the tth record and (t + 1)th record, and I(x) is an indicator function whose value is 1 when x is true and 0 otherwise.

After enough rounds of iteration, the assignment will con- verge, thus, we can estimate the parameters ? and ? by  ?St?1,k = nSt?1,k + ?k? k? nSt?1,k? + ?k?  , ?St,j = nSt,j + ?j? j? nSt,j? + ?j?  (7)  where nSt?1,k is the number of current market states that are assigned to k and the previous states are assigned to St?1, nSt,j is the number of current state that equals St and the bid observation is j.

In summary, in L-BHMM, we only take use of the bid obser- vation to estimate the transitions of market state (i.e., ?) and the observation emission (i.e., ?). In the next section, we will introduce another more comprehensive model which consid- ers both the bid information and the market information for listing?s market state modeling.

B. LM-BHMM Model  As illustrated in Assumption 1, L-BHMM indicates that each market state is only dependent on the previous acceptance degree from lenders to this specific listing. That is, the listings with hot state are more likely to be hot and listings with cold state are more likely to be cold in the future. However, in P2P lending, the market state of one listing may be also influenced by the market situation, e.g., a listing which suffers from a cold state may transfer to a hot state when many complemen- tary listings appear in the market. Thus, in this section, we propose a more reasonable assumption for the state depen- dency of listings. Then, based on the proposed assumption, we show the details of the proposed LM-BHMM for market state modeling.

Assumption 2: The current market state of a listing is deter- mined by both its previous state and the current market situation.

In other words, for modeling the market state of a given list- ing, Assumption 1 only considers the previous observation of this listing while Assumption 2 also considers the global obser- vations of some other listings in a given period of the market.

Based on Assumption 2, we design the LM-BHMM for mar- ket state modeling. Specifically, Fig. 3 shows the graphical representation of LM-BHMM. We can see that, compared to Fig. 2, one more observed variable Mt, which denotes the mar- ket observation in period t, also influences the listing market state St. LM-BHMM is more comprehensive and an extension of L-BHMM.

Similarly, the parameterizations of LM-BHMM are  St|St?1, Mt,? ? Mult ( ?St?1,Mt  )  Ot|St,? ? Mult ( ?St  )  ?St?1,Mt |? ? Dirichlet(?) ?St |? ? Dirichlet(?)  where St|St?1, Mt,? ? Mult(?St?1,Mt) means the current state St follows multinomial distribution Mult(?St?1,Mt) given previous state St?1, current market observation Mt and state transition distribution ?. Please note that, different from L-BHMM, the parameter of the state transition distribution    This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

Fig. 3. Graphical representation of LM-BHMM.

? is K ? K ? H dimension in LM-BHMM, i.e., the cur- rent state of a listing is determined by both the previous state and current market situation observation of this listing. Thus, in the training of LM-BHMM, the record set R contains not only the bid observations O = (O1, O2, . . .) but also the mar- ket observations M = (M1, M2, . . .). The generative process of LM-BHMM is similar to that of L-BHMM except for the state transition. Specifically, state St is generated from ?St?1,Mt with respect to the previous state St?1 and current market observation Mt.

Given the hyperparameters ?, ? in this generative model, we can calculate the joint distribution of LM-BHMM by the following:  P(Ot, St, Mt,?,?|St?1, ?, ?) = P(?|?)P(?|?)P(St|St?1, Mt,?)P(Ot|St,?) = P(?|?)P(?|?)P(St|St?1, Mt, ?St?1,Mt  ) P ( Ot|St, ?St  ) . (8)  Thus, the likelihood of a set of records R can be calculated  L(R) = ? H?  h=1  K?  k=1 P ( ?h,k|?  ) |R|?  t=1 P ( St|St?1, Mt, ?St?1,Mt  ) d?  ? ? K?  k=1 P(?k|?)  |R|?  t=1 P ( Ot|St, ?St  ) d?. (9)  Similar to (6), we can calculate the conditional distribution P(St = k|S?t, R) of LM-BHMM as follows:  P(St|S?t, R) ? P(Ot|St, S?t,??t)P(St|S?t, Mt)P  ( St+1|S?(t,t+1)  ) . (10)  One step further, it could be represented by  P(St = k|S?t, R) ? n?t,St,Ot + ?Ot?J  j=1 n?t,St,j + ?j ? n?t,(St?1,Mt,St) + ?St?K  k?=1 n?t,(St?1,Mt,k?) + ?k?  ? n?(t,t+1),(k,St+1) + I(St?1 = k = St+1) + ?St n?(t,t+1),k + I(St?1 = k) + ?Kk?=1 ?k?  . (11)  Indeed, the main difference between (6) and (11) lies in the second multiplier, where n?t,(St?1,Mt,St) is the number of market states that are assigned to state St when the corre- sponding market observation is Mt and previous listing states are assigned to state St?1 in all the records R except for the tth one. Finally, the observation emission ? is computed the  same as those in L-BHMM, while the transitions of listing state ? can be estimated as follows:  ?(St?1,Mt),k = n(St?1,Mt),k  ?K k?=1 n(St?1,Mt),k? + ?k?  . (12)  Indeed, in L-BHMM and LM-BHMM, we leverage the con- struction of Markov Chain to connect the observable variables (i.e., bid observation and market observation) extracted from lenders? bidding behaviors to the hidden market states of list- ings. Thus, our models can be applied to some applications related to the analysis of lenders? bidding behaviors.

C. Applications  In this section, we present two specific motivating appli- cations enabled by market state modeling, namely bidding prediction and herding detection.

1) Bid Observations Prediction: One straightforward appli- cation of market state modeling for listings are to predict the future bid observations in P2P lending market. Specifically, for a target listing ?, we have observed a sequence of bid observations O? = (O?1, . . . , O?t ) and a sequence of market observations M? = (M?1 , . . . , M?t ). We can estimate the market state for each bid observation O?i (0 ? i ? t) by  P ( S?i |O?, M?,?,?  ) ? P(O?i |S?i ,? ) P ( S?i |M?i ,?  ) (13)  which can be computed by the Viterbi Algorithm [28]. Then, we could predict the (t+1)th bid observation as follows:  P ( O?t+1 = O|S?t ,?  ) = ?  S?t+1=S? P ( S?|S?t , M?t+1,?  ) P ( O|S?,?).

(14)  Particularly, for the observations that does not have previous ones, we set the transition probabilities equally. By mod- eling the listing?s market state, we can predict the future bid observations for a listing. One step further, some other specific applications could also be implemented. Here, we introduce a specific application which is related to the herding phenomenon in P2P lending [7], [12].

2) Herding Detection: In P2P lending market, when lenders make their investment decisions on listings, they may bid together on a few listings without rational investment deci- sions, but just follow the herd and ignore most of the remaining listings. Thus, some popular listings often receive massive biddings while some other listings receive scarce biddings.

This is called as the herding phenomenon [7], [11], [12].

Although this phenomenon has been widely observed, the sci- entific literature on this topic is still limited, and even a clear definition of herding is lacking.

Generally, we think of two ways to detect herding. In the first way, we could view herding as a phenomenon that the bidding amount received in a period is much more than a specific threshold value ? . For instance, we can define the threshold as ? = ? ? (A/P), where A is the totally required amount of this specific listing, P is its entire soliciting duration, and ? is a manually given parameter. However, it is not easy to manually define the value of threshold. Thus, we adopt another way of herding detection. Specifically, we first estimate the    This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

ZHAO et al.: SEQUENTIAL APPROACH TO MARKET STATE MODELING AND ANALYSIS IN ONLINE P2P LENDING 7  Fig. 4. Percents of listings and bids in different categories. (a) Listings versus fund results. (b) Bids versus bidding results.

market states and bid observations of listings for a following period of time [i.e., by (14)]. Then, we rank all the listings based on their estimated bid observation values, and select top Num listings as the most suspicious listings that may involve in herding phenomenon.



IV. EXPERIMENTS  In this section, we evaluate our models on two large- scale real-word data sets and make some deep analysis about bidding behaviors from the experimental results.

A. Experimental Data  The original data set was downloaded from Prosper.com,6  which contains all the records in this platform from November, 2005 to the end of May, 2011. Readers can also find the data from this URL.7 From this data set, we selected three tables that are relevant to market state modeling. Specifically, Bid table contains the timestamp and the amount of money that lenders bid for each listing. These records are the basis used to construct bid observations. Listing table contains the basic properties or descriptions of listings. LoanPerformance table records the performances (i.e., repay in time or default) of listings. The records in Listing and LoanPerformance tables are used to train the risk prediction model, and then construct listing profiles and market observations (i.e., Section II-B).

Fig. 4 shows the percent of listings with different fund results and the percent of bids with different bidding results. In Fig. 4(a), only about 10% of listings (completed) could receive enough bids in the soliciting durations, and about 53% of list- ings fail to be fund in time (expired) and 34% of listings are withdrawn by the borrowers and 3% of listings are canceled by the Propose system for some reasons. In Fig. 4(b), only about 66% of bids will succeed (Winning) and about 33% of bids fail, i.e., they are outbid by others. Intuitively, lots of listings receive excessive bids or even cause herding phenomenon. In contrast, some other listings are not appealing enough to be invested on and they will fail to turn into loans. From the above statistical results we could summarize that the bidding performance are quite different among listings, and it is nec- essary to model market state for listings and better understand the lenders? bidding behaviors.

Considering the listing profiles vary a lot, we extracted two subdata sets from the original data for experiments, where the  6https://www.prosper.com/tools/DataExport.aspx 7http://home.ustc.edu.cn/%7Ezhhk/DataSets.htm  TABLE II STATISTICS OF EXPERIMENTAL DATA SETS  Fig. 5. Scatter plot of listing profiles. (a) Data set 1. (b) Data set 2.

listings in each data set have the similar soliciting duration and amount of required money. Table II shows the basic statistics of these two data sets. The soliciting durations of these listings are 7 days, 10 days, or 14 days. The required amount of the listings in the first data set is around $10 000 and the required amount of the listings in the second data set is in the range of [$20 000, $25 000]. Actually, the two data sets contain more than 51.5% bid records of the original data set.

B. Experimental Setup  In experiments, we adopt fivefold cross-validation, and in each round, we randomly sampled 20% of data from each data set for test and the remaining 80% were used for training.8  Without loss of generality, we set the bid observation segment number as 32 (i.e., J = 32), the market observation segment number as 4 (i.e., H = 4), and the number of hidden market states as 16 (i.e., K = 16) for both L-BHMM and LM-BHMM.

The time granularity is set to 1 day for each period, i.e., we record the observations in each day. The initial probabilities are set as 1/K for all states.

C. Experimental Results  In the next, we will report the experimental results.

Specifically, we demonstrate: 1) results and findings in the preprocess; 2) the bid prediction performance of our approaches; 3) efficiency results on model training and test processes; 4) case studies that exploit LM-BHMM on herding detection and state modeling; and 5) some deep analysis results of bid observation and application on macroscopic market.

1) Preprocess Results: Here, we first introduce the results of observation construction. For bid observations, we obtain the bidding amount for each listing everyday and then run the segment process. For market observations, we first profile each listing with respect to return and risk, then calculate the orig- inal market observation value based on the cosine similarity and run the segment process at last.

8Please note that, the sequentiality is for each listing not for all listings.

Thus, we can construct cross-validation via different listing selections.

https://www.prosper.com/tools/DataExport.aspx http://home.ustc.edu.cn/%7Ezhhk/DataSets.htm   This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

Fig. 6. Distribution of observations. (a) Bid observation. (b) Market observation.

Fig. 5 shows the scatter plot of randomly sampled listing profiles with regard to their returns and risks. We can see that the positive correlations (i.e., Pearson correlation coefficients of two data sets are: 0.733 and 0.711)9 between each listing?s expected return and estimated risk. These results are consis- tent with the reported results in [17]. We can also observe that listing profiles are different, e.g., some listings have low risks and low returns while some have high risks and high returns. Note that, the listings with similar profiles are com- petitive and the different listings are complementary. Fig. 6 shows the distribution of number of listings with respect to different observations after segment process. From these two subfigures we can see that the segment process can divide the original numerical variables into interval variables evenly for both bid observation and market observation.

2) Effectiveness of Prediction: In this section, we vali- date the effectiveness of our models in terms of predicting bid observations. For LM-BHMM and L-BHMM models, we adopt the famous Viterbi Algorithm [28] for prediction.

Specifically, for each test sequence, we randomly select the first N (N ? [1, len ? 1], where len is the sequence length of the test listing) observation records for fitting models, and use the (N+1)th bid observation as the ground truth for evaluation.

Baselines: To the best of our knowledge, there are no exist- ing works on market state modeling in P2P lending. We exploit two baselines in this part of experiment. The first baseline is denoted as Pre, which takes the previous bid observation as the prediction result. The second baseline is Logistic regres- sion (denoted as Reg), which is widely used in time series predictions [29]. Reg takes input the first N observations and output the (N+1)th bid observations.

Metrics: We adopt two famous metrics in the information retrieval field to evaluate the accuracy of prediction results. The first metric is the hit rate (HR) [30] and the second is the root mean square error (RMSE). Their definitions are as follows:  HR = ?NT  i=1 I(pi = ti) NT  ,  RMSE = ? ? ? ?  NT?  i=1 (pi ? ti)2/NT (15)  where NT is the number of test sequences, pi is the predicted value of the (N+1)th bid observation in the ith test sequence  9We used more listing properties (e.g., isHomeOwner, bankAccount) than those used in [17] to learn the risk prediction model.

TABLE III RUNNING TIME (S)  and ti is the true value of the (N+1)th test bid observation in this sequence. I(x) is an indicator function whose value is 1 when x is true and 0 otherwise.

The results of cross-validation are shown in Fig. 7.

Specifically, Fig. 7(a) and (b) are the results under HR met- ric, which are the larger the better. From the HR results, we can see that LM-BHMM obtains the largest HRs (i.e., outper- forms about 0.02-0.03 than L-BHMM and Reg) on both data sets, while L-BHMM and Reg perform similarly under HR metric. Fig. 7(c) and (d) are the results under RMSE metric, which are the smaller the better. From these results, we can see that LM-BHMM can obtain the smallest RMSE values (i.e., outperforms about 0.3?0.5 than L-BHMM and Reg) on both the two data sets. Also, on the second data set, L-BHMM model performs better than Reg. These results clearly vali- date the prediction effectiveness of our models, especially the sophisticated model LM-BHMM.

In the above experiments, we input the first N observation records for fitting models and use the (N+1)th bid observation as ground truth for evaluation. Indeed, it is also necessary to evaluate the effect of sequence length on prediction per- formances of different models. For better comparison, in this part of experiment, we only compare the performances of three models on the listings with the same sequence length (7 days), and the results are shown in Fig. 8. Here, all the results are the average HR and RMSE values obtained by five-fold cross- validation. First, we can see that the LM-BHMM performs best all the time which demonstrates the prediction perfor- mance and robustness of LM-BHMM. Second, these figures show the overall prediction accuracy trends, i.e., the HR val- ues increase and the RMSE values decrease with the growing of the input sequence length. The results indicate that the longer sequence length contains more information on the list- ing dynamics, and thus, the models could capture the sequence dependence of states more accurately. However, please note that, an interesting finding is that HR values decrease and RMSE values increase when the length reaches to the largest value (i.e., the sequence length is 6). In other words, it is more difficult to predict the bidding in the end of soliciting duration.

The reason for this finding will be explained in the section of bid observation analysis.

3) Efficiency Results: In experiments, all the methods are performed on the same platform, and we record the aver- age running times of the five-fold cross-validation for three models in Table III. We can see that Reg is much faster than other models, and LM-BHMM will take more times (about 0.3/0.2 s per iteration on Data Set 1/ Data Set 2) than L-BHMM for training. However, the differences of L-BHMM and LM-BHMM in test phases are not significant.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

ZHAO et al.: SEQUENTIAL APPROACH TO MARKET STATE MODELING AND ANALYSIS IN ONLINE P2P LENDING 9  Fig. 7. Performance of bid prediction. (a) HR Results:Data Set 1. (b) HR Results:Data Set 2. (c) RMSE:Data Set 1. (d) RMSE:Data Set 2.

Fig. 8. Performance with respect to different sequence length. (a) HR Results:Data Set 1. (b) HR Results:Data Set 2. (c) RMSE Results:Data Set 1. (d) RMSE Results:Data Set 2.

4) Case Study of Herding Detection: In this section, we design an experimental case study of herding detection.

Specifically, we first sample a small test data set (50 list- ings) in which listings have the same required amount (A = $10 000) and soliciting duration (P = 7 days). Then, we adopt LM-BHMM model to estimate the last market state and the bid observation of each listing. Further, we rank the listings based on their bid observation estimations. Fig. 9(a) reports the six representative listings in the ranked listings10 Listings 1 and 2 are the two most suspicious listings selected from the top posi- tion of the ranked listings. Listings 3 and 4 are two listings selected from the middle position. These two listings could receive enough bids in time, meanwhile, they did not cause excessive competitions and herding phenomenon. Listings 5 and 6 are selected from the end of the ranked listings, so they are listings of colder states. These two listings can not receive enough bids in time. From this simple case study, we can see LM-BHMM can detect the herding phenomenon and distinguish different states effectively.

We also display the modeled market states for listings (Listing 1, Listing 2, Listing 3, and Listing 6) in Fig. 9(b).

Since the states are hidden, we distinguish their semantics by experts. We can see that Listings 1 and 2 are very hot espe- cially at the end of their durations. While Listing 3, especially Listing 6, is much colder.

5) Bid Observation Analysis: In the following, we will make some deep analysis about observations and lenders? bidding behaviors.

a) Bid observation distribution: First, we study the bid observation distribution with respect to the soliciting dura- tion. We select all the listings with same soliciting durations, i.e., 7 days, in the two data sets. We label and rank all the  10For better exhibit, we plot three lines when the bidding amount values equal to 3 ? (A/P), 2 ? (A/P) and 1 ? (A/P), respectively.

Fig. 9. Case study. (a) Herding detection. (b) State modeling.

bid observations, and divide all the bid observations into four intervals (namely: ?VeryCold,? ?Cold,? ?Hot,? and ?VeryHot?) based on the listings? rankings. Then, we take the statistics of the bid observations in the four intervals in every timestamp (day). Fig. 10 reports the statistics results on two data sets.

On the whole, the proportion of VeryHot interval increases and the proportion of VeryCold interval decreases over time.

From these two figures, we can infer that most listings suffer from ?start-up? or ?cold-start? [31] processes at the begin- ning phases of the whole durations while herding is more likely to occur at the ending phases of the whole durations.

This phenomenon may be due to lenders? distrust to the new listings and the lenders? psychology of following suit at the ending phases. In comparison, the proportions of the middle two intervals are more stable.

Besides, a special discovery in Fig. 10 is that the propor- tions of VeryHot and Hot intervals in the first days are much bigger than those in the following days. That is because for many lenders, especially blind lenders, they are curious about new listings especially on the first days of soliciting durations.

But over time, the lenders? bidding behaviors will stabilize gradually. Similar findings were also reported in [7] and [32].

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

Fig. 10. Bid observation distribution versus soliciting bids time. (a) Data set 1. (b) Data set 2.

Fig. 11. Bid observation transition probability versus (a) transition step and (b) soliciting bids time.

b) Bid observation transition: Next, we study the tran- sitions among bid observations. Fig. 11(a) plots the transition probability of bid observation with respect to the transition step. For instance, step equals to 0 means the state does not transfer to other states and step equals to 1 means the state transfers to its nearest neighbor states. From the overall ten- dency, a state is more likely to transfer to itself and its near neighbor states and the probability of state transition decreases with the increase of transition step.

In Fig. 11(b), we plot the transition probability of bid obser- vations with respect to the time slice. From this figure we can see that, the transition probabilities of bid observations are even higher than 90%, which means predicting the bid observation is a difficult problem. What is more, the bid obser- vations are more likely to transfer at the beginning or at the end of the entire soliciting duration, which is consistent with the results in [7]. This is because rational lenders are more likely to bid at the middle of the soliciting bid duration while the blind lenders bid more randomly. This phenomenon may be the reason why listing is difficult to predict at the beginning and end of the duration. Thus, the prediction performance will be bad when the length reaches to the largest value (Please recall the results in Fig. 8).

c) Bid observation transition under market observation: Finally, we plot the bid observation transition directions, e.g., PosTrans (if a observation transfer to another hotter obser- vations) and NegTrans (if a observation transfer to another colder observations) probabilities under different market obser- vations in Fig. 12. Specifically, there are four market obser- vations, namely ?VeryBenefic? (VeryBene), ?Benefic? (Bene), ?Competitive? (Comp), and ?VeryCompetitive? (VeryComp) ranked as the predefined market situations in Section II-B2.

From these two figures, we can see that transitions are more  Fig. 12. Bid observation transition probability versus market observation.

(a) Data set 1. (b) Data set 2.

Fig. 13. Macroscopic analysis. (a) Macroscopic market. (b) Business and HomeImprovement.

likely to occur under the VeryBene and VeryComp market sit- uations. More specifically, when the market is VeryBene, the bid observations are more likely to transfer to the hotter states, and vice versa. These findings demonstrate the rationality of our second assumption.

d) Macroscopic analysis: In this paper, we mainly focuses on the microscopic market, i.e., the listing-level state modeling. However, our approach (i.e., L-BHMM)11 can also be applied to the macroscopic market analysis. We obtain the global bidding for all the listings (or a certain cate- gory of listings) to construct the macroscopic bid observation.

Fig. 13(a) shows the global bidding amount in Prosper from November 2005 to October 2008, in which the color bar visualizes the modeled hidden macroscopic state (i.e., the warmer the color/tone, the hotter the state). Fig. 13(b) shows the bidding and states of two categories (i.e., ?Business? and ?HomeImprovement?) of listings from December 2007 to October 2008.

From these two figures, we can get some interesting findings for the macroscopic market. Specifically, from the long-term view, the macroscopic market is more and more popular, and attracting more users; different kinds of listings/submarkets have different market states. For example, on the whole, Business listings are much popular/hotter and changing over time. However, the HomeImprovement market is always in cold states.



V. RELATED WORK  In general, the related works can be mainly grouped into two categories.

11LM-BHMM does not work any more without market observation in macroscopic view.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

ZHAO et al.: SEQUENTIAL APPROACH TO MARKET STATE MODELING AND ANALYSIS IN ONLINE P2P LENDING 11  The first category is about P2P lending. Readers can refer to [6] and [33] for an overview of P2P lending. In this field, many studies aimed at the listing quality evaluation.

For instance, Dong et al. [3] proposed a kind of logistic regression model with random coefficients to improve the prediction accuracy of credit scorecards. Wang et al. [5] pro- posed a fuzzy support vector machine to discriminate good creditors from bad ones. Luo et al. [4] developed a lender composition model to measure the listings. These works all tried to build a finer model to access the quality of listings or borrowers, thus helping lenders to make better decisions with these global models. Some other research issues in P2P lending include borrower decision optimization [34], determinants analysis of loan funding [9], [10], and raising dynamic of loans [23], [35]. For instance, Herrero-Lopez [36] measured the influence of social interactions in the risk evaluation of a money request. The results in this paper showed that fostering social features increases the chances of getting a loan fully funded, when financial features were not enough to construct a differentiating successful credit request. Freedman and Jin [37] studied whether social networks help alleviate the information problems. Besides, Zhao et al. [2] and [17], respectively, proposed methods for loan recommendation and portfolio selection in P2P lending market. Recently, Ceyhan et al. [7] made some efforts on bid- ding behavior analysis and observed the herding phenomenon on bidding. However, this paper was mainly from the statistical and empirical perspectives to understand lender behaviors, and lacking in the deeper explorations. In all, there are few exist- ing works on state modeling for listings in the P2P lending market.

The second category is about Hidden Markov Models (HMMs), which has been widely used in some domains, such as signal processing and speech recognition [38], [39], eco- nomics [40], [41], and biometrics [42], [43]. Until today, Markov model is still with strong vitality in many fields.

In [44], Hidden Markov Model (HMM) was adapted to devel- oping a continuous flow model for market demand-driven systems. Zhang et al. [45] designed two efficient Markov chain dynamics under the data-driven Markov chain Monte Carlo framework to effectively explore the high-dimensional state space for human pose estimation. In [46], HMM model was adapted to modeling the popularity of mobile App.

For much of the history, HMMs have been implemented by recursive algorithms for parameter estimation [47]. In recent literatures, some researchers proposed using Bayesian method to estimate the parameters of HMMs, which can provide a more stable parameter estimation. For example, Goldwater and Griffiths [24] proposed a novel B-HMM model for part-of-speech tagging. Liechty et al. [48] developed a psychometric model of visual covert attention by B-HMM, and they tested it using eye-movement data. Guha et al. [49] modeled the array comparative genomic hybridization data by B-HMM model. In [25], BHMM was adapted to context recognition for mobile users. Gao and Johnson [50] compared a variety of different Bayesian estimators for HMM part-of- speech taggers with various numbers of hidden states on data sets of different sizes. Compared with the traditional HMM,  previous studies have demonstrated the robustness and scal- ability of B-HMM in modeling sequential data with domain priori [24], [51]. However, to the best of our knowledge, nei- ther HMM nor B-HMM has been adopted in the domain of P2P lending.



VI. CONCLUSION  In this paper, we proposed a focused study on market state modeling for listings in online P2P lending and designed two sequential models (i.e., L-BHMM and LM-BHMM) by extending BHMM. Specifically, the first model L-BHMM only considers the local information and observations of a list- ing itself, while the second model LM-BHMM considers not only the listing information but also the global information of current market. Both of these two models could reveal the latent semantics between lenders? bidding behaviors and the market states of listings. Then, we demonstrated that mar- ket state modeling can be applied to many novel applications, such as bidding prediction and herding detection. Finally, we conducted extensive experiments on two real-world data sets, and the experimental results clearly validated the effective- ness of our models. Meanwhile, on the basis of our studies, we also made some deep analysis about observations and lenders? bidding behaviors and reported some interesting findings.

In the future, we would like to explore more factors to fur- ther improve the performance of LM-BHMM. Moreover, we also plan to study more novel applications in P2P lending enabled by our market state modeling approaches.

