Universal Auto-Calibration For A Rapid Battery

Abstract-Electrochemical impedance spectroscopy has been shown to be a valuable tool for diagnostics and prognostics of energy storage devices such as batteries and ultra-capacitors.

Although measurements have been typically confined to laboratory environments, rapid impedance spectrum measurement techniques have been developed for on-line, embedded applications as well. The prototype hardware for the rapid technique has been validated using lithium-ion batteries, but issues with calibration had also been identified. A new, universal automatic calibration technique was developed to address the identified issues while also enabling a more simplified approach. A single, broad-frequency range is used to calibrate the system and then scaled to the actual range and conditions used when measuring a device under test. The range used for calibration must be broad relative to the expected measurement conditions for the scaling to be successful.

Validation studies were performed by comparing the universal calibration approach with data acquired from targeted calibration ranges based on the expected range of performance for the device under test. First, a mid-level shunt range was used for calibration and used to measure devices with lower and higher impedance. Next, a high-excitation current level was used for calibration, followed by measurements using lower currents. Finally, calibration was performed over a wide frequency range and used to measure test articles with a lower set of frequencies. In all cases, the universal calibration approach compared very well with results acquired following a targeted calibration. Additionally, the shunts used for the automated calibration technique were successfully characterized such that the rapid impedance measurements compare very well with laboratory-scale measurements. These data indicate that the universal approach can be successfully used for on board rapid impedance spectra measurements for a broad set of test devices and range of measurement conditions.

T ABLE OF CONTENTS 1. INTRODUCTION ????????????????????????????????????????????????????????????????? 1  2. UNIVERSAL CALIBRATION THEORY ???????????????????????????????? 2  3. EXPERIMENTAL VALIDATION OF UNIVERSAL  CALIBRA TION ??????????????????????????????????????????????????????????????????????? 3  4. VALIDATE MID-SHUNT RANGE FOR UNIVERSAL  CALIBRA TION ??????????????????????????????????????????????????????????????????????? 4  5. VALIDATE SCALING THE RMS CURRENT FOR  UNIVERSAL CALIBRATION ??????????????????????????????????????????????????? 5  6. VALIDATE SCALING THE NUMBER OF MEASUREMENT  FREQUENCIES FOR UNIVERSAL CALIBRATION ??????????????????? 6  7. ENHANCED AUTO CALffiRATION . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7  8. CONCLUSIONS ?????????????????????????????????????????????????????????????????? 8   1. INTRODUCTION The impedance Measurement Box (1MB) was designed to  acquire, very rapidly, impedance spectra using a hardware  platform that could be embedded in a management system  for energy storage devices (e.g. batteries). The prototype  1MB system generates an excitation signal, captures the response from a battery, and then resolves that time response  signal into a Nyquist or Bode representation of the spectra.

One method that can be used for rapid impedance  measurement (RIM) is Harmonic Compensated Synchronous  Detection (HCSD), which generates a sum-of-sines (SOS)  excitation signal using frequencies separated by octave harmonics [1]. Previous testing with the HCSD technique  has shown that it yields measurement results comparable  with laboratory-scale electrochemical impedance  spectroscopy (EIS) measurements, is benign to the test  article, and the resulting RIM can be used for advanced diagnostic and prognostics [2]. For accurate results,  appropriate calibration of the 1MB system is required. The  typical system calibration determines scale factors that will  convert the system response, typically some voltage, into the  desired reference measurement units [3]. A calibration is  typically performed by making controlled measurements on a known standard. This calibration process allows the  systems measurement uncertainty to be quantified [4].

Previous methodologies relied on a manual approach that  was time consuming and prone to human error. However, a  new, universal auto-calibration system has been recently  developed for the 1MB such that a single calibration can be performed on the system to cover a wide range of  measurement capabilities.

The original manual calibration required three, 1% non?  inductive shunts (the reference standard) with  monotonically-increasing resistance values; the actual impedance of each shunt was first characterized with  standardized EIS measurements. The 1MB system operating  with HCSD was set for a designated frequency range and an SOS excitation current for the calibration. A RIM was  performed on the middle shunt and the results used to pre?  emphasize the SOS signal, similar to the method of Lathi  [5], so as to negate the 1MB system frequency    response. Then another RIM was performed on each of the  three shunts (using the pre-emphasis excitation signal). A  linear regression was then performed to obtain the set of calibration coefficients to correct magnitude at each frequency. The middle shunt was again selected and multiple  RIMs were performed with each frequency in the SOS  having a preset phase shift. This yielded multiple middle  shunt RIM data sets, each with a different phase (all the  frequencies in a given RIM have the same preset phase). The monotonically-increasing phase shifts, over those multiple RIM data sets, were then processed with linear regression to  yield phase calibration constants for each of the calibration  frequencies. Although this approach yielded a good RIM  response from the 1MB [6], it was very specific to the  requirements of the device to be measured (i.e., frequency range, amplitude, excitation current, etc.). Thus, a wide  variety of calibrations was needed for the expected range measurement scenarios. Additionally, each manual  calibration required an operator to attach and detach all the  shunts being measured. It was labor intensive and subject to  human error (e.g., hooking up a wrong shunt for a measurement). An auto-calibration technique was then  subsequently developed, using relay contacts, to  automatically switch between shunts [6]. The auto?  calibration required only a single connect-disconnect  operation. However, this technique still required calibration of three shunts that covered the expected range of  measurement conditions and would require a different  calibration if the measurement conditions changed.

New research has led to the development of a technique  whereby a single universal calibration can be scaled to apply to a very wide range of the expected measurement scenarios.

That universal calibration is used to synthesize a wide variety of specific calibrations needed for specific  measurement conditions.

2. UNIVERSAL CALIBRATION THEORY Given a broad range of frequencies within a SOS excitation signal for an impedance spectrum measurement, a single  standard calibration can be performed on the system using  the worst-case scenario (i.e., the largest expected frequency  sweep and highest expected excitation current) such that all  other anticipated measurement scenarios within the standard calibration boundary can use a calibration that was  synthesized from the standard. For example, a typical  frequency range for a lithium-ion cell is 0.1 to 1638.4 Hz  assuming an octave harmonic separation [6]. However, it  may be beneficial to occasionally go to even lower  frequencies for a better definition of the Warburg tail.

Alternatively, when faster measurements are required for a  quick assessment of health, the initial frequency should be  higher. If starting frequencies for these two requirements were selected such that they are harmonically-related to the  typical range (i.e., 0.0125 Hz for the long measurement and  0.8 Hz for the short measurement), then the universal auto? calibration system can be run with the longest duration  (0.0125 Hz to 1638.4 Hz) and still be useful for the other  measurement requirements. The shorter frequency   measurements can use the calibrations of the long universal  calibration where the frequencies overlap. Since the  calibration is both magnitude and phase with overlapping frequencies, the phase is inherently universal and scaling of  the calibration constants is only necessary for magnitude.

Additionally, impedance spectrum measurements can be run at various current ranges depending on the requirements and  signal-to-noise ratios. The universal calibration system would also assume the worst case (e.g., 500 mA RMS for a lithium-ion cell) and then scale for the actual excitation  current used to measure a device.

As described in the introduction, 1MB calibration is  performed at each frequency; it consists of a pre-emphasis  filter correction and response calibration [6]. The pre?  emphasis filter correction is normalized and thus  independent of the RMS excitation current so filter  corrections of the relevant frequencies can be selected from a universal calibration and input directly into the synthesized  measurement calibration. As previously mentioned, the  phase calibration is inherently normalized so the phase  calibration at the relevant frequencies are also selected from  the universal calibration and input directly into the synthesized measurement calibration. The magnitude  calibration is also selected from the relevant frequencies  however, it must first be scaled for RMS current and number  of frequencies before it can be used in the synthesized  measurement calibration. The theory defining this scaling is  as follows.

For magnitude calibration, after the 1MB has been filter  corrected for the desired frequency range, measurements are performed on three known monotonically-increasing shunts.

The magnitude response at each frequency for each shunt is  obtained using the HCSD technique. The response data are  processed with a linear regression straight line fit to obtain  calibration constants at each frequency [6]. Thus, impedance  magnitude at the ith frequency IZ, I for a measurement using this calibration is given by Equation 1.

where: Gi is magnitude linear regression gain at the ith frequency  OSi is the magnitude linear regression offset at the ith frequency V, is the magnitude of the voltage response at the ith frequency  I Pi is magnitude of the excitation current at the ith frequency  VPi is the corrected magnitude voltage response due to J Pi at the ith frequency  (1)    The relationship between the RMS of the SOS current I RMS and the peak of the individual SOS current sine waves Ipi is given by Equation 2.

os .= OSNi fM MI I '\jlV1M RMSM  where: GMi is the measurement gain at the ith frequency  (7)  (2) OS Mi is the measurement offset at the ith frequency  where: M is the number of frequencies in the SOS  Because of the filter correction, all of the individual I P, will be equal and thus Equation 2 becomes Equation 3.

(3)  The magnitude of the excitation current I Pi in terms of the SOS RMS current I RMS and the number of frequencies, Min the SOS is given in Equation 4.

(4)  From Equation 4 and Equation 1 the basis of the normalized  calibration magnitude constants can be obtained as shown in  Equation 5.

where: GNi is the normalized gain at the ith frequency as Ni is the normalized offset at the ith frequency Go is the calibration gain at the ith frequency aSCi is the calibration offset at the ith frequency M C is the number of calibration frequencies I RMSC is the SOS RMS current used in calibration  If the .J2 is considered part of the constants G Ci and aSCi ' then the normalized gain and offset at the ith frequency can be described by Equation 6.

(6)  Then the magnitude calibration constants for the synthesized  measurement calibration are obtained from Equation 7.

M M is the number of measurement frequencies  1 RMSM is the measurement SOS RMS current  Equations 6 and 7 form the basis for a universal calibration approach.

3. EXPERIMENTAL VALIDATION OF UNIVERSAL CALIBRATION  Three different test sequences were performed to validate  the Universal Calibration (UC) technique. The first test sequence verified that one calibration shunt range will work  for all expected measurements. All testing except the  frequency-scaling test was done at the long frequency range  (e.g. 0.0125 Hz to 1638.4 Hz). The second test sequence verified that a UC performed at a standard RMS current can  be scaled to apply to a measurement performed at a different  (lower) current. Finally, the third test sequence verified that a UC performed at a standard number of frequencies can be  scaled to apply to a measurement using a smaller subset of  the UC frequencies. Verification testing was done on Test Cells (TCs), which consist of non-inductive shunts and an  ultra-capacitor assembled into circuits that have an  impedance spectrum similar to a battery [6], a small 3.8V Li  ion battery and four small 12V lead acid motorcycle batteries. These test articles were selected because they provide a range of impedance from 15mQ to 1000mQ. The  TCs cover the low impedance portion of the range  ?lOOmQ) and the batteries cover the higher impedance  range. The TCs are desirable as test devices, they are  assembled with non-inductive shunts and an ultra-capacitor,  and thus their impedance spectra are time invariant and have been measured by the Idaho National Laboratory (INL)  Electro-Chemical Impedance Spectroscopy (EIS) system.

For 1MB development, they have provided a constant measurement standard. Thus, the only difference between  measurements performed on the same TC with the same  calibration would be the 1MB repeatability. The Li battery and the lead acid batteries impedance spectra will change  over time. Thus, spectra comparison tests using batteries must be done in close time proximity or data processing  applied to the same raw data set. The time variant battery  issue for these test sequences was mitigated by applying the comparison calibrations to the same raw battery data set.

Table 1 gives the magnitude of impedance provided by each  test article.

Table 1. Test Article Impedance  TC No. 8: 15mQ TC No.5: 60mQ  TC No.3: 30mQ Li: 50mQ  12V: 300mQ 48V: lOOOmQ  4. VALIDATE MID-SHUNT RANGE FOR  UNIVERSAL CALIBRATION  Previous development work for the 1MB has led to three  basic calibration shunt ranges to cover a low, medium or high impedance energy storage system. Table 2 shows the  three shunt ranges used for calibrations.

Table 2. Calibration Shunt Range  Low 16.6mQ, 25mQ, 50mQ  Mediwn 25mQ, 50mQ, 100mQ  High 50mQ, 100mQ, 200mQ  Calibrations at shunt ranges other than these are possible but undesirable for the existing prototype system. Since the  maximwn 1MB system resolution is ?O.lmQ, calibrations  with shunts lower than the low range are degraded by the  resolution limit. Calibrations done at shunt ranges above the  high range become limited by the RMS current. High impedance with a large RMS current will exceed the input  range of the digitizer.

The first objective was to show that a calibration conducted  at a designated RMS current level for a medium shunt range  calibration and then subsequently applied to a lower and  higher impedance device will match the corresponding  results from a low shunt range calibration and high-shunt  range calibration, respectively. First, a medium shunt range  calibration and a low shunt range calibration were conducted  at 500mA and used to perform measurements on TC No. 8, a  very low-impedance test article (see Table 1) and the results compared. Second, a medium shunt range calibration and a  low shunt range calibration were conducted at 250mA and  used to perform measurements on TC No. 5 (see Table 1) and a lithium-ion battery. Both the TC and battery are  slightly higher impedance devices. The medium and low  shunt range calibrations for 250mA were applied to the same  measurement performed on a lithium-ion battery. Figure 1  shows the resulting impedance spectra displayed as Nyquist curves where the medium shunt ranges are the "0" symbols  and the low shunt ranges are the "."symbols. As shown, the  plots very closely match and thus it appears that mediwn  shunt calibration range can successfully be used for lower  impedance devices.

X 10-3 Te 8 Nyquist RMS 500mA, LoCal *, Medeal 0  0.01  O.OOB  :.

.? 0.006 ?  0.004  ? 0>  ?  Te 5 Nyquist RMS 250mA, LoCal *, Medeal 0   0.5  ?0.5  ?1  -1?O?14-;-5 --;0"':.0:-;15--;;-0.0;;7 15'-;5 --;;-0.0;::16:---:0:7 .01;-;; 65:----;;07. .0100- 7 --;:;!O.O?1 75 Real  (a)  0.015  0.01  :.

.? 0.005 ?  ?0.005  Li Nyquist RMS 250mA, LoCal ", Medeal 0  0.05 0.055 0.06 0.065 0.07 0.075 .

0.oa.04?------=-'0.0::-5 --:0:-:- .06:------=-0.-=-= 07:-------=-'0.0=- 8 --:0:-:- .0=-9 ---:'0.1  Real Real  (b) (c)  Fig. 1 (a, b, c) Test Cell results for low shunt range vs. medium shunt range     The next comparison included medium and high shunt  calibrations conducted at 62.5mA and then applied to a  common measurement for a 12V lead acid battery and another common measurement for 48V lead acid battery,  which are both high impedance batteries. Four 12V lead acid  0.8  0.7  0.6  0.5  ? O.4 ?  12V Lead Nyquist RMS 62.5mA, Medeal *, HiCal 0  Real  (a)  0.6 0.7 0.8 0.9  batteries were connected in series to form the 48V system.

The results are plotted in Figure 2 and show a very good match. Thus, it also appears that the medium shunt range can  be useful for higher impedance devices as well.

48V Lead Nyquist RMS 62.5mA, Medeal .. HiCal 0 2.5  1.5  0.5  ? 0?70.? 5 ?--?' 5?7 -?27.5??73.5?? -4?.5? Real  (b)  Fig. 2. (a and b) Lead Acid cell response for High Shunt range vs. medium shunt range  5. VALIDATE SCALING THE RMS CURRENT FOR  UNIVERSAL CALIBRATION  The next aspect of validating the concept of UC is to demonstrate that the RMS current used for calibration can scaled to the value used for a measurement. As per  Equations 6 and 7, the calibration scaling only applies to the magnitude constants and not the phase constants. All  calibrations for this comparison were in the medium shunt  range. The fust used a 500mA calibration current that was  2.5 X 10-3 Te 3 Nyquist, CrossCal 500mA *, HCSD 250mA 0  Real  (a)  0.031  scaled to 250mA and then compared to a measurement performed using a 250mA calibration. The calibrations were applied to the same measurement time record. Tests will  scale the current for calibrations done at 500mA to  measurements at 250mA and compare with calibrations done  at 250mA. The calibrations will be applied to the same time  record. The two results are plotted together in Nyquist  format. The test articles for this study were TC No. 3 (Table 1) and the lithium-ion battery. The results are shown in  Figure 3.

Li Nyquist, CrossCal 500mA *, HCSD 250mA 0 0.02  0.015  0.01  iij ? 0.005 J ?  ?0.005  -0 0d L04--?0.0'-'- 5 ----,o? .06,--------,0?.07??0.0?8 ---0? .0'-- 9 --?O. 1 Real  (b)  Fig. 3. (a and b) RMS current scaling for 500mA to 250mA for TC No. 3 and a Li battery  With TC No. 3, there is a little error at the very high frequencies (left side) and the low frequency measurement  (right side). However, the results show very good agreement for the critical mid-frequency region. For the lithium-ion  battery, the match is very good over the entire frequency  range. The second test was to scale a 500mA calibration  down to 62.5mA for high impedance lead acid modules at both 12V and 48V. Figure 4 shows the resulting spectra. As   with the lower impedance results, the measurements using the current scaled calibration technique match the low  current measurements very well over the mid-frequency  region. There is some deviation at the Warburg tail but the  effect seems mostly localized to just the lowest frequency  measurement. Consequently, it also appears that the UC technique can be used to scale the excitation current for  rapid impedance measurements.

0.8  0.7  0.6  0.5 Co ?? O.4 ?  0.3  0.2  0.1  12V Lead Nyquist, CrossCal 500mA ., HCSD 62.SmA 0  ? 0??0.?1 ?0.2??0.3?0? .4?075?0.? 6 ?07??0.8?0? .9? Real  (a)  1.8  1.6  1.4  1.2  [ 1 "' ?  0.8  0.6  0.4  0.2  0 0.5  48V Lead Nyquist, CrossCal 500mA', HCSD 62.5mA 0  1.5 2.5 Real  (b)  3.5 4.5  Fig. 4. (a and b) RMS current scaling for Lead Acid SOOmA to 62.SmA  6. VALIDATE SCALING THE NUMBER OF MEASUREMENT FREQUENCIES FOR UNIVERSAL  CALIBRATION  The next validation test sequence was to demonstrate that the UC technique, per Equations 6 and 7, can scale long calibration (e.g., with 18 frequencies), for a measurement  with a smaller frequency range. This will only work if the  reduced set of measurement frequencies is a sub-set of the  larger UC frequency set.

The UC used a 500mA excitation current with 18  frequencies covering a range from 0.0125 Hz to 1638.4 Hz.

Measurements were then conducted on TC No. 3 (see Table 1), the lithium-ion battery, and both the 12V and 48V lead acid battery configuration using a 15-frequency  measurement (i.e., 0.1 Hz. to 1638.4 Hz.). Note that both the  number of frequencies and the RMS current were scaled (TC  2.5 X 10-3- Te 3 Nyquist, CrossCal SOOmA" HCSD 250mA 0  -0.5.'::-:-_____cc?_____cc???-?-?-? ?  0.024 0.025 0.026 0.027 0.028 0.029 0.03 0.031 Real  (a)   No. 3 and lithium-ion battery at 250mA; the 12V and 48V lead acid batteries at 62.5mA). Also the two calibrations  were applied the same time record. Figure 5 shows the  resulting impedance spectra for each test article.

The match is good at all frequencies except for some minor  high frequency error for TC No. 3 in Figure 5a. Thus, it  appears that the UC technique can also successfully scale  frequency ranges for rapid impedance spectra measurement.

We have shown that the medium shunt range for calibration  is adequate for a wide range of expected test article  impedance magnitudes. We have demonstrated that a Universal Calibration (UC) carried out with 18 frequencies, 500mA RMS and the medium-shunt range will scale with  current to a lower current level and with frequency to a  lower number of frequencies as long as the lower frequency  range overlaps with the 18 frequency range per Equations 6  and 7. The concept of UC is considered validated.

Li Nyquist, CrossCal 500mA', HCSD 250mA 0   -2  -4  -6  -8 '-,---?c----,-L,-?..L.,---??-?-?? 0.04 0.045 0.05 0.055 0.06 0.065 0.07 0.075 0.08 Real  (b)    12V Lead Nyquist. CrossCal 500mA *, HCSD 62.5mA 0 48V Lead Nyquist, Cross Cal 500mA ., HCSD 62.5mA 0 0.35 0.9  0.3 0.8  0.7 0.25  0.6  ? 0.2  ? O.5 . ., ., ? 0.15 ? 0.4  0.3 0.1  0.05  0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.5 1.5 2 5 Real Real  (c) (d)  Fig. 5. (a,b,c,d) Frequency scaling for TC No. 3, Li battery and lead acid batteries 18 to 15 frequencies  7. ENHANCED AUTO CALIBRATION  The final validation test sequence was to compare results from the rapid impedance technique with laboratory-scale  EIS measurements. The universal auto-calibration system is  realized in a small box that contains a computer-controlled,  printed circuit board, and mounted, dual in-line package  relays that switch in and out the various calibration shunts.

Since the shunts placed in the box are not readily accessible, it was not practical to characterize each shunt with an EIS  measurement. However, this is a critical step for successful  field (i.e., in situ) rapid impedance measurements to be  comparable to laboratory-scale results.

Consequently, a methodology was developed to characterize  the shunts inside the auto-calibration box using an external  shunt. First, the external shunt was subjected to an EIS  measurement to determine its true value and then measured with an 1MB to obtain a reference time response record that was saved. Using the same 1MB calibration, rapid  impedance measurements were performed on each shunt  internal to the auto-calibration box while saving each of  those time response time records. From these data, a correction factor was identified using Equation 8. The  6a. Auto-cal shunts (16m, 25m, 50m) I RMS 250rnA  process was repeated at several different calibration currents and the results averaged. Figure 6 shows the resulting  comparison between EIS and a rapid impedance  measurement from the 1MB for TC No.3 using the low- and  medium-shunt calibration ranges at an excitation current  level of 250 rnA. As shown, the HCSD and EIS  measurements compare very well at all frequencies although there is a minor deviation at high frequencies for the low?  shunt calibration range (Figure 6a).

shuntElS  STDE1S  where: shunt E1S is the shunt value from EIS shuntuK is the unknown shunt value STDE1S is the standard deviation from the EIS shunt time record.

STDuK is the standard deviation from the time record of the unknown shunt.

6b. Auto-cal shunts (25m, 50m, 100m) I RMS 250mA  (8)  Fig. 6. (a and b) Test Cell validation of auto-cal concept with 1MB vs. EIS   0.022 0.023 0.024 0.025 0.026 0.027 0.028 0.029 0.03 0.031 0.032  0.5   1.5   2.5 x 10  -3  Real Impedance (?)  C o m  p le  x I  m p e d a n c e (  -j ?  )  Test Cell #3 Impedance HCSD vs. EIS  Signal RMS = 250, Shunt Range = low  18 frequencies starting at 0.0125Hz      HCSD  EIS  0.022 0.023 0.024 0.025 0.026 0.027 0.028 0.029 0.03 0.031 0.032  0.5   1.5   2.5 x 10  -3  Real Impedance (?)  C o m  p le  x I  m p e d a n c e (  -j ?  )  Test Cell #3 Impedance HCSD vs. EIS  Signal RMS = 250, Shunt Range = med  18 frequencies starting at 0.0125Hz      HCSD  EIS    8. CONCLUSIONS Rapid impedance spectra measurements are a useful tool for onboard battery diagnostics, management, and control.

Acquired data, however, require accurate calibration to ensure that onboard measurements are comparable to  laboratory-scale results. A universal auto-calibration system  was developed such that a single calibration could be  performed for a wide variety of measurement conditions.

Calibration is performed on the worst-case scenario and then scaled to the actual measurement window used for the device under test. Verification testing of the universal  calibration technique shows that the calibrated results  successfully scale for shunt ranges (medium-shunt levels  applied to low-shunt and high-shunt measurements),  excitation currents levels (500 rnA applied to 250 rnA and  62.5 rnA), and frequency range (18 frequencies applied to measurements having only 15 frequencies). Additionally, a  methodology was developed to calibrate shunts placed in a  portable auto-calibration box such that rapid impedance  measurements are comparable with laboratory-scale data.

Results from these verification tests indicate that the universal calibration technique is a valid approach for rapid  impedance measurements. The system can be automated  with a single, wide-range, high-RMS current calibration  from which several standard (but lower) calibration ranges  can be obtained to support a suite of measurement  conditions.

