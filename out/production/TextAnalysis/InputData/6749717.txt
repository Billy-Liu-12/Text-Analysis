Integrated Routing and Channel Arbitration in Overlaid Mesh WiNoC

Abstract?Unequal RF nodes are properly deployed to improve network performance of wireless network-on-chip benefited from the greatly reduced network diameter, forming the so called overlaid mesh WiNoC. However traffic can be severely congested at big nodes which serves as the access points to long links. To optimize system performance, a cross-layer design solution is delivered which integrates a dynamic routing selection scheme and a handshaking based multi-channel arbitration method. In dynamic routing, the routing decision is dynamically selected in a way that temporarily detours the routing path when a default overlaid routing path gets congested. Integrated seamlessly with the routing scheme, a multi-channel assignment and arbitration scheme is developed to enhance bandwidth usage and reduce contention overhead. Our simulation studies highlight the opti- mization effectiveness and performance impact of the cross-layer approach over the layered design.1

I. INTRODUCTION  To exploit highly parallel computing, the industry moves to chip multiprocessors (CMPs) to improve energy efficiency and reduce design cost. However the performance advance will slow down exponentially when we try to pack more cores into the chip as the traditional interconnection and communication such as bus, becomes the performance bottleneck. CMPs will increasingly rely on on-chip network design to realize more parallel inter-tile communication. 2D Mesh topology has been very popular and widely used for on-chip interconnection of chip multiprocessors, such as the RAW processor [1], the TRIPS processor [2], the Intel?s 80-core Polaris prototype [3], and the 100-core Tile-Gx100 CPU from Tilera [4], due to its regular structure, short inter-router connection, simple im- plementation of XY-routing and network scalability. Its long network diameter and asymmetric structure however result in extra long hop count and traffic load imbalance on inner nodes/links, greatly degrading performance.

To improve the network performance by reducing the network diameter of 2D mesh, an overlaid mesh wireless network-on-chip (WiNoC) has been proposed in [5], which utilizes the promising high-capacity multi-access impulse- radio ultra wideband (IR-UWB) based physical layer. An overlaid mesh maintains the same simplicity and regularity as a mesh. The unequal RF nodes deployment opens up a new opportunity for long-range high-bandwidth low-power data  1This research was supported in part by the National Science Foundation under grant number CNS-0821702 and CCF-0845983.

transmission at short average network distance. With high- flexibility and free-of-wiring featured in UWB-I, multilayers of meshes (varying in size and link length) are overlaid without allocating extra network resources.

To exploit the performance potentiality of overlaid mesh WiNoC, a cross-layer design strategy is presented in this paper which integrates routing and channel arbitration into one single coherent optimization. A dynamic route detouring technique is designed to cope with traffic distribution dynamics and divert excessive traffic loads. Collision-free and low-overhead chan- nel allocation and arbitration is established by coupling with overlaid routing. The rest of the paper is organized as follows.

An architectural overview of overlaid mesh and accordingly an zone-aided overlaid routing scheme is discussed in Sec. II. A congestion aware dynamic routing selection (DRS) scheme is presented in Sec. III where the routing decision is dynamically made according to traffic density distribution in the network. It efficiently avoids deadlocks with the implementation of virtual channels. Under minimal channel assignment, a handshaking based multi-channel arbitration scheme is discussed in Sec. IV where competing nodes are granted channel access in coping with the routing sequence. Finally we conclude this paper.



II. OVERVIEW OF OVERLAID MESH WINOC  A. Architectural Overview  S  D  Fig. 1. Illustration of overlaid mesh.

In an overlaid mesh WiNoC, unequal RF nodes are placed in a regular n ? n mesh in a way that some big RF nodes (blue filled circles in Fig. 1) form a m ? m (where m < n) full mesh (short for fully connected mesh) laid over the n?n     base mesh formed by small RF nodes (unfilled circles). These nodes are virtually grouped into zones with big RF node as the zone header which facilitates unidirectional direct links to all small nodes within its zone, thus forming starry ends (red links). Note that with UWB-I, we may easily construct such a topology for WiNoC without any wiring concern. By utilizing long links formed by big RF nodes, the overlaid mesh can effectively reduce the network diameter to 3+?n?1  3 ? compared to 2(n ? 1) for a n ? n mesh. An 9 ? 9 overlaid mesh with diameter of 5 is shown in Fig. 1 where a 3 ? 3 full mesh is overlaid on top of the base mesh.

B. Overlaid Routing  Zone-aided overlaid routing scheme has been proposed for overlaid mesh which facilitates simple and efficient logic- based implementation and guarantees deadlock freedom based on an octagon turn model [5]. The basic idea is that a packet is first XY-routed to the zone header of its source. It then traverses through the full mesh with turn-restricted shortest- path routing till reaching the zone header of the destination.

From there, it directly hops to its destination. For example, a packet generated at source S (in Fig. 1) is first forwarded to the source header by XY-routing. It is then routed along the full mesh using turn-restricted shortest-path routing before reaching the destination zone header. It finally arrives at the destination D via the direct link, resulting in a total of 5 hops compared to 11 hops using XY-routing in a 2D Mesh.

Benefitted from the reduced network diameter, overlaid routing significantly reduces the average hop count. However it may cause severe traffic congestion at the big nodes due to their high node degrees (7 ? 12). As shown in Fig. 2, much higher traffic density is concentrated on the big nodes under uniform traffics, which causes performance degrading.

T ra  ffi c  D en  si ty  Fig. 2. Traffic density under overlaid routing.



III. CONGESTION AWARE DYNAMIC ROUTING SELECTION  To strive for the balance between implementation cost and system performance, a congestion aware dynamic routing selection (DRS) scheme is proposed in this section. With two routing schemes in the selection pool, overlaid routing and XY- routing, we pick the routing path which may release earlier a congested packet into the network. We expect that the packet may arrive at the destination earlier.

For example as shown in Fig. 3, we send streams of packets using overlaid routing from A to B and from C to D respectively in a simple 6? 6 overlaid mesh. The overlaid routing achieves an average delay reduction of 70% at heavy traffic (or 67% at light traffic) as it minimizes the average hop count when compared to XY-routing alone (in Fig. 4).

However, traffic can be congested at big node E as both paths go through it, which soon becomes the performance bottleneck. In oder to ease traffic congestion at E, we will make a detour along the XY-routing path from A to B till the congestion is alleviated, which results in a much better end-to-end performance. Based on the above observation, we grant the nodes the flexibility to temporarily detour their routing paths (which are longer but traffic lighter) if the default overlaid routing paths are congested. Such selection of routing paths is performed dynamically according to traffic density distribution, resulting in an additional 21% delay reduction especially under heavy traffics.

A  C  B  D  G  H  I  JE  F  Fig. 3. Illustration of dynamic routing selection.

XY-routing Overlaid routing DRS            A ve  ra ge  D el  ay  Routing Schemes  Light Heavy  Fig. 4. Preliminary study of routing delays.

A. Dynamic Routing Selection (DRS) Scheme  When designing an efficient routing scheme, minimum hop count is not the only performance metric. From the lesson we learned above, when the minimum hop count path experiences congestion, it becomes a bottleneck to the end- to-end performance. So it?s important to consider the end-to- end travel time which is the time required for a packet to travel from a source to a destination. It depends heavily on the number of hops between the source-destination pair and the amount of traffic along the path. Considering a packet waiting at a node to be injected into the network, the node estimates the tentative packet travel time when transiting on a     routing path under selection,  Ttravel = Tpkt wait + Tpkt transmit ? Nhop where Tpkt wait is the packet waiting time at the node which implies how severely the traffic is congested on the path, Tpkt transmit is the packet transmit time via any node which has a constant value, and Nhop is the number of hops needed for packet transmission along the path before arriving at the destination which indicates the travel distance. We will pick the path with less Ttravel which is attained by either shorter distance or lighter traffic density or both.

To keep track of the packet waiting time before admitting into a possible path under selection, a timer is designed in a way that is triggered or cleared by the feedback received from a backpressure based throttling mechanism. When a throttle signal is sent back via the upstream nodes all the way to the source (once a downstream node gets congested), the source node slows down the packet injection into the path and at the same time, the timer is turned on to keep counting of Tpkt wait (with initial value of 1). It counts up by one every packet transmission interval (i.e., the total time for packet arbitration and transmission via a node) if the packet is blocked from admitting into the path. Once the packet is sent out, Tpkt wait is cleared to its initial value. In the meantime, the timer takes into account the packet transportation time which greatly depends on the travel distance in terms of hop count of a possible path under selection. Specifically, the timer takes the inputs of destination node?s address (xDi , yDi) contained in the packet header to calculate Nhop of the path. Given the node?s local address (xRi , yRi), its zone header?s address (xHi , yHi), and the big nodes? separation distance Ldist, Nhop is computed as follows,  Nhop =  ???? ???  max(? |xDi?xRi |Ldist ?, ? |yDi?yRi |  Ldist ?)  +|xHi ? xRi | + |yHi ? yRi | + 1 overlaid routing  |xDi ? xRi | + |yDi ? yRi | XY-routing Note that overlaid routing is the default routing scheme of  an overlaid mesh WiNoC to take the advantage of minimum hop count. When the traffic gets congested at the big nodes which is reflected on the throttling backpressure as discussed above, the end-to-end performance will be degraded. The source node intends to choose an alternative XY-routing path with lighter traffic density so as to shorten the travel time.

As such it controls the traffic admission into alternate routing paths with less Ttravel. By detouring, the traffic stream is diverted and the congested default path gets alleviated with traffic loads. In consequence, the node will be unblocked from the traffic admission onto this path. With dynamic routing selection (DRS), the traffic density is more evenly distributed chip wide as shown in Fig. 5, which results in significant performance improvement over the overlaid routing.

B. DRS Facilitated Buffer Architecture  Assuming a dynamic virtual output queuing strategy [6] where each node is facilitated with one dynamically linked                   T ra  ffi c  D en  si ty  Fig. 5. Traffic density under dynamic routing.

shared buffer with size of Nnei ? 2 and Nnei virtual output queues (VQ) with size of 1, each associating with one of the Nnei neighbors2. The shared buffer stores the incoming packets before their next-hops are determined by the routing decision logic (RDL). Consequently the packets are dynami- cally linked to the corresponding virtual output queues.

To facilitate DRS, we introduce two buffer classes for each virtual queue. Buffer class 0 is used to temporally store the packets which will be routed along overlaid routing path.

Buffer class 1 is for storing the packets going on the XY- routing path. Each level of buffer is associated with a timer which instantaneously computes the tentative packet travel time, Ttravel. The outputs of Ttravel from the two timers will be sent to a comparator to generate the 2-to-1 multi- plexer selection signal Sel. Specifically, if Ttravel overlaid ? Ttravel XY , Sel = 0 (i.e., output to buffer level 0); otherwise, Sel = 1 (i.e., output to buffer level 1). Upon the Sel signal, the packet waiting at the shared buffer will be linked to the proper buffer level of a VQ to be sent along the selected routing path.

Note that among the Nnei VQs of a big RF node, only the Nneis VQs (corresponding to Nneis neighboring small RF nodes) need to be equipped with the above DRS facility. It?s due to the fact that only the transmissions towards these small neighbors will get involved into routing path selection while all the remaining go for overlaid routing. Accordingly, the small node buffer sizing is 2Nnei +(Nnei?2) = 3Nnei?2; and the buffer size of a big node is determined by 2Nneis + (Nnei ? Nneis) + (Nnei ? 2) = 2Nnei + Nneis ? 2.

C. Deadlock Avoidance with Virtual Channels  Deadlock is effectively avoided in dynamic routing selection scheme with the implementation of two virtual channels, one for overlaid routing and the other for XY-routing. As discussed earlier, each VQ maintains two units of buffer which are ordered into two numbered buffer classes. The 1st class buffer is dedicated to store the packets delivered along the overlaid routing paths while the 2nd class buffer is reserved for storage of packets sent along XY-routes.

2The minimum buffer sizing is determined by considering the worst case scenario when multiple flows crossing at a node contend for the same next- hop, which is analyzed in [6].

Theorem 3.1: Routing selection scheme is deadlock free.

Proof: It is well-known that XY-routing is deadlock  free based on the turn model where certain turns from the y dimension to the x dimension are prohibited to avoid deadlocks. It is proven in [5] that zone-aided overlaid routing scheme is deadlock free. With two dedicated virtual channels for alternative routing paths, no cyclic dependency will be formed. Thus deadlock freedom is achieved.



IV. INTEGRAL CHANNEL DISTRIBUTION AND ARBITRATION  The WiNoC multiple-access capability stems from time hopping which uses pseudo-noise codes to separate different channels. Thus multiple nodes can ?simultaneous? transmit data on multiple channels by sharing a single impulse-based UWB frequency band. Ideally, each node can reserve a dedi- cated channel for transmission, which however may result in extremely long sequence frames. More importantly, the per- link bandwidth is low, resulting in underutilization of available bandwidth and consequently long latency. To maximize per- link bandwidth, It becomes essential to distribute minimal but sufficient channels among the competing nodes.

With limited number of channels, multiple nodes may share the same channel. As a result, collisions may occur when multiple nodes close by try to simultaneously transmit data on the same channel or multiple senders simultaneously direct data to the same receiver or a sender in the meantime serves as a receiver. As collisions occur at the receivers, we consider receiving channel access contention. Thus an efficient multi-channel distribution and arbitration scheme need to be developed for collision-free low-latency data transmission in WiNoC. To tackle the uniqueness of overlaid mesh, a cross- layer design of channel distribution and arbitration is proposed in this section which integrates seamlessly with the routing scheme described in Sec. III.

A. Minimal Receiving Channel Distribution  For minimal channel allocation, we consider the overlaid routing sequence where data hops in sequence in base mesh and full mesh (which can be further layered into a tilted big mesh formed by dotted blue links in Fig. 1 and a upright big mesh with solid blue links) respectively. At one time, a big node will take part in data transmission on one of three layers of overlaid mesh in coping with the routing sequence.

Thus we may divide the (at most) 12 neighbors of a big node into 3 groups, each located on one layer of mesh.

Instead of considering all 12 neighbors competing for the same big node?s receiving channel simultaneously which results in high contention overhead, four competing neighbors on each layer are considered at a time for receiving channel access contention. Consequently, each big node will be assigned with three different receiving channels, one for each layer, while a small node will only have one channel. It?s easy to find out that all 4 neighbors on one layer will be assigned with distinct channels in order to avoid two-hop conflicts (where any two receivers which are two hops apart attempt to receive data  simultaneously on the same channel). For any network scale, four receiving channels are necessary and sufficient to avoid two-hop conflicts in one layer of overlaid mesh (due to page limit, the proof is skipped). With only four channels distributed and contented at one time, we can efficiently improve the per- link bandwidth and reduce the contention overhead.

B. Handshaking Based Channel Arbitration  While two-hop conflicts are effectively avoided by channel assignment, an efficient channel arbitration scheme is essential to resolve the contention among the competing senders. To cope with the overlaid routing, the channel contention and data transmission are carried out in superframes where a series of subframes constitute a superframe, and a subframe contains a number of slots. Aiming at efficient channel bandwidth distribution and granting, a handshaking based multi-channel arbitration scheme is thereby proposed.

DATA  Transmission Subframe  ACKREQ  Handshaking Subframe  DATA  Indication Subframe  INT  Fig. 6. Illustration of subframes.

Without loss of generality, three different types of subframes are introduced as shown in Fig. 6, i.e., handshaking sub- frame, data transmission subframe and indication subframe.

A handshaking subframe contains at most four slots for transmission request and one slot for request authorization. Up to 4 neighboring potential senders located on one particular layer of overlaid mesh will contend for channel access to the receiver by sending a ?REQ? pulse at its dedicated slot.

The potential receiver will arbitrate among the requests in a round-robin fair manner and grant the channel access to exactly one of them by sending an ?ACK? pulse to the winning sender. In data transmission subframe, the authorized potential sender will adapt to the receiving channel and send data to the receiver in the duration of 5n slots. In indication subframe, a small node will wait for a ?INT? pulse in the first slot. Upon recipient of the indication, it will get prepared to receive data transmitted from its header via the direct link. This frame has a duration of 5n slots.

The superframes of big and small nodes are illustrated in Fig. 7 which includes three phases. As designed earlier, a big node is associated with three receiving channels, one for receiving data in different layers of overlaid mesh, base mesh, tilted big mesh, and upright big mesh, respectively. And a small node is assigned with just one channel.

? The big node?s superframe involves two phases. In the first phase, the big node serves as the zone header on the base mesh and the neighboring small nodes compete to send data to it. As the zone headers are the access points to long links, more potential transmissions await to be sent to the headers. Phase 1 thus facilitates two iterations of channel contention and data transmission. In phase     2, the big nodes contend the channels allocated on the tilted mesh, and follows they compete for the receiving channels on the upright mesh, thus each involving a combination of channel contention and data transmission subframes.

? The small node?s superframe includes phases of 2 and 3. In phase 2, the small nodes compete for the four receiving channels on the base mesh and send data to the neighboring small nodes. As there are no channel contentions between the small nodes on the base mesh and the big nodes on the full mesh, the channel contention and data transmission among the small nodes can be carried out simultaneously with those big nodes in phase 2. Finally in the last phase a small node will be informed if it is the destination of the data waiting at the zone header. Consequently data is delivered to it via the direct one-hop link. A single indication subframe fulfills such a task.

Note that if a node simultaneously involves in sending and receiving, it will compete for sending first in order to alleviate intra-flow contention.

Phase 1 Phase 2  handshaking subframe  transmission subframe  indication subframe  Phase 3  Bi g  no de  Sm all  n od  e  Fig. 7. Illustration of superframes.



V. PERFORMANCE EVALUATION  We develop a simulator to evaluate the performance of overlaid mesh WiNoC integrated with dynamic routing selec- tion (DRS) and handshaking based multi-channel arbitration (HMCA). An overlaid mesh with unequal RF nodes is built to cover the communication among processor tiles within a chip multi-processor model. The wireless bandwidth is properly allocated among multiple nodes in the network according to the channel assignment scheme discussed in Sec. IV-A. A virtual channel facilitated output queuing strategy is used for cost efficient buffering and deadlock free routing. A backpres- sure based flow throttling scheme is implemented for traffic admission control. The simulations are conducted in a 12?12 overlaid mesh with 4?4 full mesh. The wireless bandwidth is set at 10Gbps. We evaluate the network performance in terms of network throughput and end-to-end delay under different traffic injection rate (which is set as a fraction of the total number of packets injected in a certain traffic pattern).

A. Impact of Dynamic Routing Selection  We study the performance impact of dynamic selection of routing decisions which temporarily detours the routing path when a default overlaid routing path gets congested.

The key point is to dynamically redistribute the traffic loads according to the traffic flow backpressure. The experiment is run under the uniform traffic distribution. We compare the network performance with the overlaid routing scheme under static threshold setting of 11 and 15 [5] (which result in the best performance than other threshold settings). As we can see, the dynamic routing selection (DRS) scheme makes overlaid routing at low traffic loads. When the traffic gets heavier, dynamic selection of routing paths starts to play the role which chooses the least congested path to redistribute the traffic density. DRS achieves around 12% of performance gain when compared to the best possible enhanced overlaid routing (such as ?E11? and ?E15?) obtained at high thresholds (of 11 and 15 respectively). When comparing their delays, DRS outperforms the enhanced overlaid routing at 21% reduction as shown in Fig. 8(b). Besides the performance advantage, DRS can efficiently reduce design complexity and implementation cost without design space exploration of static threshold setting.

0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08       Injection Rate  N et  w or  k T hr  ou gh  pu t (  G bp  s)  DRS E11 E15  (a) Network throughput.

0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08       Injection Rate  E nd  2E nd  D el  ay (C  yc le  s)  E11 E15DRS  (b) End-to-end delay.

Fig. 8. Performance comparison under different routing schemes.

B. Impact of Cross-Layer Design of Channel Arbitration  In order to evaluate the performance of our proposed cross- layer design of handshaking based multi-channel arbitration (HMCA), we implement two other multi-channel arbitration schemes based on layered design. One is multi-channel SD- MAC (mSD-MAC) which implements a separate wired control channel for channel access control handshaking besides the wireless channels, and interleaves wired control handshaking and wireless data transmission [7]. The other is a simple DATA/ACK based multi-channel arbitration scheme without handshaking, which is derived from the IEEE 802.11 MAC protocol [8].

As seen from Fig. 9(b), HMCA achieves the best perfor- mance, reducing latency by 24% and 37% over mSD-MAC     and DATA/ACK respectively. It?s simply because HMCA is designed jointly with the topology and routing scheme and integrated seamlessly with network routing to efficiently tackle the traffic congestion problem. Such coherent optimization- motivated cross-layer design strategy results in significant performance improvement. HMCA specially works well un- der heavy traffic. Interleaving control handshaking and data transmission can certainly improve end-to-end performance in mSD-MAC. This scheme however cannot efficiently al- leviate traffic congestion in overlaid mesh, which results in 25% worse throughput than HMCA as shown in Fig. 9(a), not even mentioning the wiring complexity for handshaking signaling. DATA/ACK represents the worst performance as its none-handshaking based arbitration approach cannot handle efficiently traffic collisions and works poorly when the traffic becomes heavier.

0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08       Injection Rate  N et  w or  k T hr  ou gh  pu t (  G bp  s)  HMCA mSD-MAC DATA/ACK  (a) Network throughput.

0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08       Injection Rate  E nd  2E nd  D el  ay (C  yc le  s)  HMCA mSD-MAC DATA/ACK  (b) End-to-end delay.

Fig. 9. Performance comparison of various channel arbitration schemes.

C. Scalability Study  We further study the scalability of overlaid mesh WiNoC under three different network scales: 12?12, 10?10, and 8?8.

Note that under different network scales, the big nodes are placed in the same separation distance of 3. When the network scales up, the big nodes are getting more highly loaded with traffic. For example when it scales from 10?10 to 12?12, the average hop count is increased by more than 50%, however its average delay is just increased by 20%. When the network gets more crowded (as the number of network nodes is increased by 78%), the throughput is noticeably increased by 23%. In a nutshell, overlaid mesh WiNoC demonstrates a nice network scalability when implemented with DRS and HMCA.



VI. CONCLUSION  To exploit the performance potentiality of overlaid mesh WiNoC, a cross-layer design approach has been proposed  0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08           Injection Rate  N et  w or  k T hr  ou gh  pu t (  G bp  s)  12 by 12 10 by 10 8 by 8  (a) Network throughput.

0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08        Injection Rate  E nd  2E nd  D el  ay (C  yc le  s)      12 by 12 10 by 10 8 by 8  (b) End-to-end delay.

Fig. 10. Performance comparison under different network scales.

in this paper. A dynamic routing selection scheme has been proposed to alleviate congestion is a way that dynamically diverts traffic by route detouring. To most efficiently distribute and share the minimal number of channels, an efficient chan- nel assignment and handshaking based arbitration strategy has been developed in coping with overlaid routing. Such coherent optimization-motivated cross-layer design strategy results in significant performance improvement. Besides the performance advantage, the new design can efficiently reduce design complexity and implementation cost without any wiring concern.

