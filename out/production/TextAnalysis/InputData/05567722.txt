The Applied Research of Kalman in   the Dynamic Travel Time Prediction

Abstract?The dynamic travel time prediction is important contents of The intelligent Transportation System. Dynamic travel time is updating the travel time by the prediction model on the same path or segment of the journey. Different forecasting models are corresponded to different methods, and different methods are corresponded to different prediction accuracy. Contrast to the existing methods, such as historical trends method, non-parametric regression, time series, neural networks, travel time prediction method, The Kalman filtering is best in dynamic information forecasts. Due to the unpredictability of traffic Factor impacting the travel time, the change of dynamic travel time have not strict laws. while the Kalman filter can full use of travel time variation to reflect changes. The all parameters of the kalman filter are carefully analyzed in this float car test, the adjacent speed of the float car is selected as the state vector, the observation vector is obtained by converting coordinates and observation time because the speed of floating cars is instantaneous speed whose error is big, and other parameters are introduced in the article. Then the method of establishing the Kalman filter equation is proposed by the long interval GPS datum in the urban. For the continuous driving vehicles, the rear travel time can be constantly updated when the observation value of the travel time is obtain in certain segments due to continuation of time and space. Then the updated travel time will be closer to the real value. So the parameter regression smoothing approach is proposed based on the result of kalman. For Verifying accuracy of Kalman filter, three periods are selected for time of the GPS data. From 5 error targets that included the mean relative error, the mean absolute relative error, the maximum absolute relative error, the equal coefficients and the mean square root of the relative error squared, the error of the kalman filter is researched. So the results are shown that the maximum value is the maximum absolute relative error of the 14:15-14:30 time period, but its value is also only 0.015. It is shown that the forecast model has highly predicting accuracy in all periods. To further prove this conclusion, the all time periods are also studied. It can be seen from the all periods that the predicted result are lower than the statistics travel time. The main reason is excluding the data that the speed is zero in the raw data, and it is always assumed that the vehicle is running when the speed of the float car is calculated. Therefore the results of Kalman filter need to be carried out the necessary smoothing process. As the known data of three segments is used in the second improved model, the data processing should be started form the fourth segment. The predicting result shows that the accuracy of improved model is higher than the kalman.

Keywords- Kalman filter; Kalman filter; ITS; GPS datum; dynamic travel time prediction; observation white noise

I.  INTRODUCTION Dynamic travel time is updating the travel time by the  prediction model on the same path or segment of the journey.

Different forecasting models are corresponded to different methods, and different methods are corresponded to different prediction accuracy.[1] Contrasted to the existing methods, such as historical trends method, non-parametric regression, time series and neural network, [2] the Kalman filtering is best in dynamic information forecasts. Due to the unpredictability of traffic Factor impacting the travel time, the change of dynamic travel time have not strict laws. While the Kalman filter can full use of travel time variation to reflect changes.



II. DISCRETE-TIME KALMAN FILTER Rudolf Emil Kalman who is mathematician of United States  proposed Kalman filter. The Kalman filter was extracted from the signals measured through the observation method to estimate the required signal and can handle one-dimensional or non-stationary or multi-dimensional random process. The data storage capacity of kalman filter is also small. Because of the advantages of Kalman filter, the theory has been applied in many engineering fields after it was proposed. The theory of Kalman filter is introduced to forecast travel time in the article, and the improved algorithm is established. Kalman filtering was divided into two kinds that the one is continuous-time and the other is discrete- time. Because the collected information of the GPS floating car is discrete points, the Discrete-time of Kalman filter is used in predicting the travel Time. [3]  The Discrete-time of Kalman filter uses the state-space model that includes the state equation and observation equation composed to describe the filter. According to the criteria of linear unbiased minimum mean square error estimation, the state variable are given the best estimate by using the recursive nature of state equations and a set of recursive algorithm. The discrete- time of Kalman filter model is as follows:  ? ? ?  +?= ?+??= ????  kkkk  kkkkkkk  VSHZ WSS 11,11,                               (1)  Where, Sk is the n-dimensional state vector, Zk is the m- dimensional observation sequence, 1, ?? kk (n) is the n?n- dimensional state transition matrix, 1, ?? kk  is the n?p-dimensional noise input matrix, Hk is the m?n-dimensional observation matrix, Wk-1 is the p-dimensional system process noise, Vk is the  Supported by the Projects of Liaoning Province University Innovation Team (2008T085, 2007T072),  Liaoning Province University Key Laboratory(2009S04 9).

m-dimensional observation noise sequence. W and V are assumed to be zero mean white noise and not relevant. [4]  The core of Kalman filter is the evaluation model that is also one of recursive algorithms. The value of state estimation is determined by the state estimates and the current observed values. It is problem of Kalman filtering that the linear minimum variance estimation ( njS ,? ) of the state (Sj) is calculated based on observed value (Zn,Zn-1,?,Z1). The minimum target is as follows.

( ) ( )?????? ??= njj T  njj SSSSEJ ,, ?? (2)  The formula is the Kalman filter when j is equated to t; the formula is smoother when j is smaller than t; the formula is predictor when j is greater than t. The process of Kalman filter is introduced as example in the following.

From the priori estimates ( 1,? ?kkS ) and prediction error covariance matrix P(n). The third equation of the formula 3 is used to calculate the optimal gain factor (Kk). Then the new observation vector (Zk) is used to calculate the updated parts ( ]?[ 1, ?? kkkkk SHZK ). The second equation of the formula 3 is used to update estimation ( kS? ) of the state vector (Sk).

The several important equation of Kalman filter is as follows:  [ ]?? ? ?  ?  ?? ? ?  ?  ?  ?= ??+??=  +=  ?+=  ?=  ?  ???????  ? ??  ??  ???  1,  1,11,1,11,1,  1,1,  1,1,  11,1,  ][  ]?[??  ??  kkkkk  kkkkkkkkkkkk  k T kkkk  T kkkk  kkkkkkkk  kkkkk  PHKI QP  RHPHHPK  SHZKSS  SS  ? ?  (3)  The formal 3 is a filtering cycle of stochastic linear discrete- time Kalman filter. The Kalman filter has two distinct information update process, one is time update process, and the other is observation update process. The first equation of the formula 3 is the method that the k state is estimated by the k-1 state, and the fourth equation of the formula 3 is used to make a quantitative description for the quality of forecasts. The other equations of the formula 3 are used to calculate the rectification value of time-updated, the rectification value is reduced from the quality of time update (Pk,k-1), the quality of observing information (Rk), the relationship between observation and state (Hk), and the specific observation information(Zk). All equations is used to a purpose that observation information (Zk) is correct and rational used. Therefore, the formula 3 is describing the observation update process of Kalman filter.



III. IMPROVED MODEL  OF  KALMAN For the continuous driving vehicles, the rear travel time can  be constantly updated when the observation value of the travel time is obtain in certain segments due to continuation of time and space. [5] Then the updated travel time will be closer to the real value. The formula is as follows:  kk SSkkT ?/?*)(T)1(' 1+=+                                                    (4)  Where, kS?  is the predicting travel time of the k segment by Kalman Filter; T(k) is the statistics travel time of the k segment;  )1(' +kT  is the revised travel time of the k+1 segment.

Because the vehicle speed is affected by a lot of accidental factors, this continuation will be destroyed when the speed changes. [6] The ratio is changed suddenly by the sudden and accidental events. The ratio between true value and estimate value in three continuous segments are used in the formula 5. The ratio is also allocated a certain weight. The date will be removed when the ratio is more than two.

)?/)2(?/)1(?/)((*?)3(T 231213 +++ +?++?+?=+? kkkK SkTqSkTqSkTqSk   (5)

IV. THE REALIZATION OF DYNAMIC PREDICTION MODEL Variables and parameters of Kalman filter need to be  explained in travel time prediction, based on the introduction of the Kalman filter and its improved model.

A. The Update Frequency of Dynamic Travel Time The Kalman filter need the time update, then the continuous  time is processed to discrete time. For dynamic vehicle navigation systems, the service and operational quality are directly affected by the update frequency and data quality of traffic information. [7] First, the system can not withstand the high update frequency. Such as the update time is 3 or 5 minutes, due to the instability of the traffic parameters in the short term and the frequent changes in the high update frequency of traffic information, the navigation center server is overloaded by the redesigning the path of navigation devices; Second, the update time can?t also be a long time. Such as the update time is 20 to 30 minutes, the role of the dynamic and real-time traffic information can?t be showed. [8] The sampling interval of the GPS floating car is 2min in this paper. In excluding the problem data, the update time is 15min in the paper for the changing stability of traffic parameters and ensuring to exist at least two consecutive GPS points in each segment.

B. State Vectors and Observation Vectors The travel time of segment is affected by many factors, such  as speed, road share, road grade, road width, weather conditions, unexpected traffic incidents etc.  [9] Excluding the neural network model, the most relevant factor with speed is chosen. According to the characteristics of GPS datum, the speed of the adjacent time is selected as the state vector.S0 the Sk is expressed as  [ n k  i kkk SSSS ,,  ], where  i kS  is the travel time of the k time period  in the i segment.

The GPS floating car can directly collect the information  including the coordinates and the car speed. [10] But the speed of floating cars is instantaneous speed, the error is big. So the observation vector (Zk) is obtained by converting coordinates and observation time.

C. Other Parameters The initial value of S0 and P0 can?t yet have been determined  by a mature and objective way. With increasing of time, Sk and Pk will gradually get rid of the respective initial impact. But the major deviation are existed in the initial value, the filtering result still will have a greater error. Therefore the starting state vector of the same cycle is selected as S0. P0 is given by the specific    data, such as the analysis result of test datum, the experience. The system noise (Qk) and the observation noise (Rk) are also determined by the analysis result of test datum. It can?t be come true and can?t even be done in some condition that the system noise and the observation noise is accurate given, Because the error source of the float car in the urban is more complex, including instruments, satellite distribution, regional condition, traffic condition and so on. So the system noise and the observation noise are given a more reasonable value depending on the analysis of specific data.

D. Experiment All GPS datum that are collected in 9:45-18:30 June 25, 2007  and relevant with Haining Road, Yalu River Road and Zhouiiazui Road and the division of segments are shown in fig. 1.

.

Figure 1.  The segments and the associated GPS points  Each segment of the travel time is showed in the following table.

TABLE I.   THE TRAVEL TIME OF EACH SEGMENT  Time The travel time of each segment(s) 1 2 3 4 5 6 7 8 9 10 11 12 13 15:15-15:30 82 173 88 115 78 78 83 83 51 51 81 81 45 15:30-15:45 64 91 98 108 159 64 46 128 178 37 131 166 34   ? is 0.5342 and ? is 27.9523 in the state equation based on  the data in the table?. The value of other groups are omitted due to ?  is greater than 1 or ?  is too large,  The change travel time of the previous 20 segments are showed in fig. 2, Each color lines represent different segment. If ?  is greater than 1, it represents that Sk of the state equation of is rapidly increased. With the time gone, the travel time of the segment becomes longer. But the change travel time is not incremental in fig. 2. So it is error that ?  is greater than 1. It isn?t consistent with the distribution of the travel time that ?  is too small than 1. The minimum value of ? is about 30 based on the fig. 2. Because the first item of state equation is always positive, ?  can?t lager than 30. The data of table?can only meet the two conditions in all groups datum.

Figure 2.  The change of travel time  Due to the accuracy of travel time, two places rear decimal is retained. S0 the state equation is as follows:  kkk WSS 2853.01 +=+                                        (6) The mean of observation matrix is 1.0453 based on the data  of all 35 time segments. For facilitating the operation, H is equal to 1. Then the observation equation is as follows:  kkk VSZ += +1                                                 (7) S0 is [48 53 76 76 45 61 61 70 105 34 29 114 113], the matrix  is the travel time of all segments in 9:45 ~ 10:00. Then the variance of S0 is 797.5769, so P0 is 798.

The values of Q and R are determined by experimental Analysis based on the conditions of the above information.

0 2 4 6 8 10 12 14 16 18 20 -2.5  -2  -1.5  -1  -0.5   0.5  0 2 4 6 8 10 12 14 16 18 20  0.02  0.04  0.06  0.08  0.1  0.12  0.14  0.16  0.18   (a?                                               (b)  Figure 3. The change condition of Q value In fig. 3, Q is selected from 0.1 to 2 with 0.1 intervals when R  is remained the same value. The fig. 3 is the change condition of travel time in the 20th time period (14:30-14:45). It is shown in a diagram that the travel time of all 13 segments is changed when Q is given different values. The b diagram indicates the change condition of variance when Q is given different values. It can be seen from the diagram that the travel time and variance are close to stability when the abscissa is 10. So Q = 0.1 +10 ? 0.1 = 1.1.

After Q is determined, the observation white noise R is equal to 2 in the discrete Kalman filter model through the same method.



V. COMPARATIVE ANALYSIS OF ACCURACY According to the above S0, P0, R, Q and the equation of the  Kalman filter, it is all segments of fig. 1 form10:00 to 11:00 that the forecast travel time and the statistics travel time is showed in table ?.

TABLE II.   THE CONTRASTIVE OF TRAVEL TIME  The No. of segments  The forecast travel time (s) the statistics travel time (s) 10:00~ 10:15  10:15~ 10:30  10:30~ 10:45  10:45~ 11:00  10:00~ 10:15  10:15~ 10:30  10:30~ 10:45  10:45~ 11:00  1 137.5 50.6 72.6 60.5 247 55 140 108 2 44.0 51.7 40.7 48.4 92 37 85 46 3 163.9 80.3 107.8 50.6 149 80 95 88 4 86.9 49.5 50.6 48.4 96 94 101 86 5 86.9 60.5 69.3 117.7 95 103 128 66 6 73.7 49.5 73.7 83.6 65 69 69 51 7 73.7 57.2 81.4 50.6 66 62 50 51 8 46.2 58.3 50.6 38.5 43 76 53 47 9 46.2 104. 5 50.6 60.5 74 102 51 119  10 96.8 80.3 37.4 39.6 49 192 45 45 11 119.9 64.9 45.1 44.0 59 72 82 62 12 72.6 128.7 40.7 55.0 71 67 47 85 13 42.9 96.8 177.1 119.9 172 71 165 146   According to Table ? , the comparative condition of the  prediction and statistical travel time is shown in Fig. 4.

Figure 4.  Comparative travel time of forecast and statistics   Figure 5.  The difference distribution of four periods  The forecast situation of 13 segments within the study area in the four time period is listed in table?. It can be seen from fig. 4 and fig. 5 that the bias is existed between the predicting results of Kalman filter and the corresponding statistical time. The travel time is analyzed when the collecting data is only started by the float car in table?. Then three periods are selected for time of the GPS data in table?. The period (10:30-10: 45) is near the start of collecting GPS datum, the period (14:15-14: 30) is near the middle of collecting GPS datum, the period (18:00 -18:15) is close to the end of collecting GPS datum. From 5 error targets that included the mean relative error (mrerr), the mean absolute relative error (marerr), the maximum absolute relative error (mxarer), the equal coefficients (EC) and the mean square root sum of the relative error squared (nmrerr) , the error of the travel time is researched. So the results are shown in table ?.

TABLE III.  THE PREDICTING ERROR OF THE TRAVEL TIME  Error targets Time periods  10:30-10:45 14:15-14:30 18:00-18:15 mrerr(?) 0.9043 2.2000 1.6000 marerr(?) 1.4000 2.9000 2.1000 mxarer(?) 5.7000 15.0000 8.1000 nmrerr(?) 2.1000 4.9000 3.5000  EC 0.9994 0.9991 0.9989  The error between result of Kalman filter and the observed  travel time are analyzed in table ?. The maximum value is the maximum absolute relative error of the 14:15-14:30 time period, but its value is also only 0.015. It is shown that the forecast model has highly predicting accuracy in all periods. To further prove this conclusion, the mxarer distribution of all 32 time periods is shown by fig. 6.

Figure 6. The mxarer of Kalman filter  TABLE IV.  THE PREDICTION RESULTS OF TWO IMPROVED METHODS  The No. of segments  The first improved model The second improved model 10:00~ 10:15  10:15~ 10:30  10:30~ 10:45  10:45~ 11:00  10:00~ 10:15  10:15~ 10:30  10:30~ 10:45  10:45~ 11:00  4 79 49.3 44.6 84.2 126.1 45.4 73.8 71.8 5 96 114. 9 138.3 209.1 104.6 84.7 113.6 191.4 6 80. 6 84.3 136.1 46.9 78.6 81.7 127.9 97.2 7 65 79.7 76.2 30.9 72.9 90.4 115.3 39.9 8 41 63.2 31. 1 38.8 42.7 75.2 46.9 30.89 9 43 136.2 53 73.8 42. 1 130.1 44.7 63.4  10 155 78.4 37. 7 77. 9 122. 88.6 35.7 61.7 11 60.7 155.2 54.3 50 112.9 112.8 50.2 62.8 12 35.7 142.8 74 77.5 49.5 194.9 60.2 77.6 13 41.9 50.4 204.5 185.3 31.6 99.6 245.1 171.7   It can be seen from Fig. 4 and Fig. 5 that the most predicted  results are lower than the statistics travel time. The main reason is excluding the data that the speed is zero in the raw data, and it is always assumed that the vehicle is running when the speed of the float car is calculated. Therefore the results of Kalman filter need to be carried out the necessary smoothing process. As the known data of three segments is used in the second improved model, the data processing should be started form the fourth segment. The weight is given by range principle. For the k segment, the weight of the k-1 segment is 3/6, the weigh of the k-2 segment is 2/6, and the weigh of the k-3 segment is 1/6. There are two ways to    improve the forecast results of two improved models is shown in table ?.

Figure 7.  The result of the first improved model   Figure 8.  The result of the second improved model  From the results of prediction, the effect of smoothing is not obvious. As it is mainly reason that the self-continuity of the observation data is poor, the internal regular is destroyed.

However, the forecast result of Fig. 8 is better than the one of Fig.

7. Form the case, it is shown that the forecast result is fluctuated when the proportion of the accidental factors is too large in a single segment.



VI. CONCLUSION In this paper, Kalman filter model is applied to the predicting  field of the dynamic travel time. The method of establishing the  Kalman filter equation is proposed based on GPS datum of the float car. And the two improved models of kalman filter are established by the correlation of the adjacent segments. Through the error of the Kalman filter model and two improved methods is researched by comparative analysis in the prediction accuracy, the discrete-time Kalman filter model is lower than the smoothing model of parameter regression in accuracy, the second improved model is superior to the first improved model.

