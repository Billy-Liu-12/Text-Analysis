

Abstract?The MErcury Surface, Space ENvironment, GEochemistry, and Ranging (MESSENGER) spacecraft is on its way to Mercury after a successful August 2004 launch. Upon arrival at Mercury in March 2011, the spacecraft will investigate and return science observations that will dramatically enhance our knowledge of Mercury and thus of the inner solar system. Through a hybrid approach using CCSDS File Delivery Protocol (CFDP) to enable link margin reductions and date rate optimization during communication contacts, The Johns Hopkins University Applied Physics Laboratory (JHU/APL) performed several in-flight tests and achieved significant science data return improvement while maintaining data reliability for this first Mercury orbital mission12   TABLE OF CONTENTS   1. INTRODUCTION........................................................ 1 2. MESSENGER?S LINK STRATEGY.............................. 2 3. MESSENGER FILE-BASED SYSTEM ......................... 2 4. HYBRID-BASED OPTIMIZATION.............................. 3 5. SCIENCE DOWNLINK LINK MARGIN....................... 3 6. DOWNLINK RATE ADJUSTMENTS ........................... 4 7. DSN ANTENNA TARGETING ..................................... 4 8. IN-FLIGHT PHYSICAL LAYER RESULTS.................. 5 9. CFDP PROTOCOL LAYER RESULTS......................... 5 10. CFDP RETRANSMISSION AND LATENCY ................. 6 11. SUMMARY ................................................................ 7   1. INTRODUCTION The MESSENGER spacecraft is on an interplanetary cruise that will end on March 18, 2011, when MESSENGER will be the first spacecraft to orbit Mercury. MESSENGER will carry out a broad range of observations of Mercury for one Earth year including a radio science investigation to determine whether the planet has a liquid core.

MESSENGER?s instruments will collect data to be stored on the spacecraft?s solid-state recorder (SSR) and later forwarded to NASA?s Deep Space Network (DSN). Once received on Earth, the DSN will then forward scientific and spacecraft housekeeping data to the MESSENGER Mission   2 IEEEAC paper 1630, Version 5, Updated January 17, 2008  Operations Center (MMOC) at JHU/APL in Laurel, Maryland. The robustness of MESSENGER?s onboard data file system will help to enhance the quantity of scientific data beyond pre-launch estimates [1].

While in Mercury orbit, MESSENGER will contact the DSN 12 times per week to downlink data to Earth, with each contact lasting approximately eight hours. The quantity and quality of scientific data that can be expected to be returned from Mercury is determined by several factors: (1) the DSN contact schedule, which is established by agreement prior to launch, (2) the spacecraft?s radio frequency (RF) telecommunication subsystem design and effective isotropic radiated power (EIRP), (3) the DSN?s nominal performance including antenna and receiver performance, and (4) link margin requirements imposed by the mission team. For MESSENGER, the minimum required science data return objectives are met. The techniques outlined below show how optimization and link margin reductions allow enhanced science return without sacrifice of data quality by means of a hybrid approach to the physical and protocol layers to ensure data integrity.

Link margin is required to assure that the scientific data will not be lost by deviations from the expected performance.

Deviations can include weather, solar noise, wind, and random antenna pointing errors (both spacecraft and DSN).

In the case of MESSENGER the baseline link margin is 1.5 dB.

The DSN?s nominal performance is not fixed but is often treated as such for simplicity. Such a first-order approach with a static model of DSN performance, however, will not yield an optimum link design. Optimizing a deep space telecommunications link almost always translates into maximizing the ground-received signal-to-noise ratio. Pre- launch estimates of data return for MESSENGER were non- optimized.

The DSN?s performance is antenna specific and varies with antenna elevation angle. Recent 34m beam wideguide (BWG) antenna performance upgrades have been completed by the DSN to DSS-26 Goldstone, California, DSS-34 Canberra, Australia and DSS-55 Madrid, Spain, which have significantly improved their overall performance. The resulting performance improvement better allows for     optimization techniques to be pursued because the atmospheric noise as a function of elevation angle is a larger portion of the total noise. Atmospheric noise can be a significant challenge at low antenna elevation angles.  The signal from the MESSENGER spacecraft passes through multiple effective layers of the Earth?s atmosphere, due to the slant angle effect, thus attenuating the signal more than if the signal passed through a single layer of the atmosphere at zenith. As an example, at a 10 degree elevation angle a 34m antenna, DSS-24 in Goldstone, California, has an atmospheric noise temperature, Tatm, of 15.38 K or 5.63 air masses.

The receiver electronics are cryogenically cooled to reduce the additive noise of the active device so that it can receive extremely small signals from throughout the solar system.

Waveguide loss, spillover, scatter and other losses are combined with the noise temperature of the receiver electronics to form the noise temperature, Tvac, which is the effective noise temperature of the ground antenna in the absence of atmosphere. The gain, G, of an antenna reflector changes with elevation angle due to the deformation of the main antenna reflector from the rigging point, typically a 45 degree elevation angle [2]. Therefore, the gain-to-noise temperature of a DSN antenna at a given elevation angle is   ? ? ?  ? ? ?  ,  K dB  T G  sys (1)    vacsys TTT += atm , (K).  (2)   The changing gain-to-system noise temperature of an antenna, a key metric of DSN performance, makes optimization possible by changing the science return data rate to match the changing G/Tsys, thus maximizing the signal-to-noise ratio at the antenna.

Science data return can be managed in several ways depending on the needs and risk tolerance of the individual mission.  Mission operation teams can use a ?set and forget? approach, meaning the science return data rate for an individual communication pass uses a single rate based on the worst G/Tsys  of all DSN antennas of the same size at a set elevation angle and worst case weather conditions. This approach allows mission planners to anticipate and easily accommodate last minute antenna changes to the DSN schedule due to last minute maintenance, non-functioning antennas, mission emergencies or other local DSN issues.

This approach does not allow for any degree of optimization but makes data rate management simple from a planning and execution perspective. This paper will compare this approach to an antenna specific optimized link design using CFDP.

2.MESSENGER?S LINK STRATEGY Optimization techniques have been previously explored to improve data return using the DSN at X-band and Ka-Band  by taking advantage of changes in G/Tsys over the course of a communications contact with a spacecraft [3-5].  From an operational standpoint changing the data rate to match the changing G/Tsys performance or lowering the link margin does impose challenges that could prove to outweigh the advantages of additional scientific data. As an example, when files are transmitted from the spacecraft?s SSR to the MMOC, data will be missing because of changes in data rate or a negative link margin. In the absence of an automatic re-transmission protocol, the mission operations teams will have to identify the missing pieces of the files and then, at a later track, command the spacecraft to play back the missing file pieces. Meanwhile, the file on the SSR cannot be deleted until it and all other files have been examined for missing data, even though additional files are being added to the SSR. Depending on the speed and frequency of DSN contacts an SSR oversubscription can occur. Human error can also cause files to be deleted from the SSR before the missing data can be reconciled.

3.MESSENGER FILE-BASED SYSTEM MESSENGER?s scientific instrument and spacecraft housekeeping data are downlinked from the spacecraft?s onboard file system by a standard defined by the Consultative Committee for Space Data Systems (CCSDS), called the CCSDS File Delivery Protocol (CFDP) [6].

CFDP is a protocol developed by CCSDS for the transmission of files from two entities in a space network.

Similar in concept to the File Transfer Protocol (FTP) used in terrestrial networks, it is designed to operate across space links that typically have intermittent connectivity, long delays, and high error rates. The entities in the MESSENGER architecture are: 1) the spacecraft?s on-board file system and the protocol layer; 2) the MMOC ground software; and 3) the MESSENGER X-band RF Telecommunications Subsystem acting as the physical layer between the two locations. JHU/APL engineers implemented the flight software and integrated a CFDP core, developed at the Jet Propulsion Laboratory (JPL), into the standard ground software [7-8]. CFDP is configurable to perform both reliable and unreliable transmissions.

MESSENGER uses reliable transmission.

CFDP operates on a series of transactions, each of which constitutes the transmission of a file from one data store to another. For MESSENGER the operations team transfers files only from the spacecraft to the ground, as legacy software is used to send data in the opposite direction. A file transfer is initiated either by the on-board software or via an operations command as shown in Figure 1. To begin the transaction, a metadata protocol data unit (PDU) is transferred to the ground. This PDU contains information such as the identifier for this transaction as well as the filename. Following this transmission, the CFDP software subdivides the file into multiple file data units or FDUs. The spacecraft radiates these FDUs until all data from a file have been sent. The software then signals this event by transmitting an end of file (EOF) PDU. At this point, the     CFDP software starts a timer to ensure that a reply to this EOF is received within a reasonable time.

Fig. 1 CFDP transaction between the MMOC and the MESSENGER spacecrafts onboard file systems.

While the flight software is sending the various PDUs, the MMOC software is collecting the pieces of the file for storage in the mirrored file system on the ground. The software is also verifying that all pieces of a file are received. Once an EOF PDU is collected on the ground and an acknowledgment (ACK) PDU is transmitted to the spacecraft to confirm reception, the ground software in the MMOC notifies the spacecraft what pieces of a file, if any, are missing through a negative acknowledgement (NAK) PDU. When the flight software receives this PDU, it retransmits the missing FDUs to the ground. Then, if the MOC CFDP determines that the file is complete, it radiates a finished indicator (FIN) PDU to the spacecraft signifying the successful transmission of the file. The flight software completes the handshake by sending a FIN ACK to the ground, and the transaction is complete and the file is deleted from the SSR.

The MESSENGER team operates CFDP in real time, meaning that underlying software communicates during the pass to transport, handshake, and delete files. CFDP requests only those pieces of the file that are missing, sending the requests in real time or, if the pass is complete, during the next available contact. Missing FDUs have priority for playback over all other files in the file systems.

4.HYBRID-BASED OPTIMIZATION  CFDP enables techniques for link optimization to be pursued without encumbering the mission operations team to identify and reschedule transmission of dropped or missing FDUs.  It also avoids the risk of losing highly valuable scientific data from the oversubscription of the recorder that may come if the file deletions are delayed.

MESSENGER conducted several in-flight experiments  incorporating the following strategies for link optimization and improved science return using CFDP:   1. Reduce the science return downlink margin?from  1.5 dB to 0.5 dB 2. Implement a stepwise-variable downlink rate  adjustment?change the downlink bit rate for every ?0.5 dB change in G/Tsys and maintain the minimum link margin of 0.5 dB over the course of the communications period.

3. Select a downlink rate commensurate with the current elevation angle based on a model of individual antenna performance, with consideration of weather, solar and wind conditions instead of minimum elevation and weather worst case weather assumed in the planning phase   Both physical and protocol layers are used to ensure data integrity. If a downlink transfer frame is not correctable by the DSN using the physical layer, the transfer frame is not sent to the MMOC and will be missing. The protocol layer, CFDP, will recognize that downlink FDUs are missing and request a retransmission.

5. SCIENCE DOWNLINK LINK MARGIN The variability of an X-band RF link due to weather conditions is not large as for Ka-band. Table 1 shows the weather variability of an X-band link at DSS-34 at 10 degrees and 80 degrees elevation. The column labeled "Weather Conditions" refers to the percent of time that the G/T performance exceeds the value stated [9].

Table 1. G/Tsys for DSS-34, X-Band  Weather Conditions  G/T (dB/K) Elevation 10?  G/T (dB/K) Elevation 80?  G/T (dB)  0% 52.79 54.91 2.12 20% 52.67 54.88 2.21 50% 52.42 54.81 2.39 90% 51.90 54.65 2.75 99% 51.76 54.61 2.85 ? G/Tsys Weather  1.03 (dB) 0.3 (dB)   The design of an X-band link for 90 percent weather conditions with 0.5-dB margin signifies that weather conditions alone would not reduce the availability or reliability of the link. However, if the link was designed for 20 percent weather conditions then weather conditions could reduce the availability of the link until the antenna elevation angle increases sufficiently to overcome the margin deficit, this is especially true at low elevation angles.

Variability due to circumstances such as wind and antenna pointing accuracy were considered static conditions for the experiments outlined in this paper. The MESSENGER spacecraft was giving a 0.1 dB pointing accuracy loss and     the DSN was 0.2 dB loss for wind conditions and deformation of the aperture. Any variability outside these static conditions was not considered.

If the variability of the link caused by weather, wind or pointing error exceeded the 0.5-dB link margin then CFDP would be required to retransmit the data that were missing.

The net observed increase in data volume cause by lowering the link margin from 1.5dB to 0.5 dB is   )log(101)( ??+=? dB   (3)  ?  is the total frames minus the frame errors from all random sources divided by the total number of frames received.

If the link frame error rates exceeded the net increase in data to be gained by lowering the link margin form 1.5 dB to 0.5dB, the added benefit would not be realized. Therefore, careful modeling of the link is required.

6. DOWNLINK RATE ADJUSTMENTS Table 1 demonstrates that as the antenna elevation angle rises or lowers so does the G/Tsys performance of the antenna system.  To take advantage of the changing G/Tsys the downlink bit rate can be changed to mirror the changing G/Tsys. Due to the MESSENGER spacecraft architecture, the downlink rate cannot be changed continuously with G/Tsys therefore, can only be changed in a stepwise fashion. The mathematical foundation of the science volume improvement obtained from a step wise variable bit rate was been extensively developed and is discussed briefly herein for completeness [4]. An effective G/Tsys for a pass can be calculated as:    ( ) dtt T GdB  T G  stepwise  t  t syseffsys  LOS  AOS ? ????????=???????? )(,,)( ???    (4)  where ?  is designed  link availability to due to weather ,? is the size of the step in dB, MESSENGER choose 0.5 dB and ?  is the antenna elevation angle as it changes due to the rotation of the Earth and spacecraft heliocentric position.

The number of steps is determined by the antenna  performance, step size and the length of the communications pass.

An improvement factor can be calculated for the stepwise downlink rate change as compared to a fixed bit rate strategy for a particular DSN antenna and communications pass   ( ) )log(10  , )( ?  ?? ?+  ? ? ?  ? ? ? ?  ?  =?  sys  effsys  T G  T G  dB   (5)  where  ( )?? ,o sysT G  represents the lowest planned elevation angle  for a communications pass  and ?  represents the planned link availability, ? is the total frames minus the frame errors caused by changing the bit rate divided by the total number of frames received.

7. DSN ANTENNA TARGETING  The experiments conducted in this paper targeted the specific performance of individual DSN antenna; particularly those with the best overall performance using a G/Tsys model provided by the DSN. In doing so, the total science volume for the mission can be increased as opposed to applying a worst case antenna performance model to science volume calculations. The use of worst case antenna performance allows antennas of similar size to be swapped in the DSN schedule with little or no consequences to the expected science data return, but does not allow for optimization.

( )  ( ) Antenna  DSN  CaseWorst  Antenna  DSN  Targeted  %90,10  ,  )(  ? ? ?  ?  ? ? ?  ?  ? ? ?  ?  ? ? ?  ?  =?  sys  sys  T G  T G  dB  ?? (6)                 16:00:00  16:15:00  16:30:00  16:45:00  17:00:00  17:15:00  17:30:00  17:45:00  18:00:00  18:15:00  18:30:00  18:45:00  19:00:00  19:15:00  19:30:00  19:45:00  20:00:00  Time (UTC)  D ow  nl in  k D  at a  R at  e (b  ps )             G /T  sy s  (d B  )  Stepw ise Dow nlink Rate (bps) Conventional Dow nlink Rate (bps) G/T (dB) Stepw ise 20% Weather G/T (dB) Fixed 90% Weather  Fig. 2 Comparison of a fixed downlink with 1.5 dB margin at 90 percent weather and 10 degrees elevation angle to the stepwise downlink rates with 0.5dB margin using 20 percent weather conditions. Also shown is the G/Tsys of DSS-26 on DOY 333 with 20% weather and 0.5 dB margin and 90% weather and 1.5 dB margin.

A total science return improvement can be now calculated using a reduced link margin, stepwise downlink rate and a targeted antenna performance approach using:   ( ) ?+?+?=? dB .  (7).

8.IN-FLIGHT PHYSICAL LAYER RESULTS  Six in-flight experiments were conducted to measure the science improvement and resulting overhead using the previously described link optimization strategy. The experiments were conducted in 2006 on DOY 324 with DSS-26, DOY 329 and 331 with DSS-14, DOY 333 with DSS-26 and DOY 334 and 345 with DSS-343.  Figure 2 shows the data rates flown on DOY 333 and the corresponding G/Tsys. Also shown in Figure 2 for comparison is single rate approach if the 1.5 dB margin and 90% weather and its corresponding G/Tsys.

Table 2 shows the results of all experiments and the physical layer interaction with the in-flight experiment. It can be seen that a very small overhead is associated with an average overall gain of 3.357 dB over a conventional worst case fixed bit rate design with link margin 1.5 dB.

To verify the techniques presented in this paper, the MESSENGER team developed a two phase approached to examine throughput.  The first phase, described below, was a proof of concept and developed to ensure minimal impact   3 Experiments conducted on DOY 333 through 345 were conducted using 20% planned weather conditions. All others were conducted at 90% planned weather conditions.

to current operations.  A second, longer campaign will be conducted later in 2008.

Table 2. Experimental Results DOY 324 to 346(2006)  D SS  ? (dB) ? (dB) ? (dB)  ? (dB)  ? (dB)  ? (dB)  -0.002 -0.004   0.998 0.390 1.590 2.978  -0.001 -0.002 0.999 0.926 0.880 2.805  -0.066 0.000 0.934 0.000 3.510 4.444  -0.003 -0.023 0.997 0.418 2.060 3.475  -0.001 -0.027 0.999 0.637 1.500 3.136  0.000 -0.005 1.000 0.301 3.000 3.301  A ve  ra ge  -0.012 -0.010 0.988 0.445 2.090 3.357    9.CFDP PROTOCOL LAYER RESULTS The overhead of the resulting protocol layer is an additional factor that needs to be considered as part as an overall improvement strategy.  If the overhead of the protocol layers is high, it could nullify the resulting throughput increase of the physical layer. To demonstrate that is not the     case for CFDP, the results from DOY 333 will be analyzed.

The DOY 333 results represent measured protocol layer throughput during the test. Four transactions were active during this pass, as shown in Table 3. Playback began with the completion of a NAK for transaction 454 from a previous pass. This was followed by the playback of transactions 457, 458, and 456. Transaction 456 was also a file continuing from a previous track, but it was preempted by the higher priority 457 and 458 transactions. The computed bit rates shown in the table are somewhat variable due to the granularity of the available telemetry and ground data.

Table 3. Transactions on Day 333, 2006   ID Size (bytes)  Playback Bit Rate (bps)  Computed Bit Rate (bps)  454 142854 4167 4024 457 929291 4167 4022 458 510739 4167 4025 456 2137400 4167 4031 456 1052400 4695 4541   During this session, mission operations configured MESSENGER to use two bit rates during which playback was active: (1) 5208.30 bps and (3) 5868.51 bps, and they also configured the spacecraft to transmit 4 file data frames to every one real-time frame. These settings provide effective science data rates of 4166.64 bps and 4694.81 bps respectively, given the ratio above. Using the observed flight data, CFDP adds approximately 1.2% to 1.4% of overhead which, together with framing overhead, gives the rates shown in Table 3. A transfer frame is 1115 bytes, of which 1095 are available for science data transfer. A typical conservative setting for the downlink rate during this phase of the mission is 2422.48 bps using a 10 degree starting elevation angle on 90% weather with 1.5 dB margin.

Playback was active for 9319s. With the real-time/playback ratio of 4:1, the effective downlink rate for science data would be 1903 bps given no additional overhead burden from CFDP. With this rate and the amount of available downlink time, 2216757 bytes would have been downlinked versus the 4772684 bytes of science data downlinked during the actual playback period.

10. CFDP RETRANSMISSION AND LATENCY Day 329 is an example of data retransmission by CFDP.

Table 4 shows the transactions active during this pass.

During this pass, several files required retransmission of data due to either drops in the link or switching between data rates.

Figure 3 represents CFDP operations during this playback period. Transactions 35-49 are represented by bars in the figure when that particular transaction was active in the playback queue. Multiple transactions required retransmissions due to either the commanded downlink rate switches (shown in yellow) or link dropouts (shown in red).

A CFDP FDU is 1024 bytes which is slightly smaller than  the available data size in a transfer frame. Hence, the majority of transfer frames contain the end of packet and the beginning of another. Therefore the loss of one downlink transfer frame results in the loss of two CFDP packets. This loss is recognized by the ground CFDP software which sends NAKs to the spacecraft listing the pieces of the file that are missing. This is represented by the NAKs shown on the right side of the graphic. Additionally, a portion of the pass was devoted to retransmission of data from a previous pass.

For missions that have large round trip light times or large file sizes or both, file latency caused by CFDP retransmission could impose challenges to SSR management and SSR size requirements.  In addition, missions that have time critical data such as navigation images may want to avoid the uncertainty of variable file arrival times due to retransmissions and added round trip light times.

The results in Table 4 show that the 46.6 % of the files required an additional retransmission or one or two FDUs.

As the files are sliced into multiple FDUs, only the individual missing FDUs require retransmission as opposed to the entire file.  That equates to 2 additional round trip lights time or the next available contact for the file to be complete. 53.3% of the files were able to be complete on the first transmission from the spacecraft to the MMOC.

Table 4. Transactions on Day 329, 2006   ID Size (bytes)  Number of Retransmission Required  Reason for Retransmission  35 869039 1  Link dropped 36 783365 1  Link dropped 37 645076 1  Rate changed 38 485998 0  No 39 498299 0  No 40 609778 0  No 41 591075 1  Link dropped 42 759107 0  No 43 814884 1  Link dropped 44 757560 0  No 45 628105 0  No 46 772999 0  No 47 759107 1  Rate changed 48 878915 0   No 49 27021773 1  Link dropped         Fig.3. Playback Results on Day 33, 2006   11. SUMMARY In-flight testing of the MESSENGER spacecraft demonstrated that a lowered link margin and stepwise changes in downlink data rate can significantly increase science volume without additional burden to the mission operations team using CFDP. CFDP added a small overhead to the downlink that was more than offset by the added volume obtained by the margin reduction and stepwise downlink rate changes. The above could be applied to Ka- band operations where link variability is an even more substantial concern.

ACKNOWLEDGEMENTS  The authors thank Bob Nelson of the MESSENGER Mission Operations Team for his hard work and support to make the in-flight experiments possible, as well as Scott Burleigh of JPL for his comprehensive responses to questions on the intricacies of CFDP during software development. We would also like to thank the NASA Science Mission Director for sponsoring MESSENGER.

