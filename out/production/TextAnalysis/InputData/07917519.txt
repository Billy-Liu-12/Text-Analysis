Understanding Customer Behaviour in Urban Shopping Mall from WiFi Logs

Abstract?Traditional ways of understanding customer be- haviour are mainly based on predominantly field surveys, which are not effective as they require labor-intensive survey. As mobile devices and ubiquitous sensing technologies are becoming more and more pervasive, user-generated data from these platforms are providing rich information to uncover customer preference. In this study, we propose a shop recommendation model for urban shopping mall by exploiting user-generated WiFi logs to learn customer preference. Specifically, the proposed model consists of two phases: 1) offline learning customer?s preference from their check-in activities; 2) online recommendation by fusing the learnt preference and temporal influence. We have performed a comprehensive experiment evaluation on a real dataset collected by over 39,000 customers during 7 months, and the experiment results show the proposed recommendation model outperforms state-of-the-art methods.



I. INTRODUCTION  As a driver of local economies, urban shopping malls play a significant role in maintaining economic growth, offering employment and providing a better quality of life. Given increasing number of homogeneous urban shopping malls, the retailers who in-depth understand customer behaviour will gain advantages to support personal recommendation service, since most shopping decisions occur in the shop and only 1/3 of shopping decisions is planned beforehand [5].

Even though a number of shop recommendation approaches for urban shopping mall have been recently proposed [3], [1], these approaches suffer from a number of limitations. These limitations include the assumption that the level of customer?s preference can be reflected by the check-in frequency, fail to model the relationship between customer?s preference and their check-in activities. Understanding customer behaviour in urban shopping mall has also attracted enormous research from traditional marketing research [6], [4], which are mainly based on predominantly field surveys from small populations, thus limited to scalability and are powerless to capture information from survey avoiders. To tackle these challenges, we propose MallRec, a shop recommendation model for urban shopping mall based on customer?s check-in activities. The idea behind our approach is customer?s check-in activities can be viewed as a contexture of behaviour that is motivated by their intention and preference, then we can infer customer?s preference from their history check-in activities.

The remainder of the paper is organized as follows: Section II describes the proposed recommendation model in detail.

Section III reports and discusses the experimental results.

Finally, we present our conclusion and future work in section IV.



II. TIME-AWARE RECOMMENDATION MODEL FOR URBAN SHOPPING MALL  The proposed model produces recommended shops by two phases: 1) offline modeling customer?s preference from their check-in activities; 2) online recommendation by jointly con- sidering the learnt customer preference and temporal influence.

A. Preliminary  For ease of the following presentation, we define the key data structures and notations used in the proposed model.

Definition 1. (WiFi Log) A WiFi log is a set of scanned WiFi records and denote by S = {s1, ...,si, ...}, si is a triple < u, ti,Ri > which means the RSS sample Ri is collected by customer u at time ti.

Definition 2. (Shopping Trajectory) A shopping trajectory is a sequence of shops that are consecutively visited by a customer, denote by L =< l1 ?? l2 ?? ... >, li =< u, p, ts, te > is a 4-tuple, ts and te is the start time and end time for visiting shop p.

Definition 3. (Check-in Activity) A check-in activity is a 4- tuple < u, p, ts,cst > that means customer u visits shop p at time slot ts, and cst is the residence time of this visit.

Definition 4. (Customer Preference) Customer preference I(up)  indicates the interest of customer u towards shop p.

For generating customer?s check-in activity, we need to map  each WiFi logs to the corresponding shopping trajectories.

Given a wifi log S = {s1, ...,si, ...}, we first utilize fingerprint- based localization [9] to map each RSS sample si ? S to the cor- responding shop, then construct the shopping trajectories L(S) based on chronological order and further extract customer?s check-in activity according to Definition 3.

B. Offline Modelling Customer Preference  Since most customers have a finite amount of resources (e.g., money and time) for shopping, they tend to visit a shop by matching their preference. In this way, we model      (ij) 1Y  (ij) 2Y  (ij) 2X  (ij) 1X  (ij)I(ij)z  Fig. 1: Graphical model of learning customer?s preference  customer?s preference as the hidden factor of his/her check- in activities. Formally, let Y (i j)1 and Y  (i j) 2 denote the check-in  frequency and average residence time of customer ui to shop p j, I(i j) denote the preference of ui to p j. Then, we utilize a graphical model to combine the influence of ui and p j to I(i j), as well as the influence of I(i j) to Y (i j)1 and Y  (i j) 2 , as shown in  Figure 1. The detailed description of variables in this figure is explained as follows: ? z(i j) denote the intrinsic preference of ui to p j, which  is a result of both personality and situational factors.

Motivated by [2], we capture customer?s intrinsic prefer- ence based on the widely used location co-occurrence. let ci j = 1 if ui has visited shop p j and 0 otherwise. Then, we construct the check-in vector of ui as c(ui) = {ci1, ...,ciN}.

Then the intrinsic preference z(i j) between ui and p j can be calculated by:  z(i j) = ?v?U sim(ui,v)? c < v, p j >  ?v?U sim(ui,v) (1)  where sim(ui,v) is the similarity between ui and v, and estimated by cosine similarity between c(ui) and c(v).

? x(i j)1 and x (i j) 2 are two auxiliary variables for check-in  frequency and residence time, respectively, such as the total number of visited shops or the average residence time of a customer.

Our model represents the relationships among these vari- ables by modelling the conditional dependencies as shown in Figure 1, so the joint distribution decomposes as follows:  P(I(i j),Y (i j)1 ,Y (i j) 2 |ui, p j) = P(I(i j)|ui, p j)   ? l=1  P(Y (i j)l |I(i j),X (i j) l )  (2) Given the intrinsic preference between customer ui and shop  p j, we model the conditional probabilities P(I(i j)|ui, p j) using the widely-used Gaussian distribution:  P(I(i j)|ui, p j) = (?z(i j),?2) (3)  where ? is a coefficient and ?2 is the variance of Gaussian model, which is set to 0.5 in experiments.

For modeling the dependency between Y (i j)l and I(i j),X (i j)l (l = 1,2), we analyze the characteristics of customer?s check-in activities (more details of customer?s check-in activities are shown in Table I.). Figure 2 shows customer?s check-in probability for different types of shops as a function of their check-in frequency and average check-in time. We observe that the distributions follow a similar power-law form, while the distribution parameters differ from different kinds  1 2 3 4 5 6  0.1  0.2  0.3  0.4  0.5  Check?in frequency  Ch ec  k? in  P ro  ba bi  lity  Restaurant Fashion Kid store Education Fitness Jewelry  (a) Check-in frequency  5 10 15 20 25 30 35 40 45 50 55 60  0.05  0.1  0.15  0.2  0.25  0.3  0.35  0.4  0.45  Average  Time (min)  Ch ec  k? in  Pr ob  ab ilit  y  Fashion Kid store Fitness Restaurant Jewelry Education  (b) Average check-in time  Fig. 2: Fraction of check-in probability as a function of check- in frequency(a) and average check-in time(b)  of shops. In this way, we model the dependency between Y (i j)l and I(i j),X (i j)l (l = 1,2) as follows:  P(Y (i j)l |I(i j),X (i j) l ) = (?l I  (i j) +?lX (i j) l )  ?l (4)  where ?l and ?l are the coefficients, ?l is the parameter of power law distribution, l = 1,2.

We further add L2 regularizes on these hyper parameters (e.g., ?1, ?1, ?1, etc.) to avoid over-fitting, which can be regarded as Gaussian prior:  P(?l ,?l)? e?(?l/2)(? l +?  l ), l = 1,2  P(?l)? e?(??l /2)(?l) , l = 1,2  P(?)? e?(??/2)?2 (5)  The data are represented as ? =U?P samples of customer- shop pairs, denoted as D = {(i1, j1), ...,(iN , jM)}. During training phase, the variables z(i j),Y (i j)1 ,Y  (i j) 2 ,X  (i j) 1 and X  (i j) 2 are all visible,  (i, j) ? ?. According to Equation 2, given all the observed variables, the joint probability is shown as:   ? l=1  P(?|? ,?l ,?l ,?l)P(? ,?l ,?l ,?l)  = ? (i, j)?D  P(I(i j)|z(i j),?)P(?)  ? l=1  P(D|I(i j),X (i j)l ,?l ,?l ,?l)  P(?l ,?l ,?l)  ? ? (i, j)?D  ( e?(1/2?  2)(?z(i j)?I(i j))2 2? l=1  (?l I(i j) +?lX (i j) l )  ?l  )  e?(??/2)?   ? l=1  e?(??l /2)(?l) e?(?l/2)(?  l +?  l )  (6)  We maximize the likelihood function as shown in E- quation 6 to estimate the unknown model parameters ? = {? ,?l ,?l ,?l |l = 1,2}. Applying a logarithmic transformation to both sides of Equation 6, we obtain the following expression:  L((i, j) ? D,? ,?l ,?l ,?l) = ? (i, j)?D  ? 1 2?2  (?z(i j)? I(i j))2  + ? (i, j)?D   ? l=1  ?l log(?l I(i j) +?lX (i j) l )  ? ??  ?2?  ? l=1  ??l  ? 2l ?  ? l=1  ?l (?2l +?  l )  (7)     By adopting a coordinate ascent optimization algorithm, we have the following efficient updating rules to learn latent variables ? ,?l ,?l ,?l :  I(i j)new ? I(i j)old ? ?L ? I(i j)  / ? 2L  ? (I(i j))2  ?new ? ?old ? ?L ??  / ? 2L  ? (?)2 , ?newl ? ?oldl ?  ?L ??l  / ? 2L  ? (?l)2  ? newl ? ? oldl ? ?L ??l  / ? 2L  ? (?l)2 , ? newl = ?  old l ?  ?L ??l  / ? 2L  ? (?l)2 (8)  C. Online Time-aware Recommendation  Human daily activities usually follow a regular temporal pattern, i.e., people usually eat dinner at 17:00-19:00, which means a customer may tend to check-in a restaurant rather than other kinds of shops during the time slot. Therefore, temporal influence plays an important role in mining customer?s prefer- ence, which should be considered in making recommendation.

To extract the temporal pattern of customer?s check-in activity, we divide days into two categories: Weekday and Weekend, and further divide a day 12 hourly slots (since the operation hours of the shopping mall are 10:00 am-10:00 pm).

We partition the total check-in activities into a few subsets according to the shop category and time slot of check-ins, and each subset represents customer?s check-ins for a certain shop category at a specific time slot. Then, we calculate the check- in probability of customer u to shops that belong to cp at time slot ts by:  Pr(u,cp|ts) = ?(u,cp|ts)?(u, ts) (9)  where cp is the category of shop p, ?(u,cp|ts) is the check- in number for shops belong to cp at time slot ts. Accordingly, ?(u, ts) is the total check-in number for all shops at time slot ts.

Given customer u and a unvisited shop p? at time slot ts, we calculate the recommendation score using collaborative filtering:  score(u, p?, ts) = Iu + ?v?U sim(u,v)(Ivp?? Iv)Pr(u,cp?|ts)  ?v?U sim(u,v) (10)  where Iu and Iv are the average score of customer u,v to all shops, respectively. Ivp? is the preference of customer v towards p?, U is the nearest neighbour set of u. sim(u,v) is the Pearson correlation between customer u,v, calculated by:  sim(u,v) = ?i?Puv(I  ui? Iu)(Ivi? Iv)? ?i?Puv(Iui? Iu)2 ?i?Puv(Iui? Iu)2  (11)  where Puv is the shops that have been visited by both customer u and v.

TABLE I: Statistics of dataset  Number of Shops 211 Number of Customers 39,038 Number of Check-ins 89,794  Average No. of Check-in shops per customer 41 Average No. of Check-in customers per shop 426  Data density 1.09%  TABLE II: Methods for comparison  Method Description  RBCA [1] Rule-based recommendation algorithm TSO [3] Time-based Slope One  LVM Our method without fusing temporal influence LCCF [7] Collaborative filtering using location co-occurrence  TA-LCCF [8] LCCF with fusing temporal influence

III. EXPERIMENT EVALUATION  In this section, we report on the results of a series of experiments conducted to evaluate the performance of the proposed model to recommend top-K shops to customers. We first describe the settings of experiments including data sets, comparative algorithms and evaluation metric. Then, we report and discuss the experimental results.

A. Experimental Settings  1) Dataset: We gather an anonymized dataset from reg- istered customers using an opt-in WiFi network in an urban shopping mall during 7 months. For removing noise data, we filter out the mall workers and shop employees based on the check-in frequency. Specifically, we consider a customer as a mall worker or shop employee if her/his check-ins are more than 30 during seven months. After preprocessing, the dataset consists of 89,794 check-ins from 39,038 customers on 211 shops, more details of the dataset are shown in Table I.

2) Comparative Algorithms: We compare the proposed recommendation model (MallRec) with 5 start-of-art methods for shop recommendation in urban shopping mall, as shown in Table II.

3) Evaluation Metric: We adopt Recall@K as the measure- ment metric, where k is the number of the recommendation results. Let hit@K denotes a single test case as either the value 1 if si appears in the top-k results, or else the value 0. The overall Recall@K are defined by averaging all test cases:  Recall@K = #hit@K |Dte| (12)  where #hit@K denotes the number of hits in the test set, and |Dte| is the number of all test cases.

B. Experimental Results  In this subsection, we first report the performance of the proposed model on the recommendation effectiveness and then discuss the temporal influence for different recommendation models.

1 2 3 4 5 6 7 8 9 10  0.11  0.22  0.33  0.44  0.55  The length of recommendation list (k)  R ec  al l@  K TSO RBCA LCCF LVM MallRec  Fig. 3: Top-k performance on our data set  k=3 k=5 k=8 0.1  0.15  0.2  0.25  0.3  0.35  0.4  R e ca  ll@ k  LCCF TA?LCCF LVM MallRec  (a) Different@k  1 2 3 4 6 12 0.1  0.15  0.2  0.25  0.3  0.35  0.4  The length of time slot  Re ca  ll@  TA?LCCF MallRec  (b) Varying length of timeslot  Fig. 4: Impact of temporal influence on shop recommendation  1) Effectiveness of Recommendations: Figure 3 reports the performance of the recommendation models on the dataset. We show only the performance where the length (k) of recommen- dation list is in the range [1...10], because there are 211 shops in total and a greater value of k is usually ignored for a typical top-K recommendation task. From this figure, we also observe: 1) TSO performs worst among all recommendation models, showing only utilizing the residence time is insufficient to reflect the level of customer?s interests. Similarly, the results of LCCF suggest that only utilizing the check-in frequency is also insufficient to learn customer?s interests; 2) MallRec perform better than other competitor methods (LCCF, RBCA, TSO), showing the advantage of using latent variable model to learn customer?s preference and fusing temporal influence to make recommendation. For example, the recall of MallRec is about 0.51 when k = 9 (i.e., the model has a probability of 51% of placing a shop within target customer?s check-in list), while 0.4 for LCCF, 0.37 for RBCA and 0.35 for TSO.

2) Impact of Temporal Influence: We compare the rec- ommendation effectiveness of two recommendation models (LCCF, LVM) by fusing temporal influence in Figure 4a.

From this figure, we can see the two models (TA-LCCF and MallRec)) with fusing temporal influence perform better than the baseline methods (LCCF and LVM), showing temporal influence plays a vital role in analyzing customer?s check-in activities and is vital for shop recommendation.

Figure 4b reports the effect on the length of time slot for two recommendation models (TA-LCCF, and MallRec), which controls the time granularity of time-aware recommendations.

A larger length of time slot implies that the recommendation results will be less time-specific. From this figure, we can  observe the Recall@5 for the two models drop with the time slot length increases. The reason is that increasing the length of time slots will bring in more ground truth shops for a customer at each time slot. Since the length of recommendation list (k) unchanged, the recall will decrease when increasing the length of time slot.



IV. CONCLUSION AND FUTURE WORK  In this paper, we propose a time-aware recommendation model that recommends a customer a set of shops at a specific time slot by learning customer?s preference from their check-in activities. Customer?s check-in activity are generated from user-generated WiFi logs. The proposed model firstly models customer?s preference as a hidden factor of his/her check-in activity using a latent variable model, then produces top-K recommended shops by jointly considering the learnt preference and temporal influence. Experimental results show that the proposed model significantly outperforms state-of-art methods in recommendation effectiveness.

As future work, we plan to 1) analysis the aspects that a customer most concerned about when checking a shop by exploiting shop?s online textual reviews; 2) facilitate more context-aware applications (e.g., detecting target customers and optimizing promotion strategy) in shopping malls by mod- eling customer?s preference from multi-modal information: check-in activities and online reviews.



V. ACKNOWLEDGE  This work is sponsored by the National Basic Research 973 Program of China (No. 2015CB352403), the Program for National Natural Science Foundation of China / Research Grants Council (NSFC/RGC)(612191030), the Scientific Inno- vation Act of STCSM (13511504200), and EU FP7 CLIMBER project (PIRSES-GA-2012-318939).

