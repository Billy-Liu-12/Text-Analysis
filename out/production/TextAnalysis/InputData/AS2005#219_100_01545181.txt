Laser Scan Matching in Polar Coordinates with Application to SLAM

Abstract? This paper presents a novel method for 2D laser scan matching called Polar Scan Matching (PSM). The method belongs to the family of point to point matching approaches.

Our method avoids searching for point associations by simply matching points with the same bearing. This association rule enables the construction of an algorithm faster than the iterative closest point (ICP).

Firstly the PSM approach is tested with simulated laser scans. Then the accuracy of our matching algorithm is evaluated from real laser scans from known relative positions to establish a ground truth. Furthermore, to demonstrate the practical usability of the new PSM approach, experimental results from a Kalman filter implementation of simultaneous localization and mapping (SLAM) are provided.

Index Terms? scan matching, polar coordinates, laser, SLAM

I. INTRODUCTION  Localization and map making is an important function of mobile robots. One possible task to assist with this function- ality is to use laser scan matching. In laser scan matching, the position and orientation or pose of the current scan is sought with respect to a reference laser scan by adjusting the pose of the current scan until the best overlap with the reference scan is achieved. In the literature there are methods for 2D and 3D scan matching. This paper is oriented towards 2D scan matching only, therefore in this paper scan matching is restricted to 2D laser scan matching.

Scan matching approaches can be local [12] or global [15].

Scan matching approaches also can be categorized based on their association method such as feature to feature, point to feature and point to point. In feature to feature matching approaches, features such as line segments [8], corners or range extrema [11] are extracted from laser scans, and then matched. Such approaches interpret laser scans and require the presence of chosen features in the environment. In point to feature approaches, such as one of the earliest by Cox [5], the points of a scan are matched to features such as lines.

The line features can be part of a predefined map. Features can be more abstract as in [3], where features are Gaussian distributions with their mean and variance calculated from scan points falling into cells of a grid. Point to point matching approaches such as the approach presented in this paper, do not require the environment to be structured or contain predefined features.

Examples of point to point matching approaches are the following: iterative closest point (ICP), iterative matching range point (IMRP) and the popular iterative dual corre- spondence (IDC). In the Besl and Mac Kay [2] proposed ICP, where for each point of the current scan, the point with the smallest Euclidean distance in the reference scan is selected. IMPR was proposed by Lu and Milios [12], where corresponding points are selected by choosing a point which has the matching range from the origin. IDC, also proposed by Lu and Milios [12] combines ICP and IMRP by using the ICP to calculate translation and IMPR to calculate rotation.

The mentioned point to point methods can find the correct pose of the current scan in one step provided the correct associations are chosen. Since the correct associations are unknown, several iterations are performed. Matching may not always converge to the correct pose, since they can get stuck in a local minima. Due to the applied association rules, matching points have to be searched across 2 scans, resulting in O(n2) complexity, where n is the number of scan points. All three approaches operate in a Cartesian coordinate frame and therefore do not take advantage of the native polar coordinate system of a laser scan.

There are other scan matching approaches such as the method of Weiss and Puttkamer [16]. Here for both reference and current scans, an angle-histogram of the orientation of line segments connecting consecutive points is generated. The orientation of the current scan with respect to the reference scan is obtained by finding the phase with the maximum cross correlation of the 2 angle histograms. The translation is found similarly by calculating x and y histograms, and calculating cross correlations. In scan matching, not all approaches use only that information in a scan, which describes where objects are. Thrun et al [14] in their scan matching method utilize the idea, that free space in a scan is unlikely to be occupied in future scans.

In scan matching another important task, apart from finding the current scans pose, is the estimation of the quality of the match. Lu and Milios [12] calculates the uncertainty of the match results by assuming white Gaussian noise in the x,y coordinates of scan points. This implicitly assumes that correct associations are made that results in optimistic error estimates, especially in corridors. Bengtsson and Baerveldt in [1] developed more realistic approaches. In their first    approach the pose covariance matrix is estimated from the Hessian of the scan matching error function. In their second approach, the covariance matrix is estimated off-line by simulating current scans and matching them to the reference scan.

Mapping with scan matching has been done for example by minimizing an energy function [13], using a combination of maximum likelihood with posterior estimation [14], using local registration and global correlation [8] and using Fast- SLAM [9]. A Kalman filter implementation can be found in [4].

In this paper we present a novel scan matching approach called Polar Scan Matching (PSM) which works in the laser scanner?s polar coordinate system, therefore taking advantage of the structure of the laser measurements. Laser range mea- surements of current and reference scans are associated with each other using the matching bearing rule, which eliminates the search for corresponding points.

The rest of the paper is organized as follows; first our PSM algorithm is described followed by a Kalman filter SLAM implementation utilizing our scan matching approach. Details of experimental results follow that include simulation, ground truth measurements and an implementation of SLAM. Finally conclusions and future work are presented.

A more detailed description of PSM can be found in [6]. The source code of PSM can be downloaded from www.irrc.monash.edu.au/adiosi.



II. POLAR SCAN MATCHING  The laser scan matching method described next aligns the current scan with respect to the reference scan so that the sum of square range residuals is minimized. It is assumed that an initial pose of the current scan is given, expressed in the coordinate frame of the reference scan. The coor- dinate frame of a laser scan is centered at the point of rotation of the mirror of a laser scanner. The X axis or zero angle coinciding with the direction of the first reported range measurement. The current scan is described as C = (xc, yc, ?c, {rci, ?ci}  n i=1), where xc, yc, ?c describe position  and orientation, {rci, ?ci}ni=1 describe n range measurements rci at bearings ?ci, expressed in the current scans coordinate system. {rci, ?ci}ni=1 are ordered by the bearings in ascending order as they are received from a SICK laser scanner. The reference scan is described as R = {rri, ?ri}ni=1. The scan matching works as follows: after preprocessing the scans, scan projection followed by translation estimation is alternated with scan projection followed by orientation estimation. More details on these steps are given in the following sections.

A. Scan Preprocessing  Prior to matching, the current and the reference scans are preprocessed. First, as in [8] a median filter with a window of 5 is applied to the range measurements to remove objects that are likely to move, such as table and chair legs. Then range readings are segmented to prevent interpolation between 2 disjoint objects and to enable the tracking of moving objects.

Fig. 1. Left: projection of measured points taken at C to location R. Right: points projected to R shown in polar coordinates. Dashed lines represent bearings which the scanner would have sampled.

In the segmentation, simple rules are used such as a range reading is in the same segment as its previous neighbor if they are closer than a threshold, or if the range reading is closer than a threshold to the extrapolation of the previous 2 readings. Range readings further than a threshold (in the results we used 10m) are not used, therefore such readings break segments. A point in a segment consisting of just one point is tagged and ignored in the scan matching process.

The tracking and marking of moving objects are important for robustness, since they can have a negative effect on scan matching. We have not implemented the tracking of moving objects yet, but we plan to do so in the future.

B. Scan Projection  An important step in scan matching is finding out how the current scan would look if it were taken from the reference position. For example in Fig. 1, the current scan was taken at location C and the reference scan was taken at position R. The range and bearings of the points from point R (see Fig. 1b) are calculated:  r ?  ci = ?  (rci cos(?c + ?ci) + xc)2 + (rci sin(?c + ?ci) + yc)2 (1)  ? ?  ci = atan2(rci sin(?c + ?ci) + yc, rci cos(?c + ?ci) + xc) (2)  Fig. 1b?s dashed vertical lines represent sampling bearings (?ri) of the laser at position R. Since our association rule is to match bearings of points, next ranges r??ci at the reference scan bearings ?ri are calculated using interpolation. The aim is to estimate what the laser scanner would measure from pose R. This step consists of checking (r?ci, ?ci)  ? (i.e. 1,2,..10 in Fig. 1b) of each segment if there are one or more sample bearings between 2 consecutive points (i.e. between 1 and 2 there is one, between 6 and 7 there are 2). By linear interpolation a range value is calculated for each sample bearing. If a range value is smaller than an already stored range value at the same bearing, then the stored range is overwritten with the new one to handle occlusion. As in [12] a new range value is tagged as invisible if the bearings of the 2 segment points are in decreasing order.

C. Translation Estimation  After scan projection, for each bearing ?ri there is at most one r??ci from the projected current scan and a corresponding rri from the reference scan. The aim is to find (xc, yc) which minimizes  ?  wi(rri ? r ??  ci) 2, where wi is a weight used to  reduce weighting1 of bad matches. To minimize the weighted sum of square residuals we applied linear regression to the linearized eq. 1:  ?ri ? ?r??ci ?xc  ?xc + ?r??ci ?yc  ?yc (3)  = cos(?ri)?xc + sin(?ri)?yc (4)  If range differences between projected current range and reference range readings are modeled as  (r?? c ? rr) = H  [  ?xc ?yc  ]  + v (5)  where v is the noise vector and  H =  ?  ?  ?  ?r?? c1  ?xc  ?r?? c1  ?yc ?r??  c2  ?xc  ?r?? c2  ?yc  ... ...

?  ?  ? , (6)  then position correction ?xc, ?yc of the current scan is then calculated by minimizing the sum of weighted range residuals ?  wi(rri?r ??  ci) 2 using the well known equation for weighted  least squares [10]: [  ?xc ?yc  ]  = (HTWH)?1HTW(r?? c ? rr) (7)  where r?? c , rr are vectors containing r??ci and rri and W is  a diagonal matrix of weights. The elements of the W are calculated according to the recommendations of Dudek and Jenkin in [7]:  wi = 1 ? dmi  dmi + c m  (8)  where di = r??ci ? rri is the error between projected current scan range measurements and reference scan range measure- ments and c is a constant. Equation (8) describes a sigmoid function with weight 1 at di = 0 and a small weight for large di. Parameter c determines where the sigmoid changes from 1 to 0, and m determines how quickly the sigmoid function changes from 1 to 0. In [7] (8) was used to weight the distance of a laser scan point to a line in a point-to-feature scan matching method.

To reduce the effects of association errors in the imple- mentation of equation (7), only those visible measurements are taken into consideration which are not tagged (see II- A). Also the errors between reference and current scan range measurements have to be smaller than a preset threshold to be included.

Please note that the equation used in other point-to-point scan matching methods which operate in XY coordinate systems such as ICP or IDC find the correct translation  1Note that there is also an implicit weighting of closer objects, since they cover a larger angle.

and rotation of the current scan in one step if the correct associations are given. Our PSM approach, due to the use of linearization, requires multiple iterations. Since the correct associations are in general not known multiple iterations are necessary for the other methods as well. Also note that our PSM approach for translation estimation works most accurately if the correct orientation of the current scan is known. Estimating the orientation of the current scan is described next.

A negative property of this translation position estimation approach is apparent when matching scans which were taken of long featureless corridors - the position error along the corridor can drift.

D. Orientation Estimation  Change of orientation of the current scan is represented in a polar coordinate system by a left or right shift of the range measurements. Therefore assuming that the correct location of the current scan is known and the reference and current scans contain measurements of the same static objects, the correct orientation of the current scan can be found by shifting the projected current scan (r??ci, ?ri) until it covers the reference scan. A ?20? shift was implemented at 1? intervals of the projected current scan, and for each shift angle the average absolute range residual is calculated. Orientation correction is estimated by fitting a parabola to the 3 closest points to the smallest average absolute range residual. The estimated orientation change is then added to ?c.

E. Heuristical Error Estimation  If correct associations are assumed, then the covariance estimate for the translation is [10]:  C = ?2r (H T H)?1, (9)  where ?2r is estimated range error variance. Unfortunately even if the current and reference scan were taken of the same scene, there can always be moving objects, or objects which appear differently from different location (e.g. vertically non uniform objects observed from a slightly tilted laser scanner).

For this reason, for rooms we use a simple approximation of the covariance matrix by scaling a diagonal matrix with the average square range residual. A lower bound on the covariance matrix is also applied. It is assumed that smaller range residuals are the result of better association and better scan matching result.

A non-diagonal covariance matrix is scaled for corridors which expresses the larger along-corridor error. Classification of scans into corridors is done by calculating the variance of orientations of line segments obtained by connecting neighboring points. If this variance is smaller than a threshold, then the scan is classified as a corridor. The orientation of the corridor necessary for the covariance matrix generation is estimated by calculating an angle histogram [16] from the line segment orientations. The angle perpendicular to the location of the maximum of the histogram will correspond to the corridor orientation.

Fig. 2. Current and reference scan prior matching.



III. SLAM WITH SCAN MATCHING  A simple implementation of Kalman filter SLAM was programmed in C++ to evaluate the practical usability of our scan matching method. As in [4] laser scanner poses are used as landmarks. With each landmark the associated laser scan is also stored. Each time the robot gets to a position which is further than 1 meter from the closest landmark, a new landmark is created. Each time the robot gets closer than 50 cm and 15? to a landmark not updated in the previous step, an update of the landmark is attempted. Note that consecutive scans are not matched. This is because the short term odometry of our robot is much more accurate when traveling on flat floor than our scan matching. The time registration between odometry and laser scans is handled by a custom designed FPGA hardware time stamping circuit whereby encoders are directly sampled and time stamped every 10 msec and data packets from the laser are time- stamped with the same timer.

When updating a landmark, the observation is obtained by scan matching. The laser measurement is passed to scan matching as the reference scan, and the scan stored with the landmark is passed as the current scan. The result of scan matching is the position of the landmark expressed in the laser?s coordinate system at the robot?s current position.



IV. EXPERIMENTAL RESULTS  The results of 3 experiments are presented. In the first experiment simulated laser scans are matched and evaluated.

The remaining experiments use a SICK LMS 200 laser range finder at a 1? bearing resolution in indoor environments. In the second experiment, laser scan measurements are matched at 10 different scenes by positioning the laser manually in known relative poses and the results are compared with the known relative poses. In the third experiment the scan matching algorithm is evaluated in a SLAM experiment.

0 2 4 6 8 10 12 14 16            Iterations  P os  iti on  [c m  ], or  ie nt  at io  n [d  eg ]  x y theta  Fig. 3. Evolution of x,y and orientation error.

A. Simulation  Figure 2 shows two simulated scans of a room. The scans were taken of the same location, but the x and y position of the current scan was altered by 100 cm. Orientation was altered by 15?. Figure 3 shows the evolution of errors. Unlike in IDC, position estimation step followed by an orientation estimation step are counted as 2 iterations. The final error was the following: ?x = 0.4 cm, ?y = 0.005 cm, ?? = 0.15?.

B. Experiment with Ground Truth  To determine how the polar scan matching algorithm copes with different types of environments, an experiment with ground truth information was conducted. On 4 corners of a 60x90cm plastic sheet 4 Sick LMS 200 laser scanner outlines were drawn with different orientations. This sheet was then placed into different scenes ranging from rooms with different degrees of clutter to corridors. At each scene, laser scans were recorded from all 4 corners of the sheet, and matched against each other with initial positions and orientations deliberately set to 0 in the iterative procedure. This introduces an initial error of up to 80cm displacement and up to 27? error in orientation in the first iteration. During the experiments the environment remained static.

A matched current and reference scan from each scene is displayed in Fig. 4. The displayed scans have all undergone median filtering. At each scene 6 scan matches were per- formed. Absolute residuals between ground truth and match results together with the number of iterations and runtime on a Celeron 900MHz laptop are shown in Table I. In Table I ?ERROR? denotes a situation, when the polar scan matching implementation stopped due to the lack of corresponding points and divergence was declared.

Scene 0 is a room with a small degree of clutter. Current and reference scans were quite similar, and the matching results are good. Scene 1 is in a more cluttered room where laser scans from different locations look different as you can see in Fig. 4. The reason why the current scan differs from the reference scan so much is not clear. Perhaps the objects in the room were not uniform in the vertical direction and    Fig. 4. Fourth scan match result for each scene in the experiment with ground truth.

0 (0.9, 1.5, 0.3) 14, 2.6  (0.7, 0.4, 1.3) 16, 2.9  (1.1, 0.2, 0.1) 18, 3.3  (1.5, 0.4, 2.4) 20, 3.6  (0.6, 7.4, 0.2) 12, 2.2  (3.6, 0.1, 1.3) 12, 2.3  1 (5.1, 17.3, 5.5) 20, 3.7  (7.7, 13.1, 5.8) 28, 5.1  (0.4, 24.8, 8.3) 30, 5.5  (1.0, 1.5, 0.4) 27, 4.8  (0.3, 5.0, 0.6) 24, 4.3  (2.4, 0.5, 0.6) 12, 2.2  2 (0.4, 0.3, 0.3) 8, 1.5  (0.2, 0.6, 0.1) 24, 4.5  (0.5, 1.0, 0.3) 20, 3.6  (0.2, 0.9, 0.3) 20, 3.6  (0.2, 4.8, 0.3) 28, 4.9  (1.0, 2.7, 0.3) 12, 2.2  3 (9.7, 5.0, 0.2) 18, 3.3  (51.8, 25.3, 0.2) 12, 2.2  (22.1, 11.1, 0.3) 20, 3.6  (90.8, 19.4, 0.0) 30, 5.2  (24.3, 11.2, 0.1) 16, 2.9  (55.3, 46.3, 0.1) 30, 5.3  4 ERROR (4.2, 47.9, 1.3) 20, 3.7  (0.9, 4.3, 0.0) 30, 5.2  (61.6, 160.3, 4.7) 30, 5.2  (73.8, 210.5, 1.5) 30, 5.0  (1.0, 6.1, 0.1) 30, 5.2  5 (0.6, 20.3, 0.4) 24, 4.4  (0.2, 24.0, 0.4) 30, 5.4  (1.3, 10.7, 0.4) 30, 5.5  (12.6, 49.3, 0.5) 30, 5.4  (3.6, 6.6, 0.9) 21, 3.8  (1.6, 4.6, 1.5) 19, 3.4  6 (1.4, 30.7, 0.3) 18, 3.3  (2.0, 63.0, 0.1) 16, 2.9  (2.7, 79.1, 0.2) 16, 2.9  (23.0, 85.2, 0.4) 30, 5.2  (21.8, 86.6, 0.3) 16, 3.0  (0.8, 4.7, 0.0) 9, 1.7  7 (0.2, 0.1, 0.0) 26, 4.6  (1.5, 0.2, 0.2) 16, 2.9  (0.1, 0.3, 0.1) 20, 3.6  (0.8, 2.6, 0.3) 18, 3.2  (0.9, 4.9, 0.1) 16, 2.9  (0.0, 0.6, 0.3) 15, 2.7  8 (0.7, 0.0, 0.0) 11, 2.0  (1.3, 2.1, 0.1) 22, 4.0  (0.1, 0.4, 0.3) 19, 3.3  (0.6, 0.6, 1.9) 22, 3.9  (0.0, 5.6, 0.9) 23, 4.1  (0.6, 0.4, 0.1) 12, 2.3  9 (3.7, 1.7, 0.8) 10, 1.9  (2.0, 0.4, 0.4) 18, 3.4  (1.4, 0.9, 0.2) 18, 3.3  (2.8, 3.0, 0.5) 18, 3.3  (1.6, 9.5, 0.7) 12, 2.2  (1.1, 1.6, 0.2) 13, 2.4  TABLE I ABSOLUTE ERRORS IN X[CM],Y[CM],?[?],NUMBER OF ITERATIONS AND RUNTIME [MS] OF THE EXPERIMENT WITH GROUND TRUTH.

the laser beam is not a small spot or the laser was slightly tilted. Half of the results from scene 1 (see Table I, row 1) are not good, but they are still usable for example in a Kalman filter with an appropriate error estimate. In scene 2 the sheet was placed in front of a door to a corridor. The results are excellent. Scene 3 is a corridor without features. While the orientation error and the error in the cross corridor direction are small, the along corridor error is large. With a proper error model (small orientation and cross corridor error, large along corridor error) the results are still useful when used with a Kalman filter. Scenes 4,5 and 6 are similar to 3 except there are phantom readings appearing as the corridor end, even though the real corridor end was 30 meters away. The reason for the phantom readings is that the laser beam is tilted slightly and readings from the floor are obtained. In scene 4 scan matching diverged once. Scene 7 is situated on the border of a room and a corridor. The results are excellent.

The results for scenes 8 and 9 which were situated in a room are excellent.

In summary PSM performed well in room like environ- ments. In corridors, the orientation and cross corridor position was good, but the along corridor error was generally large.

Due to the representation of the two parallel walls of a corridor in polar coordinates, the match result is likely to drift in the direction of the corridor. The statistics for all the scenes except 4,5,6 are the following (values for ICP are in brackets): average number of iterations 19 (31), execution time 3.3ms (12.66ms), orientation error 0.86? (4.1?), displacement error 3.8cm (15.3cm).

C. SLAM  The raw data set used in the Kalman filter SLAM is shown in Fig. 5. The structures in the middle of the rooms are office cubicles. The robot is equipped with one SICK LMS 200 and odometry and started from the corridor intersection. It visited the left room, and after one loop, it proceeded through the corridor to the right room where it performs a large and a small loop. During the traversal of the environment, 2 people    Fig. 5. Raw data prior SLAM.

Fig. 6. Result of SLAM with polar scan matching.

walked in the view of the laser scanner, and one double door and one automatic door opened and shut.

The SLAM results shown in Fig. 6 are significantly better than those from odometry only (fig. 5). Consecutive laser scans were not matched against each other, since over short distances odometry was more accurate than scan matching.

In a C++ implementation of scan matching and SLAM, the 12 minutes worth of data consisting of 27 ? 103 scans and 72?103 odometry readings) took about 1.5 minute to process on a 900MHz Celeron laptop. The average time of the 290 scan matches was 3.1ms.



V. CONCLUSION  In this paper we demonstrate that it is possible to perform scan matching by using the laser measurements in their native, polar form. Our novel polar scan matching (PSM) approach belongs to the class of point to point matching algorithms. PSM takes advantage of the structure of laser scanner measurements by functioning in the laser scanner?s polar coordinate system. The direct use of range and bearing measurements coupled with a matching bearing association rule and a weighted range residual minimization, resulted in a fast scan matching algorithm.

The simulation of matching scans in a room demonstrates that the current scans pose error decreases quickly to a small  value. Scan matching experiments were also performed with a SICK LMS 200 in a variety of environments. Comparison of the results with ground truth revealed that the performance of our scan matching method in real environments is good.

When matching corridors we have also observed a drift in the direction of the corridor. The usability of our scan matching approach was tested by performing Kalman filter SLAM with scan matching in a static environment.

A more through description of PSM, together with more experimental results and comparisons is presented in [6]. The source code of PSM can be downloaded at www.irrc.monash.edu.au/adiosi.

In the future the implementation of moving object tracking and tagging is planned for improving robustness. Also the modification of PSM for 3D scan matching will be consid- ered.

