SPATIAL PYRAMID MINING FOR LOGO DETECTION IN NATURAL SCENES

ABSTRACT This work introduces a novel data mining scheme, spatial pyramid mining, to discover association rules at multiple res- olutions in order to identify frequent spatial configurations of local features that correspond to classes of logos appearing in real world scenes. By indexing representative examples by the mined rules we can efficiently detect a variety of different lettering or design marks associated with a brand. Features in an image are marked by matching rules to representative examples selected via a weighted cosine similarity measure.

Logos are localized in an image via density-based clustering of matched features. Precision vs. recall curves are presented for experiments on a dataset of web images of nearly 1,000 images containing seven popular logo types.

Index Terms? Data Mining, Object Detection, Mobile Search, Logo Recognition  1. INTRODUCTION  A new wave of services is emerging with pervasive wire- less networking and cheap computing that will enable mo- bile users to retrieve information from their surroundings. To- wards that end, this work addresses the problem of identifying logos on objects as they occur in images captured in natural settings. Object detection in real world environments is dif- ficult due to clutter, occlusions, and variation in photomet- ric conditions and perspective. As brand markings occur in wide varieties, template-matching and point correspondence approaches may suffer from poor recall. Instead we approach logo detection by treating each brand as a class of objects for which to discover frequent local feature configurations and then match in images from indexed templates. This work em- ploys a novel multiresolution spatial pyramid mining tech- nique to identifies useful rules at varying quantization levels in feature space and geometric configuration.

Logos are a tempting target for detection as they often ap- pear in high contrast regions with distinctive shape and edge information. Applied logo detection systems may enable a variety of new web-based applications. For instance, mobile  ?While at MSRA and supported by IGERT NSF Grant# DGE-0221713.

Fig. 1. Logo detection by clustering matching frequent spatial configurations of local features found by data mining.

users may submit image search queries via camera-enabled devices [1] that can help identify products, offer discounts at store locations, or provide context-based advertisements.

Previous work in logo detection has primarily focused on the problem of locating design marks in documents [2] or similarity matching for trademark retrieval [3]. Shape and contour based features are employed for analysis of well-registered data sets. Other work attempts detection in real world scenes. For logos in sports videos, Den Hollan- der and Hanjalic [4] assume rigid planar backgrounds and utilize line-based intensity profiles. As local interest point descriptors like SIFT [5] have become popular, there have been approaches that use point correspondences for match- ing to templates. Bagdanov et.al. [6] employ normalized matching using a bag of local features and cloud localization in sports videos. The Logoseeker system [7] fits an affine transformation in order to mark the convex hull of detected regions.

This paper approaches logo detection by data mining [8] association rules that capture frequent spatial configurations of quantized local SIFT descriptors. Association rule min- ing was initially employed for market basket analysis and has been extended to image based domains [9]. Recently, Quack et.al. [10] introduced the idea of employing associ- ation rules to select features for object detection. The col- lection of rules as ?discrete words? are indexed to retrieve representative training templates for matching. Our work ex- tends [10] and applies an indexing method to the localization of logos in an image. Figure 1 shows an example of matched     feature points using this method.

The paper proceeds as follows: section 2 outlines the data  mining method used to extract association rules and describes the spatial pyramid mining scheme. Section 3 describes rule indexing, template selection, and localization in test images.

Section 4 discusses the results of experiments using a dataset of logos collected from the web. Section 5 concludes.

2. MINING ASSOCIATION RULES FROM IMAGE TRANSACTIONS  The goal of association rule mining [8] here is to discover frequent item sets that infer the presence of the target object class with high confidence. The aim is to discover association rules of the form A ? B. The discrete items in set A corre- spond to local interest descriptors discretized by both hierar- chical k-means clustering and spatial configuration (see the next subsection.) Set B contains only the class label item.

Transactions are sets of items T = {i1, . . . , in}. Set A is a K- itemset if A ? T with |K| items, and the frequency at which A occurs over the set of all transactions, database D, is called the support:  supp (A) = |{T ? D : A ? T}|  |D| (1)  We wish to discover frequently occurring K-itemsets ex- isting in the transaction supersets that imply the positive train- ing class label, itself included as an appended item in T. Asso- ciation rules A ?B can be found efficiently using the Apriori algorithm [8] and must meet a minimal statistical significance or support of a rule defined as:  supp (A ? B) = |{T ? D : (A ? B) ? T}||D| (2)  Additionally, rules must satisfy a minimum confidence, the frequency over which occurrences of antecedent A imply consequent B. Rule confidence is an estimate of the condi- tional probability P (B ? T |A ? T ) and is defined as:  conf (A ? B) = |{T ? D : (A ? B) ? T}||{T ? D : A ? T}| (3)  2.1. Transaction Items for Spatial Word Configurations  Transactions are constructed from items of discretized config- urations of local interest points in an image. Each item cor- responds to one feature point detected by the Harris-Affine method [11] and represented as the SIFT feature descriptor.

Each transaction consists of items located in the semi-local neighborhood of a single central feature point. The motiva- tion for sampling spatial neighborhoods as an extension of the bag-of-features process can be found in [10]. In essence, we extend their method and apply it to logo detection.

Fig. 2. Grids for coarser to finer levels of spatial quantization  Fig. 3. Example transaction. 3 local features, in 1 of 4 clusters and lying in 1 of 5 regions, activate matrix elements.

We construct transaction databases at multiple resolutions as follows. The first step is to employ a tree-based hierarchi- cal k-means clustering of the SIFT [5] descriptors from the Harris-Affine output. The tree has Q(k) = 2k clusters at each level k. These detected feature points are assigned to one of the Q(k) clusters at a selected level k. To incorporate shape in- formation we next iteratively overlay a circular grid centered at each feature point. The grid has a radius proportional to the base feature?s scale, and rotation invariance of the config- urations is achieved by rotating the circular grid by the base feature?s orientation. Each transaction contains one item for each feature lying within this circular area. Feature points within the grid are additionally quantized according to their relative position in S(z) circular spatial regions, where z is the given level of spatial quantization. Figure 2 shows sets of the dividing regions for increasingly finer levels.

Creating an example transaction is illustrated in figure 3.

Each feature point in an image will create one such transac- tion. In the figure, the base feature, assigned to the 3rd feature space cluster (q=3), is found to have two other features in its spatial neighborhood. These are both assigned to the 1st fea- ture space cluster (q=1) and lie in sectors (s=2) and (s=4). If the transaction database has at this resolution Q = 4 clusters and S = 5 sectors (4 plus 1 for the origin,) then the items in a transaction will be indices ranging from 1 to Q ? S = 20 found as (s-1)*Q+q. Repeated items are discarded. The example transaction has 4 total items, three features and a class label.

2.2. Spatial Pyramid Mining  Two innovations in object detection motivate the idea:  1. Computation of a pyramid match kernel of coarse-to- fine histogram intersections in feature space to effi- ciently learn with sets of features [12]  2. Simultaneously matching in spatial subregions [13]  The idea of spatial pyramid mining is to compute association rules found in transaction databases at multiple resolutions     in both feature space and semi-local spatial regions which when taken together outperform any single resolution. Han and Fu [14] introduce the idea of multiple-level association rule mining but focus on using top level results to efficiently find lower level ones. Here the idea is that mining at multiple resolutions finds different types of rules that can be appropri- ately weighted. The interplay between resolution in spatial and feature space leads to complementary rules ranging from a) distinct types of local features in coarse spatial regions to b) more variant local features with specific spatial arrangements.

The procedure for spatial pyramid mining is as follows:  1. Compute over the training set multiple transaction databases Dk,z where k is a level on the hierarchical k-means tree with Q(k) = F k cluster nodes and z is the circular grid type with S(z) sectors .

2. For each Dk,z, iteratively employ Apriori algorithm to find rules r with varying confidence and support min- ima that imply the positive class label item.

3. For a test image G, find rules matching features by cal- culating matrix Mk,z:  Mk,z = Rk,zTG (4)  if rule antecedents are denoted as rj of J total rules from Dk,z, and the transactions are tp of P total in the test image, then Rk,z is the sparse rules activation ma- trix with J rows, Q(k) ? S(z) columns, and elements Rk,z(j, i) = 1|rj | for items i ? rj . TG is the sparse test image transactions matrix with Q(k) ? S(z) rows, P columns and elements TG(i, p) = 1 where i ? tp. Rule j matches at feature p in G when Mk,z(j, p) = 1.

4. The weighted confidence f that feature p in test image G belongs to the target class is:  f(p) = ?  ?k  ?  ?z  ?  ?j:Mk,z(j,p)=1 wk,z(rj) (5)  where rule weights wk,z are the product of scalars:  wk,z(rj) = c(rj) ? s(rj) ? |rj | ? Q(k) ? S(z) (6) with c(rj) as rule confidence, s(rj) rule support, and |rj | rule length. The term Q(k) ? S(z) accounts for the lower support at finer levels.

3. INDEXING AND LOGO LOCALIZATION  To find logos in a scene we group selected features by mu- tual rule matches with representative training examples. An enclosing region is found by density-based clustering[15] of mutually matching points. This method can efficiently ap- proximate pointwise matching over the templates in the train- ing set by indexing the mined frequent itemset rules.

For a set of N total mined rules R = {r1, r2, . . . , rN} with confidence weight vector w = [w1 w2 . . . wN ] as  found by (6), for each of M training templates create the N-dimensional indexing vector tm with tm(n) =  ? w(n)  when training image m contains a match to rule n, other- wise tm(n) = 0. Then, for a test image with index vector ttest constructed in similar fashion, select a representative template, l, via weighted cosine similarity as:  l = argmax m  tm ? t Ttest??tm ??  ???t Ttest ???  (7)  Points corresponding to mutual rule matches between the test image and template l are clustered by the DBSCAN algo- rithm. A bounding box encloses the convex hull of points in clusters with sufficient membership. A threshold on the sim- ilarity can be used to identify different logos co-occurring in the same image.

4. EXPERIMENTAL RESULTS  To test our method we collected a dataset of 974 images from the web containing logos on products, buildings and signs for the McDonald?s (130 images), Starbucks (148), Nike (124), Yankees (119), BMW (139), Coca-Cola (179) and Apple (135) brands. A bounding box is annotated for each logo appearing in an image. For rule discovery, logo-containing transactions are combined at a 1:3 ratio with background class transactions taken from regions outside the bounding boxes and from 200 non-related images. The databases contain 50,000 total transactions, and at least 500 rules are extracted from each resolution with varying minimum support and at least 90% minimum confidence. Results are generated by 6-fold cross validation over random 80/20 training-test splits.

Figure 4 shows precision and recall curves for selected points over four classes separately (a-d) and a total curve for 5 selected classes (e). Precision is defined as the fraction of selected feature points in the image located inside the anno- tated boxes. Recall is the fraction of bounding boxes hit with at least K selected feature points, in this case K=3. The to- tal number of mined rules limits the maximum recall com- pared with a baseline bag-of-words method that selects fea- ture points by their hit frequency at 213 clusters. Spatial pyra- mid mining rules are combined over 8 database resolutions with Q =  { 213, 212, 211, 211, 210, 210, 29, 29  } clusters and  S = {5, 9, 9, 13, 13, 17, 19, 25} sectors respectively. We also plot against one of the better performing single mining reso- lutions (Q = 213, S = 5) as in [10].

Results for the seven types of logos vary. The best over- all performance is for the Starbucks and Coca-cola classes where the data contains large examples that have many align- ing spatial configurations. The Nike and Yankees logos are difficult as the symbols tend to appear on small areas in the image. Mining spatially configured rules offers no advantage over baseline as seen in figure 4(d) and for this reason the two poor performing classes are excluded in 4(e).

(a) McDonald?s (b) Starbucks (c) BMW  (d) Nike (e) Total Precision vs. Recall  Fig. 4. Precision vs. recall curves compar- ing feature selection between spatial pyra- mid mining of eight levels, single level mining, and a frequency based bag-of- words baseline method. Precision is the fraction of selected points lying inside the logo bounding boxes. Recall, or bounding box hit rate (BBHR), is the fraction of lo- gos containing up to 3 selected points. (a) to (d) are the results for individual classes of logos. (e) shows the combined preci- sion vs. recall curves for 5 of the classes.

5. CONCLUSION  This work presents a method for logo detection based on min- ing frequent spatial configurations of discretized local fea- tures at multiple resolutions. The technique can discover a variety of logo types in real world settings. By indexing based on these rules the system can scale to a large database of templates. Experiments on a challenging real world dataset show that the rules can successfully select features that ap- pear densely on logos. An important limitation of this method is image resolution, as multiple local features are required to mine robust spatial configurations.

