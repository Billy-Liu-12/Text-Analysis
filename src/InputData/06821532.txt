Hiding the Trace of JPEG Compression History

Abstract?Identifying and disguising the JPEG compression history has become a hot research point in recent days. The image forger could easily get the JPEG images as tampering materials, while the JPEG loss compression left a big influence on the image?s DCT histogram. This JPEG compression trace has become an important standpoint of compression forensic. In order to fool the compression forensic, the anti-forensic dithers have been added into the JPEG compressed image and became an uncompressed image format.

However, that kind of fake lossless image could be identified by measuring how ?noisy? the uncompressed image is after recompressing. This paper would help the forger  hide JPEG compression history by recompressing and adding noise at different quality factor and restore the image quality by TV denoising. It could defend forensic attack aiming at anti- forensic dither by measuring the total variation (TV) of the image. The simulation results have proved that it can fool the TV detection forensic with a high image quality.

Keywords-Anti-forensics ;JPEG compression; Total variation, DCT histogram

I. MOTIVATION With the development of the electronic information  technology, digital image has become more and more convenience in the daily life on the multimedia sharing platform, it is easy and convenience to tamper the digital image. However as a carrier of spreading information, the authenticity of the digital image has a great importance in legal, academic and other fields. But now the forensic technology always ignores the cheating method aiming at detective features. In order to get an objective result, it is necessary to research the tampering method at the anti- forensic point.

The cat-and-mouse game between the forensic and anti- forensic has become a hot research topic in recent years, especially tracing an image?s processing history like JPEG compression[1]. For it has been wildly used in our daily life.

Fan.Z and Queiroz.R propose a maximum-likehood(ML) method[2] to estimate the quantization factors and detect JPEG image compression history. By comparing the quantization tables, Farid verifies the authenticity of JPEG image[3]. These quantization tables are employed by selected digital camera models and image editing software.

He shows the local evidence of double JPEG compression to identify image forgeries. If the JPEG image has previously been JPEG compressed, it can be detected by the papers[4-  5] .Fridrich and Pevny[6] use a maximum likelihood estimator of the primary quality factor to detect double JPEG compression. The localize region?s double JPEG compression can be used to identify image forgeries [7]. And the image?s JPEG block artifact grid mismatch can indicate the local tampering regions[8].

Figure 1.  Histogram of (2,2) DCT coefficients of true lossless image, JPEG image and the anti-forensically modified JPEG compressed image  However, the main JPEG history detection method analyzes the nature of DCT coefficients, and uses the influence of loss compression which is left on DCT coefficients in the frequency domain, it can reach the goal of forensic. So, in Fig 1, Stamm has an investigation on the ?palisade shape? effect, and adds the anti-forensic dither into the DCT coefficient histograms [9]. With this dither the DCT coefficient histogram turn discrete distribution to ?likely continuous distribution?. While the anti-forensic technology could give an ?original? uncompressed image in statistics, the anti-forensic dither could be detected by the special detection, and analyze the compression history. But among the counter anti-forensic technology, the anti-forensic dither detector by using the total variation (TV), the l1 norm of the spatial first-order derivatives, is efficient and has high correct rate result[11]. In the following part of this work, we would have a research on the countering anti-forensic algorithm based on the TV detection and propose a new method which could fool the TV forensic at a little image quality cost.



II. COUNTER THE ANTI-FORENSIC JPEG COMPRESSION  A. Total Variation Value The image total variation model is proposed by  Rudin[13], and calculate ?how noisy? the image is . The l1 norm of the spatial first-order derivative shows the total variation of the image signal(1):   DOI 10.1109/CSNT.2014.187    DOI 10.1109/CSNT.2014.187     ( )TV u u dxdy ?  ? ??                          (1) The coefficient can accurately reflect the degree of noise  image, and at the same time, it can distinguish the actual image?s edge and texture. It could reflect the special period trace which comes from the DCT coefficients distortion. The geometrical significance can be show in the Figure 2:  Figure 2.  five one-dimensional model of the signal  In the Figure 2 of one-dimensional signals, these signals are all satisfy u(0)=b, u(c)=a. It can be proved that  TV(u1)=TV(u2)=TV(u3)=TV(u5)=a-b            (2)  In (2) u4 is not a monotonic function, so it is not minTV(u).

And the DCT coefficients distortion would bring this kind of unnecessary variation into the image while it could be removed by TV denoising.

B. Distortion Analysis The G.Valenzise team analyzes the JPEG anti-forensic  dither operation?s effect on the DCT coefficients distortion and the quality of image.

In order to detect the anti-forensic dither in the ?uncompressed? image, G.Valenzise inspired by H.Farid[14], and find out the mean square error between the recompressed ?uncompressed image? and the original JPEG image without the anti-forensic dither. X is the original JPEG image DCT coefficient, and Y is the recompressed JPEG image with the quality Q ,like (3).

D(Qn)=E[(x-y)2]                               (3)  In Figure 3 when the recompressed image and the original JPEG image have the same quality factor with the source JPEG image, the distortion brought by interpolating noise has disappeared. And when the recompressed image becomes bigger, the distortion of the DCT coefficients becomes larger. On the other hand, when the recompressed image?s original JPEG quality factor becomes smaller than the original JPEG image?s, in the spatial domain the distortion would be covered by image?s intrinsic high- frequency signal. In a real scenario, the investigators could not get access to the original JPEG compressed image data.

There is no objective reference to compare, so in Figure 4 the researcher use the TV value of the test image.

Figure 3.  MSE distortion between each anti-forensically image recompressed result and the true original JPEG image.

C. Detect the Anti-forensic Dither The Italian researcher G.Valenzise attacked the  tampering method of the JPEG history from the noise, the practical process is recompressing the tested image at the different quality and measure the total variation function with variables quality. And calculate the parameter of the function, (4).

TV(n)(QA)=(TV(QA)-TV(QA-n))/n               (4)  If there is a QA can satisfy the formula, it is proved that the image has been added the anti-forensic dither. And the QA is the original image JPEG compress quality factor.

Figure 4.  Total variation as a function of the re-compression quality factor, for two versions of the Lenna image[11]  This forensic method have a good effect on the lossless image format JPEG compression history. This is because the anti-forensic JPEG compression adds noise by DCT dither at the cost of influence of the spatial domain. In the paper[12], G.Valenzise analyzes the distortion at every DCT 8 8 domain position. And the TV value, spatial l1 norm, could reflect the dither in the image. This dither at the spatial pixels cannot reflect the texture and edge information; it can be detected from the distortion variation at the DCT domain in each quality factor. When the quality factor is over the original one, there will be a sharp change of the TV value, and the image quality decrease. The phenomenon that fake lossless image?s quality loss is much bigger than the true     lossless image?s, is obviously enough to tell the difference between true or not true.



III. THE FRAMEWORK OF DEFENSE OF ANTI-FORENSIC DITHER DETECTION  A. Forensic Analysis The TV value detection depends on the distortion  variation trend of the image quality by the quality factor increasing. The JPEG compression with the source image quality factor has just suppressed dither signal into the original quantized DCT coefficients, while other quality factor compression divide the dithering signal into different neighboring bins. One distribution of noise is re-quantized into an unnatural DCT coefficient. This would bring the distortion increasing. In order to deal with this problem, we can add different distribution of noise several times, but this would cost the quality of the image. So we could add noise and removal noise at the same time.

B. Total Variation based Noise Removal The anti-forensic dither is only a statistical signal and it  could bring no meaningful information into the image. In order to suppress the distortion of the noise, we could use the TV denoise that it could distinguish a special distribution of noise.

The TV denoise could preserving image edge and texture.

At first, u0 stands for image with noise, u stands for target image. n means the noise that this algorithm supposed to be removed. In the constraints of noise n, find the solution that the total variation is the minimum number. The preset noise of n subjects to two constraints. The preset noise average is 0.

The noise variance difference is ?2, it is the difference value between MSE1 and MSE2. MSE1 is the mean square error between the fake ?lossless? image with anti-forensic dither and the original JPEG image. MSE2 is the square error between the recompressed ?lossless image? at the last JPEG original factor and the original JPEG image. However, this value is could adjust larger or smaller, it?s not a fixed value.

C. Defense of the Anti-forensic Dither Detection The difference of TV function between the true lossless  image and the fake lossless image comes from the anti- forensic dither. It could not restore the original information loss while compression, with random information on statistical significance. The distortion comparing with the original JPEG image shows up most obviously in the mid frequency domain, and in the high frequency domain the distortion is nearly 0. From the paper[12], it can be known that when the Laplace distribution coefficient ? becomes bigger, or the quantifying step size q becomes smaller, the MSE brought by anti-forensic dither would become smaller.

This means if the quantifying step size q become smaller, the statistical characteristics of DCT compressed image would be more and more close to the original uncompressed image.

Defense against the noise detection are mainly concentrated in two points: 1.Masks the quality factor?s turning point, which means TV function?s saltation after the original quality factor has disappear. 2.Control the noise of the recompressed JPEG images. For the first task, the turning point mainly depend on the original quantification step? integral multiples. When the quality factor become smaller, the distortion is high, and the turning point is more obvious; when the quality factor become bigger, the trend of the MSE curve is more gentle by the quality factor growing. So, the recompression operation could move the turning point to the higher point, and the MSE curve become much more similar to the uncompressed image. But recompress the image with anti-forensic dither at a higher JPEG compression factor would bring more distortion and cause image loss. In order to deal with these distortion, TV denoise method is used to restore the image loss during the recompression, and remove the dither brought by the distortion, especially the mid frequency DCT coefficients. The DCT coefficient error would leave the image periodic traces. Although when detector recompressed the image with a higher quality factor, the turning point wouldn?t disappear, the TV function becomes close to the uncompressed one. And when the recompress quality factor is larger than 90, the TV function comes out to be a smooth curve. Meanwhile, the total variation based noise removal can lead the recompress fake image?s TV value nearly the same with the original lossless image, by adjusting the preset noise variance. This would reach the anti-forensic goal without damage the image edge and texture.

Pseudo-Code:  1:   Set xiao=0.01, lam=0 2:   origin=?lena.jpg? 3:   wipe=ADD_NOISE(origin) 4:   q0=QUALITY(origin) 5:   while (q<90) 6:        do { if (q*1.5<90) 7:                 if (q*2<90) 8:                       q=q*1.5 9:                 else q=(q+90)/2 10:                 end 11:            else q=90 12:           end 13:            jpg_1=JPEG(wipe,q) 14:           wipe=ADD_NOISE(jpg_1) 15:            } 16:diff1=TV_L1NORM(origin)- TV_L1NORM(JPEG(wipe,q)) 17:diff2=TV_L1NORM(origin)- TV_L1NORM(wipe) 18:diff=ABS(diff1-diff2) 19:var_1=VAR(diff) 20:     while(ABS(diff<xiao)) 21:        do { if (diff>0) 22:                var=var*0.98 23:            else var=var*1.02 24:            end 25:            wipe=TV(wipe,lam)     26:            lam=LAM(var) 27: diff=TV_L1NORM(origin)- TV_L1NORM(JPEG(wipe,q0)) 28:            } 29: output wipe 30: FUNCTION ADD_NOISE(x) 31:return the added anti-forensic dither image by the  method proposed in [9] with the image x quality factor 32: FUNCTION QUALITY(x) 33:return the image x JPEG compression quality factor 36: FUNCTION TV_L1NORM(x) 37:return the image x?s l1 norm of the spatial first-order  derivatives 38: FUNCTION TV(x,y) 39:return the image x TV denoise result by the method  proposed in [13] with the lambda value y 40: FUNCTION LAM(x) 41:return calibrated lambda value by the method proposed  in [13] with the variance x  The purpose is that let the original JPEG image?s TV is nearly the final lossless image compress at original quality factor? TV value. The image interpolator get a JPEG image with the quality factor q0, he could add anti-forensic dither to become a BMP format. And then recompressed the BMP image if the original quality is smaller than 90. This recompression would bring distortion of the DCT coefficients, but the quality factor of the recompress operation has become bigger than before, which means that the quantify step is smaller. Based on the recompressed image with a high quality factor, we add the anti-forensic dither again to cover the previous noise. We knew that the smaller quantify step size or bigger Laplace distribution coefficient ? would make the statistical characteristics of the DCT coefficients be more likely the true uncompressed image. The TV forensic detection accuracy perform so well when attack a fake lossless image which is manufactured on the original JPEG image with a high quality factor. After several times of JPEG compression or adding noise to the image, the quality of the image costs so much, and the TV function grows faster with the quality factor than usual despite the turning point is not so obvious. We could use the TV denoise to restore image quality and reduce the TV value.

The TV denoise will affect the histogram distribution of the frequency domain from the spatial domain. The previous anti-forensic dither has been divided into different DCT coefficient integer multiples, which leads the recompressed JPEG image is different from the first JPEG image. It is the DCT coefficient could not describe the true image content, and the detection method could compare how noisy of the different recompressed JPEG images and by calculating the turning point, the detector could know the original quality factor of the JPEG image. In this paper, the anti-forensic method adjusts the distribution of the DCT coefficient histogram indirectly. It could be ensure the image?s quality for the recompress quality factor is growing. For TV denoise, the fake lossless image has a strong deceptive.



IV. THE SIMULATION AND CONCLUSION  A. Simulation For the simulation, an MATLAB implementation is  based on the script coming from the Matthew C. Stamm homepage. At first, we use the 512 ? 512 gray image ?lena.bmp?, JPEG compressed them with the 30, 50, 70 quality factor as the original JPEG image. We add the noise according to the Stamm?s method and get the fake lossless image. Then the fake lossless image is recompressed by a higher quality factor and add anti-forensic dither by the proposed framework in this paper. The final images is checked by the TV test respectively in Figure 6.The following figure shows the result of the test, there are three lines in the figure, represent the Stamm?s fake lossless image, this paper?s fake lossless image and the true lossless image.

It can be shown that, TV test can not only reflect the JPEG compress history of the fake unaltered image, but also estimate the original quality factor for the Stamm?s anti- forensic modified image. It could be proved that the TV detection could not discover the anti-forensic dither any more. It displays that the fake unaltered images which previously were JPEG image at the quality factor of 30, 50, 70 respectively. As can be seen from the simulation result, the total variation function with the recompressed quality factor are just the same with the true unaltered image.

What?s more, the PSNR between the original JPEG image and image added with noise keeps a high level. This indicates the proposed framework can fool the forensic technology with a lowest cost.

We collect 50 uncompressed images and compressed the images at the 30, 50, 70 quality factor respectively. Through the anti-forensic operation by [9] and proposed framework, we detect the forensic result under the TV detection attack.

The test result can be seen from the Table 1.

TABLE I. THE FAKE UNALTERED IMAGES UNDER THE FORENSIC TEST  quality factor  method detection rate  PSNR  30 Stamm?s 98% 36.23dB Proposed 0% 36.27dB  50 Stamm?s 98% 37.25dB Proposed 4% 37.03dB  70 Stamm?s 96% 37.37dB Proposed 2% 37.14dB  B. Conclusion In this paper, we proposed a counter forensic framework  of image?s JPEG compressed history. In order to remove the lossy compression trace, Some special probability distribution noise has been added into the JPEG image and the image became a lossless format image which just the same with true uncompressed image in statistics. However, this kind of ?lossless? image has lost some meaningful information of the image content, the anti-forensic noise could not restore the compression cost. So forensic     researchers could analyze the unnatural noisy image that is recompressed JPEG image and find out the history trace of the original fake uncompressed image.

Figure 6. TV function of true lossless image, the anti-forensically modified JPEG compressed image by two methods, original quality factor  30,50,70.

Most anti-forensic methods always operate at the cost of image quality loss, and without thinking the image content. It is difficult to hide the process history of the tampering image while the hiding operation itself without being discovered for the interpolators. This paper countering the JPEG compression history detection at the lowest cost of the image quality, make the TV test invalid. However, how to find the optimal solution quantitatively in theory, this issue still needs study.

