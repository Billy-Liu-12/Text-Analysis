A Differentiated Cooperative MAC for QoS Enhancement in Wireless LANs

Abstract-The Quality of Service (QoS) support in Wireless Local Area Networks (WLANs) faces a big challenge due to time- correlated fading channel. Conventional Automatic Repeat reQuest (ARQ) schemes based on time diversity may result in consecutive retransmission failures degrading QoS severely. This paper proposes a novel Differentiated Cooperative Medium Access Control (MAC) protocol, called DC-MAC, to enhance QoS in WLANs based on the IEEE 802.lle architecture. The retransmission is initiated from an appropriate transmission queue of an appropriate relay node instead of the original source to exploit spatial diversity. A novel Negative AcKnowledgement (NAK) feedback mechanism is introduced for loss distinguishing and channel estimation such that cooperative retransmission will be employed only when necessary and only by competent nodes.

Simulations conducted on the OPNET platform show that the proposed scheme significantly improves the performances of both multimedia applications and data applications in terms of throughput and delay while supporting service differentiation.

Keywords-Quality of Service; cooperative communication; wireless LAN

I. INTRODUCTION  With the increasing popularity of multimedia applications over wireless links, Quality of Service (QoS) support has become a critical demand for next generation Wireless Local Area Networks (WLANs). The recent IEEE 802.11e Enhanced Distributed Channel Access (EDCA) [1] provides service differentiation with a priority-based medium access control (MAC) mechanism. A link layer Automatic Repeat reQuest (ARQ) scheme is used to retransmit the corrupted packets due to channel errors or collisions. Retries will continue until either the corresponding acknowledgement is received or the retry count reaches a predefined limit. However, this scheme may not be effective under a fading channel with correlated errors, where there is a high probability that bad channel condition continues for a certain period when a transmission error occurs.

In that case, the channel may stay in a deep fade on the order of multiple frame transmission durations. The frame drop rate and delay will considerably increase due to consecutive retransmission failures and the bandwidth is wasted from a system point ofview as useless messages occupy the channel.

Cooperative communication is becoming a promising technology for wireless networks [2] by exploiting multipath fading instead of mitigating its impact. Single antenna devices can share their antennas in a cooperative manner to emulate a Multi-Input Multi-Output (MIMO) system and exploit the   spatial diversity benefits traditionally realized by an antenna array hosted on a single device. Inspired by this idea, cooperative retransmission has been shown to be an effective technology to improve the reliability ofwireless links [3][4][5].

A retransmission could be initiated from a relay node that overheard the information packet instead of the original source.

Since signals from different locations undergo independent fading gains, the retransmission success probability can be greatly increased by exploiting this spatial diversity. In [3], a simple but effective ARQ scheme called Node-Cooperative Stop and Wait (NCSW) is proposed to reduce the average duration of retransmission trials. Significant gain has been shown for a single sender-receiver pair by an analytical model.

A cross-layer relaying protocol based on hybrid-ARQ with incremental redundancy, termed Hybrid-ARQ-Based INtra- cluster GEographic Relaying (HARBINGER), is proposed in [4]. The nodes decoding the data use Global Positioning System (GPS) to identify their positions relative to the destination and the one closest to the destination will relay the frame. In [5], a Cooperative communication MAC (CMAC) is proposed to improve link reliability for WLANs. Two transmission queues are maintained in each node. One is the data queue for its own outgoing data and another is the partner queue to buffer the copies of the overheard frames. A higher priority is given to the partner queue such that the cooperative retransmission can occur before the original source retransmits.

To the best of our knowledge, there is no scheme considering the QoS support with differentiated services. Furthermore, a practical and effective protocol and a system-level investigation are lack in the literature. From a system perspective, retransmissions from relays may equivalently increase the number of competing nodes in a system and thus may degrade the system performance if inappropriately employed. In addition, a distributed coordination mechanism is needed to solve the relay collision problem since there may be several nodes that can serve as relays.

In this paper we propose a novel Differentiated Cooperative MAC, called DC-MAC, for QoS enhancement in WLANs based on the IEEE 802.11e architecture. Retransmission priority is introduced at relays for different traffic classes. A channel-aware feedback mechanism is proposed to make cooperative retransmission employed only when necessary and only by competent nodes. The rest of this paper is organized as follows: The details of our proposed protocol are presented in Section II. In Section III, simulation model and performance evaluation are discussed. Conclusions are given in Section IV.

Figure 1. Transmission queue model in OC-MAC.

error over wireless link. A loss-distinguishing mechanism is essential for the system performance. The partners should not retransmit the lost frame due to collision since this will further intensify the competition. The original source has the capability of taking care of the retransmission by itself. In addition, up-to- date Channel State Information (CSI) between the destination and itself is needed by a partner to determine if it has the capability to help retransmission. Without this information, a useless retransmission from a partner may intensify the relay competition and waste the bandwidth.

A novel Negative AcKnowledgement (NAK) control frame is proposed here to solve the above two problems all at once. In 802.11e, each data frame consists of three basic components: a MAC header, a frame body and a Frame Check Sequence (FCS). The MAC header comprises frame control, duration, address, sequence control and QoS control information. The FCS is calculated over all the fields of the MAC header and the frame body to determine if a received frame has been successfully decoded. Since the MAC header alone is much shorter than the whole frame, it has a higher probability to be decoded. In addition, the MAC header can be transmitted at a lower rate compared to the frame body to further improve its reliability. In a WLAN scenario without hidden nodes where a collision occurs only when more than one node sends data in the same slot, both the header and the frame body will be corrupted due to a frame collision. This observation has been used to design a loss-distinguishable MAC in [6]. As in [6], a Header Check Sequence (HCS) is added immediately after a MAC header to verify the correctness of the MAC header as shown in Fig. 2a. A NAK frame is proposed to indicate the occurrence of an unsuccessful transmission due to fading

II. PROPOSED PROCOTOL  Our proposed protocol is based on the IEEE 802.11e EDCA architecture and thus can be easily integrated into current systems. Without changing the original stop-and-wait ARQ scheme in a source, the neighbouring nodes overhearing the frames will help in retransmissions and thus our scheme falls into the category of decode-and-forward transmission [2].

Without loss of generality, we consider two traffic classes in this paper: one is best-effort data traffic and the other is real- time multimedia traffic.

A. Transmission Queue Model  In IEEE 802.11e EDCA [1], traffic with different priorities is mapped into several Access Categories (ACs) at each station.

Each AC has an associated transmission queue and contends for the transmission opportunity using a set of EDCA parameters: the Arbitration InterFrame Space (AIFS[AC]), minimum Contention Window size (CWmin[AC]), maximum 'Contention Window size (CWmax[AC]) and maximum retry limit (Mretry [AC]). By appropriately setting access parameters for each AC, service differentiation can be achieved.

Based on this architecture our new transmission queue model is shown in Fig. 1. There are two queues at each station for its own best-effort (Own Classl) and real-time traffic (Own Class 2) respectively. In addition, there is a Partner Queue (PQ) for each traffic category. To support cooperative retransmission, each partner queue should be assigned to a higher priority than its corresponding own queue for retransmissions in order to avoid wasting the bandwidth by useless retransmission from the original source and reduce the retransmission delay. To support the QoS of real-time traffic, the priority of the partner queue for best-effort traffic should be set between the ones of two own queues. By this way, the benefit of cooperative retransmission can be exploited and meanwhile service differentiation is supported. Each queue has a set of its own medium access parameters and all the original regulations in the 802.11e EDCA are inherited, e.g. internal collision resolution. Therefore, our scheme can be easily integrated into the current deployed 802.11e WLANs.

B. Loss Distinguishing and Channel Estimation  Since retransmissions from the partners may cause increased network load and thus intensify the station competition, they should be employed only when necessary.

The missing of an Acknowledgement (ACK) frame may be caused by either a collision with other frames or a transmission  Lower Priority  OlNtl Class 1 (ACO)  Partner Class 1 (ACt)  OlNtl Class 2 (AC2)  Higher Priority..

Partner Class 2 (AC3)  Transmission queues  Per-queue EDCA functions with internal collision resolution  MAC Header  (a) Data frame  (b) ACKINAK frame  Figure 2. Proposed MAC frame formats in DC-MAC.

SuccessSuccessError  D  R:PQ2______~____L.---L-.__'_....LL.J...L...l..-____L-L_____JL....._ _  R:PQl ---L_~~~--Lt....'---__---+--l...L..-__---1~!.L.L-.---JL-....l.----L.

Receiver: IF HCS ofdata frame is correct,  IF FCS ofdate frame is correct, an ACKframe is sent back; ELSE A NAKframe is sent back;  ELSE Keep silent.

Sender: IF ACK is received, initiate a new backofffor the next dataframe; IF NAK is received OR nothing is received, double contention window  and go to the next stage backojJ.

Figure 4. An example of frame transmission sequence in DC-MAC.

Potential Relays: IF Dataframe is received, start a timer;  IF ACK is received OR timer expires, drop the received data frame; IF NAK is received,  IF SNRNAK > SNRth (R), enqueue the received dataframe; ELSE Drop the received data frame.

0 ?? .- TransmittedFrame O _ReceivedFrame  Figure 3. Loss distinguishing and channel estimation mechanism.

channel, which has the same format as the ACK frame except the frame type as shown in Fig. 2b. The operations are described in Fig. 3, where SNRNAK denotes the sensed Signal- to-Noise Ratio (SNR) of the NAK frame and SNRth (R) denotes the SNR threshold to support a data rate R. Note that NAK will not waste additional bandwidth as channel has been reserved by the data frame for possible ACK transmission according to the 802.11e standard.

C. Frame Transmission Sequence  An example of frame transmission sequence is shown in Fig. 4. When a source transmits a data frame to a destination, some neighbour nodes may overhear this frame thanks to the broadcast nature of wireless medium. Based on the regulation in Section n.B, the destination will respond with an ACK or NAK frame or keep silent, which respectively indicates the occurrence of a successful frame transmission, an unsuccessful transmission due to fading channel or an unsuccessful transmission due to frame collision. The neighbour nodes will help in retransmissions only if a NAK frame with good enough SNR is received. The overheard data frame including its original head information will be buffered in the corresponding partner queue based on its priority. If the backoff counter of one partner queue reaches 0, the frame at the head ofthis queue will be transmitted with the original source address in the MAC header. The destination will treat the frame from a relay as the one from the original source and respond with an ACK or a NAK frame destined to the original source or keep silent. The queue statuses at each node are updated in a real-time manner on hearing the ACK or NAK frames. Any node receiving the ACK will check its corresponding queue (own queue for the source and partner queue for the neighbour nodes) and flush out the corresponding data. Any node except the source receiving the NAK will capture its SNR and flush out the corresponding data in the corresponding partner queue if the SNR is no longer good enough. If neither an ACK nor a NAK is received by current node in relaying, it will double its contention window and enter another backoff as a frame collision occurs. The number of retry attempts for a frame in a partner queue should be small to avoid burdening the network load.

D. Sequence Control and Duplicate Detection  Due to the distributed nature of the protocol, an efficient and reliable mechanism is needed to keep the information in each node up to date, avoid redundant retransmissions and enable duplicate detection. For instance, some relay nodes may still try to transmit the out-of-date frames that have been received by the destination due to the loss of the ACK frame.

The source may inappropriately drop the data frame on receiving the out-of-date ACK frame.

In the IEEE 802.11e standard, each data frame is assigned a sequence number from a receiver and priority specific counter.

This number remains constant in all the retransmissions and increments by 1 for the next frame belonging to the same priority/receiver pair. The receiver will determine the received frame to be a duplicate if its sequence information matches the most recent cached entry. In DC-MAC, a sender may receive an ACK at its own backoff stage and thus it has to be aware of the validity and the object to be acknowledged of this ACK frame. Two new fields are included in an ACK frame as shown in Fig. 2b: acknowledged QoS control and sequence control field, which are used to identify the traffic priority and the sequence control information of the data frame to be acknowledged respectively. The total overhead due to the extra frame fields including HCS field in data frame is much smaller compared to the total overhead of one data transmission. When a node receives an ACK frame destined to it, it will check the cached sequence number ofthe data frame in the corresponding transmission queue. If the sequence number in ACK matches the cached one, the corresponding data frame is acknowledged.

Otherwise, the ACK is determined to be out of date and dropped. To avoid redundant retransmission, each partner will replace the old frame with the new one if a data frame with the latest sequence number is overheard from the same sender. In practical implementation, a sequence number is produced from a single module-4096 counter. A small window Wseq is used to determine which frame is the latest one by considering the possibility that the sequence number may be wrapped around.

The frame a will be determined to be the latest one compared to the frame b if:  seq (a) > seq (b) & seq (a) - seq (b) < Wseq (1)  or seq (a) < seq (b) & seq (a) - seq (b) < Wseq - 4096.

Queue AIFS CWmin CWmu Mretry Own Classl (ACO) 7 31 1023 7 Partner Class 1 (AC 1) 2 CW1 22 x(CW1+l)-1 2 Own Class2 (AC2) 2 15 31 7 Partner Class 2 (AC3) 2 CW2 22 x(CW2+1)-1 2  Modulation DPSK,CCK Data frame rate 11 Mbps  Control frame rate 1 Mbps Transmission power OdBm Receiver sensitivity -95 dBm Background noise -88 dBm  SIFS 10 ~s Slot time 10 J!s  PHY preamble and header 192 bit MAC header 240 bit ACK/NAK 144 bit  Payload 1000 byte  move randomly within the circle according to the random waypoint model [9] with a speed uniformly distributed in [0, v mls]. Pause time between moves is set to be Os. We set the initial contention window size for relaying CW2=15. As shown in Fig. 5, DC-MAC outperforms 802.11e in terms of both throughput and MAC delay across all the channel conditions.

In particular, the performance improvement of DC-MAC is more obvious under a slow fading channel. When v = 1 mis, 38% frames are dropped in 802.11e due to exceeded retransmission threshold. A transmitter can only see a single realization of the channel within its retransmission duration and thus ARQ scheme based on time diversity cannot help. DC- MAC solves this problem by exploiting spatial diversity.

Facilitated by real-time channel estimation in DC-MAC, a very high retransmission successful probability can be achieved by retransmitting the frames from a competent relay.

To clarify the effects of retransmission priorities at relays, we investigate a mixed traffic scenario where four stations with uplink background UDP traffic and one station with uplink video traffic are symmetrically placed on the circle. Idle stations move continuously and randomly within the circle at a constant speed of 1 mls. To clearly show the performance differences, each flow is saturated, Le. it always has a frame awaiting transmission. We can see in Fig. 6 that the sizes of CWmin at relays for different traffic classes can significantly affect the relative performance ratio of these traffic classes.

When CW2is fixed, the performance ofvideo flow is improved as CW1 increases while the performance of background UDP flow is reduced. When CW1 is fixed, the performance of background UDP flow is improved as CW2increases while the performance of video flow is reduced except for CW2=15. At the extreme case (CW1 =7, 15 or 31, CW2 =255), the performance of video flow in DC-MAC is worse than that in 802.11e. On one hand, since relays have to compete with each other to forward the frames, a too small contention window may result in considerable transmission collisions negatively affecting the performance; On the other hand, a too big contention window may enable the retransmission from the

III. SIMULATION RESULTS AND ANALYSIS  We implement the proposed protocol in OPNET 11.5 [7] and compare it with the original 802.11e EDCA. The effects of the key parameters ofDC-MAC are identified.

A. Simulation Setup  We simulate an 802.11b WLAN consisting of an Access Point (AP), several stations with uplink traffic and 20 idle stations which may potentially act as relays. All the idle stations are randomly distributed within a circle of radius 120m, while the AP is located at the centre of this circle. We have assumed two types of traffic flows: video streams and background UDP traffic, which are transmitted from own queue 2 (AC2) and own queue 1 (ACO) respectively. The set of prioritized access parameters used in simulations are shown in Table I. For purpose of comparison, the default parameters defined in OPNET are used for both own queues. The basic 802.11 parameters used are shown in Table II.

The channel simulation model proposed in [8] is incorporated into OPNET to simulate a Ricean fading channel.

The average fade duration (the average period of time for which the normalized signal envelope is below a specified level p) is given by:  1-qJ2K,~2(K +1)p2) i = , (2)  ~21r(K +Ofmpe-K-(K+l)p2 Io(2p~K(K+1?  where K is the Ricean factor, fm is the maximum Doppler frequency, Q(a,b) is the Marcum Q function and 10 is the modified Bessel function of the first kind, zero order. For a mobile travelling at Im1s with RF frequency 2.4 GHz, which corresponds to a type WLAN scenario, the maximum Doppler frequency is around 8 Hz. Assuming that the Riceanfactor K is 5, at the normalized threshold of 0 dB, the average fade duration is 97.6 ms. At a data rate of 11 Mbps, a 1000 byte frame takes only 0.73 ms. The average fade duration is on the order ofmultiple frame transmission times.

For each simulation, the following metrics are evaluated:  ? Throughput: Total data traffic in bits/sec successfully received and forwarded to the higher layer by each AC.

? MAC Delay: From the time a frame arrives at the head of the transmission queue to the time it is successfully transmitted or dropped by the MAC.

B. Simulation Results  We first evaluate the impact of the channel coherence time that is inversely proportional to the maximum Doppler shift and determined by the maximum velocity of objects in environment. To clarify the effects of different aspects separately, we only consider one station with uplink video traffic travelling along a straight line to and from the AP at a constant speed of v mls in an oscillatory motion. The distance between them varies between 80m and 120m. The traffic is generated at a rate of400 Kbps with a frame size of 1000 bytes, which models a normal video flow in real world. Idle stations  TABLE I.

TABLE II.

THE SET OF PRIORITIZED ACCESS PARAMETERS  THE SET OF BASIC 802.11 PARAMETERS     _____ DC-MAC cw 2=7 -e- DC-MACCW 2=15 -B- DC.MAC:CW  =31  -+- DC-MAC CW)=63 -A- DC?MAC c\\' tl27  ----v- DC-MAC: CW 2~255 --t-S02.11e  CW   ( C) Background throughput   4001~---+----+--~----+-----,r    ~ 1600  !1400  ~ 1200W---~---V--  ~ 1000...--_---.-__...

i 8OOn:I---~-t:::t-__-I=l---  CW   (a) Video throughput   ___ DC-MAC CW t7 -e- DC.MACCW  =15  ~ DC-MAC: CW,=31  -+- DC-MAC CW ;=63 -A- DC-MAC CW,=127 ----v- DC?MAC: CW;=255 -+-S0211e     !2400  '[ 2200  [200  ~ 1800  ~ 1600 :>-    10 74 5 6 7  Maximum Speed (m/s)  (a) Video throughput  0'------'------'----'-----'----'-----'--""'------->------>      CW1  (b) Video MAC delay  __ DC?MAC: cw t7 -e- DC-MAC CW tl5 ~ DC?MAC CW t31  -+- DC?MAC CW 2=63 -A- DC?MAC CW tl27  ->;j- DC-MAC CW t255  --t-S02.11e  20 '---_---'--__.L....--_---'--__.L--_--'  CW   (d) Background MAC delay   140,------.------,-----,-----,-------,  E  ~100 a; Cl  U < 80 :i:  _____ DC?MAC CW:=7  -e- DC-MAC:CW2~15 ~ DC-MAC: CW2=31  -+- DC-MAC:CW 2=63 -A- DC.MACCW2=127  ----v- DC-MAC CW 2=255 --+-S0211eI OO~_-etI'l=::::::::::::=---e--_~:--?     -Il!r- DC?MAC  --ll-- S02.11 e 12  E .s ~5 ;;1  ~4 a; c  u u < < 8:i: :i:  ~3 Q> "0  :>- :> 6  1 4 5 6 7 10  Maximum Speed (m/s)  (b) Video MAC delay  Figure 5. Impact of channel coherence time. Figure 6. Impact ofCWmin at relays.

original source occurring before cooperative retransmissions and thus the bandwidth is wasted by useless retransmissions. It is shown that when appropriate access parameters are applied the performances of both multimedia flow and background UDP flow are significantly improved while service differentiation is supported. With the setting of CW1 = 31 and CW2 =15, compared to 802.11e, DC-MAC can increase the video and the background throughput by 76% and 56% respectively and reduce the video and the background MAC delay by 55% and 57% respectively.



IV. CONCLUSION  In this paper, we propose a novel differentiated cooperative MAC (DC-MAC) for QoS enhancement in WLANs. By enabling cooperative ARQ, the retransmission is initiated from an appropriate transmission queue of an appropriate relay instead of the original source. A channel-aware feedback mechanism is introduced for loss distinguishing and channel estimation such that cooperative retransmission will be employed only when necessary and only by competent nodes.

Preliminary simulation results show that the proposed scheme significantly improves the performances of both multimedia applications and best-effort data applications while supporting service differentiation. For future work, we are conducting more extensive simulations to clarify the relay contention effects and the impact ofvarious environmental parameters.

